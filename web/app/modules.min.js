//mark.lawrence
//app.module.js

(function () {
    angular.module('app',
    [
        //application modules
        'app.core',
        'app.service',
        'app.filter',

        //feature areas
        'app.nav',
        'app.users',
        'app.tax',
        'app.template',
        'app.mailers',
        'app.events'
    ]);
})();
//core.module.js
//mark.lawrence

(function () {
    angular.module('app.core',
        [
            //angular modules
            'ngMessages',
            'angularLocalStorage',
            'ngRoute',
            'ngAnimate',

            //custom modules
            'blocks.logger',
            'blocks.exception',

            //third party modules
            'smart-table',
            'ui.bootstrap',
            'ngTagsInput',
            'ngFileUpload',
            'rzModule',
            'switcher',
            'gfl.textAvatar',
            'textAngular',
            'ui.bootstrap.datetimepicker', 
            'angular-confirm'
            //'ng-file-input'
        ])
        .constant('toastr', toastr)
        .constant('moment', moment);

})();
//config.js
//mark.lawrence
(function () {
    function toastrConfig(toastr) {
        toastr.options.timeOut = 4000;
        toastr.options.positionClass = 'toast-bottom-right';
    };

    var keyCodes = {
        backspace: 8,
        tab: 9,
        enter: 13,
        esc: 27,
        space: 32,
        pageup: 33,
        pagedown: 34,
        end: 35,
        home: 36,
        left: 37,
        up: 38,
        right: 39,
        down: 40,
        insert: 45,
        del: 46
    };

    var apiEndPoints = {
        User: 'users',
        Constituent: 'constituent',
        Tax: 'tax',
        Template: 'template',
        Campaign: 'campaign',
        Mailer: 'mailer',
        Reason: 'reason',
        Event: 'event',
        Guest: 'guest',
        File: 'file'
    };

    var config = {
        appErrorPrefix: '[DG Error] ', //Configure the exceptionHandler decorator
        appTitle: 'DonorGateway',
        version: '1.0.0',
        apiUrl: 'http://' + window.location.host + '/api/',
        keyCodes: keyCodes,
        apiEndPoints: apiEndPoints
    };

    var defaults = {
        EMAIL_SUFFIX: '@splcenter.org',
        GENERIC_PASSWORD: '1P@ssword'
    };

    angular.module('app.core')
        .config(toastrConfig)
        .constant('config', config)
        .value('defaults', defaults);
})();
//mark.lawrence
//exception.module.js

(function () {
    angular.module('blocks.exception', ['blocks.logger']);
})();
(function () {
    'use strict';

    angular.module('blocks.logger', []);
})();
//mark.lawrence
//event.module.js

(function () {
    angular.module('app.events', []);
})();
//filter.module.js
//mark.lawrence

(function () {
    angular.module('app.filter', []);
})();
//mark.lawrence
//mailers.module.js

(function () {
    angular.module('app.mailers', []);
})();
//mark.lawrence
//nav.module.js

(function () {
    angular.module('app.nav', []);
})();
//service.module.js
//mark.lawrence

(function () {
    angular.module('app.service', []);
})();
//tax.module.js
//mark.lawrence

(function () {
    angular.module('app.tax', []);
})();
//mark.lawrence
//template.module.js

(function () {
    (function () {
        angular.module('app.template', []);
    })();
})();
(function () {
    'use strict';

    angular.module('app.users', []);
})();
//mark.lawrence
//exception-handler.provider.js

// Include in index.html so that app level exceptions are handled.
// Exclude from testRunner.html which should run exactly what it wants to run
(function () {
    'use strict';

    angular
        .module('blocks.exception')
        .provider('exceptionHandler', exceptionHandlerProvider)
        .config(config);

    /**
     * Must configure the exception handling
     * @return {[type]}
     */
    function exceptionHandlerProvider() {
        /* jshint validthis:true */
        this.config = {
            appErrorPrefix: undefined
        };

        this.configure = function (appErrorPrefix) {
            this.config.appErrorPrefix = appErrorPrefix;
        };

        this.$get = function () {
            return { config: this.config };
        };
    };

    /**
     * Configure by setting an optional string value for appErrorPrefix.
     * Accessible via config.appErrorPrefix (via config value).
     * @param  {[type]} $provide
     * @return {[type]}
     * @ngInject
     */
    function config($provide) {
        $provide.decorator('$exceptionHandler', extendExceptionHandler);
    };

    /**
     * Extend the $exceptionHandler service to also display a toast.
     * @param  {Object} $delegate
     * @param  {Object} exceptionHandler
     * @param  {Object} logger
     * @return {Function} the decorated $exceptionHandler service
     */
    function extendExceptionHandler($delegate, exceptionHandler, logger) {
        return function (exception, cause) {
            var appErrorPrefix = exceptionHandler.config.appErrorPrefix || '';
            var errorData = { exception: exception, cause: cause };
            exception.message = appErrorPrefix + exception.message;
            $delegate(exception, cause);
            /**
             * Could add the error to a service's collection,
             * add errors to $rootScope, log errors to remote web server,
             * or log locally. Or throw hard. It is entirely up to you.
             * throw exception;
             *
             * @example
             *     throw { message: 'error message we added' };
             */
            logger.error(exception.message, errorData);
        };
    };
})();
//mark.lawrence
//exception.js

(function () {
    'use strict';

    angular
        .module('blocks.exception')
        .factory('exception', exception);

    /* @ngInject */
    function exception(logger) {
        var service = {
            catcher: catcher
        };

        return service;

        function catcher(message) {
            return function (reason) {
                logger.error(message, reason);
            };
        };
    };
})();
//mark.lawrence
//logger.js

(function () {
    'use strict';

    angular.module('blocks.logger').factory('logger', logger);

    logger.$inject = ['$log', 'toastr'];

    function logger($log, toastr) {
        var service = {
            showToasts: true,

            error: error,
            info: info,
            success: success,
            warning: warning,

            // straight to console; bypass toastr
            log: $log.log
        };

        return service;
        /////////////////////

        function error(message, data, title) {
            toastr.error(message, title);
            $log.error('Error: ' + message, data);
        };

        function info(message, data, title) {
            toastr.info(message, title);
            $log.info('Info: ' + message, data);
        };

        function success(message, data, title) {
            toastr.success(message, title);
            $log.info('Success: ' + message, data);
        };

        function warning(message, data, title) {
            toastr.warning(message, title);
            $log.warn('Warning: ' + message, data);
        };
    };
})();
//mark.lawrence
//clear-key.directive.js

(function () {
    angular.module('app').directive("clearKey", function () {
        return {
            restrict: 'EA',
            require: 'ngModel',
            link: function (scope, el, attrs, ctrl) {
                el.on('keydown', function (event) {
                    if (event.which !== 27) { return; } // check key how you want
                    ctrl.$setViewValue(null);
                    ctrl.$render();
                    scope.$apply();
                });
            }
        };
    });
})();
//mark.lawrence
//date-format.directive.js

(function () {
    angular.module('app')
        .directive('dateFormat',
            function (dateFilter, $parse) {
                return {
                    restrict: 'EAC',
                    require: '?ngModel',
                    link: function (scope, element, attrs, ngModel, ctrl) {
                        ngModel.$parsers.push(function (viewValue) {
                            return dateFilter(viewValue, 'MM/dd/yyyy h:mm a');
                        });
                    }
                }
            });
})();
//mark.lawrence
//date-input.directive.js

(function () {
    angular.module('app').directive('dateInput', function ($window) {
        return {
            require: '^ngModel',
            restrict: 'A',
            link: function (scope, elm, attrs, ctrl) {
                var moment = $window.moment;
                var dateFormat = attrs.dateInput;
                attrs.$observe('dateInput', function (newValue) {
                    if (dateFormat == newValue || !ctrl.$modelValue) return;
                    dateFormat = newValue;
                    ctrl.$modelValue = new Date(ctrl.$setViewValue);
                });

                ctrl.$formatters.unshift(function (modelValue) {
                    scope = scope;
                    if (!dateFormat || !modelValue) return "";
                    var retVal = moment(modelValue).format(dateFormat);
                    return retVal;
                });

                ctrl.$parsers.unshift(function (viewValue) {
                    scope = scope;
                    var date = moment(viewValue, dateFormat);
                    return (date && date.isValid() && date.year() > 1950) ? date.toDate() : "";
                });
            }
        };
    });
})();
//mark.lawrence
//smart-table.clearKey.js

(function () {
    angular.module('app').directive("stClearKey", function () {
        return {
            restrict: 'EA',
            require: '^stTable',
            link: function (scope, element, attrs, ctrl) {
                element.on('keydown', function (event) {
                    if (event.which !== 27) { return; } // check key how you want
                    return scope.$apply(function () {
                        var fieldName = element.context.attributes['st-search'].value;
                        var tableState = ctrl.tableState();
                        tableState.search.predicateObject[fieldName] = '';
                        return ctrl.pipe();
                    });
                });
            }
        };
    });
})();
(function() {


    var app = angular.module('app');

    app.directive('toggleCheckbox', function($timeout) {

        /**
     * Directive
     */
        return {
            restrict: 'A',
            transclude: true,
            replace: false,
            require: 'ngModel',
            link: function($scope, $element, $attr, ngModel) {

                // update model from Element
                var updateModelFromElement = function() {
                    // If modified
                    var checked = $element.prop('checked');
                    if (checked != ngModel.$viewValue) {
                        // Update ngModel
                        ngModel.$setViewValue(checked);
                        $scope.$apply();
                    }
                };

                // Update input from Model
                var updateElementFromModel = function(newValue) {
                    $element.trigger('change');
                };

                // Observe: Element changes affect Model
                $element.on('change', function() {
                    updateModelFromElement();
                });

                $scope.$watch(function() {
                    return ngModel.$viewValue;
                }, function(newValue) {
                    updateElementFromModel(newValue);
                }, true);

                // Initialise BootstrapToggle
                $element.bootstrapToggle();
            }
        };
    });
})();
//mark.lawrence
//editGuest.controller.js

(function () {
    'use strict';

    var controllerId = 'EditGuestController';

    angular.module('app.events').controller(controllerId, mainController);

    mainController.$inject = ['logger', '$uibModalInstance', 'guestService', 'templateService', 'guest'];

    function mainController(logger, $modal, service, templateService, guest) {
        var vm = this;
        vm.title = 'Edit Guest';

        vm.guest = angular.copy(guest);

        logger.log('guest', guest);

        vm.cancel = function () {
            $modal.dismiss();
        }

        vm.save = function () {
            service.update(vm.guest)
                .then(function (data) {
                    angular.extend(vm.guest, data);
                    logger.log('guest', vm.guest);
                    $modal.close(vm.guest);
                }).finally(function () {
                });
        }
    }


})();
//mark.lawrence
//events.js

(function () {
    'use strict';

    var controllerId = 'EventController';

    angular.module('app.events').controller(controllerId, mainController);

    mainController.$inject = ['logger', '$uibModal', 'eventService', 'guestService', 'templateService'];

    function mainController(logger, $modal, service, guestService, templateService) {
        var vm = this;
        var tableStateRef;
        var pageSizeDefault = 10;

        vm.showWaitList = false;
        vm.showMailQueue = false;

        vm.title = 'Event Manager';
        vm.description = "Manage Donor Events";
        vm.currentDate = new Date();

        vm.dateOptions = {
            dateDisabled: false,
            formatYear: 'yy',
            maxDate: new Date(2020, 5, 22),
            minDate: new Date(),
            startingDay: 1
        };

        vm.dateFormat = "MM/DD/YYYY h:mm a";
        vm.events = [];

        vm.searchModel = {
            page: 1,
            pageSize: pageSizeDefault,
            orderBy: 'id',
            orderDirection: 'asc'
        };

        vm.tabs = [
            { title: 'Details', template: 'app/events/views/home.html', active: false, icon: 'fa-info-circle' },
            { title: 'Guests', template: 'app/events/views/guest-list.html', active: true, icon: 'fa-users' },
            //{ title: 'Mail Queue', template: 'app/events/views/mail-queue.html', active: false, icon: '' },
            //{ title: 'Waiting Queue', template: 'app/events/views/wait-queue.html', active: false, icon: '' },
            { title: 'Template', template: 'app/events/views/template.html', active: false, icon: 'fa-file-text' }
        ];

        activate();

        function activate() {
            logger.log(controllerId + ' activated');
            getEvents().then(function () {
                //TODO: REMOVE THIS 
                vm.selectedEvent = vm.events[0];
            });

        }

        vm.addToMailQueue = function (guest) {
            vm.isBusy = true;
            guest.isWaiting = false;
            guest.isAttending = true;
            guestService.update(guest)
                .then(function (data) {
                    logger.log('added guest', data);
                    logger.info('Added Guest to Queue: ' + data.name);
                    guest = data;
                }).finally(function () {
                    //complete();
                    vm.isBusy = false;
                });
        }

        vm.changeEvent = function () {
            vm.isBusy = true;
            if (!vm.selectedEvent) return;
            service.getById(vm.selectedEvent.id)
                .then(function (data) {
                    angular.extend(vm.selectedEvent, data);
                    vm.selectedEvent.isExpired = moment(vm.selectedEvent.endDate).toDate() < vm.currentDate;
                    vm.guests = vm.selectedEvent.guests;
                    logger.log('event', vm.selectedEvent);
                }).finally(function () {
                    vm.isBusy = false;
                    vm.searchGuests(tableStateRef);
                });

        }

        vm.deleteEvent = function (id) {
            //TODO: Confirmation on delete
            vm.isBusy = true;
            service.remove(id)
                .then(function (data) {
                    vm.selectedEvent = null;
                    logger.success('Deleted event');
                }).finally(function () {
                    vm.isBusy = false;
                    getEvents();
                });
        }

        vm.registerGuest = function (guest) {

            $modal.open({
                templateUrl: '/app/events/views/edit-guest.html',
                controller: 'EditGuestController',
                controllerAs: 'vm',
                resolve: {
                    guest: guest
                }
            }).result.then(function (result) {
                logger.log('result', result);
                angular.extend(guest, result);
            });
        }

        vm.filterWaitingQueue = function () {
            vm.showWaitList = !vm.showWaitList;
            vm.showMailQueue = false;
            var isWaiting = vm.searchModel.isWaiting = !vm.searchModel.isWaiting === true ? true : null;
            vm.searchModel = {
                page: 1,
                pageSize: pageSizeDefault,
                orderBy: 'id',
                orderDirection: 'asc',
                isWaiting: isWaiting,
                isAttending: true,
                isMailed: null
            }
            vm.searchGuests(tableStateRef);
        }

        vm.filterMailQueue = function () {
            vm.showMailQueue = !vm.showMailQueue;
            vm.showWaitList = false;
            var isAttending = vm.searchModel.isAttending = !vm.searchModel.isAttending === true ? true : null;
            var isWaiting = vm.searchModel.isWaiting = !vm.searchModel.isWaiting === true ? false : null;
            vm.searchModel = {
                page: 1,
                pageSize: pageSizeDefault,
                orderBy: 'id',
                orderDirection: 'asc',
                isAttending: isAttending,
                isMailed: false,
                isWaiting: isWaiting
            }
            vm.searchGuests(tableStateRef);
        }

        vm.mailTicket = function (guest) {
            vm.isBusy = true;
            guest.isMailed = true;
            vm.isWaiting = false;
            guestService.update(guest)
                .then(function (data) {
                    angular.extend(guest, data);
                    logger.success('Issued ticket to: ' + guest.name);
                }).finally(function () {
                    vm.isBusy = false;
                });
        }

        vm.searchGuests = function (tableState) {
            tableStateRef = tableState;
            if (!vm.selectedEvent) return;

            if (typeof (tableState.sort.predicate) != "undefined") {
                vm.searchModel.orderBy = tableState.sort.predicate;
                vm.searchModel.orderDirection = tableState.sort.reverse ? 'desc' : 'asc';
            }
            if (typeof (tableState.search.predicateObject) != "undefined") {
                vm.searchModel.name = tableState.search.predicateObject.name;
                vm.searchModel.address = tableState.search.predicateObject.address;
                vm.searchModel.city = tableState.search.predicateObject.city;
                vm.searchModel.state = tableState.search.predicateObject.state;
                vm.searchModel.zipcode = tableState.search.predicateObject.zipcode;
                vm.searchModel.guestCount = tableState.search.predicateObject.guestCount;
                vm.searchModel.phone = tableState.search.predicateObject.phone;
                vm.searchModel.email = tableState.search.predicateObject.email;
                vm.searchModel.accountId = tableState.search.predicateObject.accountId;
                vm.searchModel.finderNumber = tableState.search.predicateObject.finderNumber;
                vm.searchModel.isMailed = tableState.search.predicateObject.isMailed;
            }

            vm.isBusy = true;
            return service.getGuests(vm.selectedEvent.id, vm.searchModel)
                .then(function (data) {
                    vm.selectedEvent.guests = data.items;
                    vm.searchModel = data;
                    logger.log('search', vm.searchModel);
                    vm.isBusy = false;
                });

        }

        vm.paged = function paged() {
            vm.searchGuests(tableStateRef);
        };

        vm.saveEvent = function (form) {
            vm.isBusy = true;
            return service.update(vm.selectedEvent)
                .then(function (data) {
                    logger.success('Saved Event: ' + data.name);
                    angular.extend(vm.selectedEvent, data);
                    vm.selectedEvent.isExpired = moment(vm.selectedEvent.endDate).toDate() < vm.currentDate;
                })
                .finally(function () {
                    form.$setPristine();
                    vm.isBusy = false;
                });
        }

        vm.fileSelected = function ($files, $file, $event, $rejectedFiles) {
            var reader = new FileReader();
            reader.onloadstart = function () {

                vm.isBusy = true;
            };
            reader.onloadend = function () {
                vm.isBusy = false;

            }
            reader.onload = function (e) {
                var dataURL = reader.result;
                vm.selectedEvent.template.image = dataURL.split(',')[1];
                vm.selectedEvent.template.mimeType = $file.type;
            };
            reader.readAsDataURL($file);

        };

        vm.saveTemplate = function () {
            vm.isBusy = true;
            templateService.update(vm.selectedEvent.template)
                .then(function (data) {
                    vm.selectedEvent.template = angular.extend(vm.selectedEvent.template, data);
                    logger.success('Saved template: ' + data.name);
                }).finally(function () {
                    complete();
                });
        }

        vm.toggleCancel = function (form) {
            vm.selectedEvent.isCancelled = !vm.selectedEvent.isCancelled;
            vm.saveEvent(form).then(function () {
                if (vm.selectedEvent.isCancelled) {
                    logger.warning('Cancelled event');
                } else {
                    logger.info('Restored event');
                }
            });
        }

        vm.showCreateEvent = function () {
            $modal.open({
                templateUrl: '/app/events/views/create-event.html',
                controller: ['logger', '$uibModalInstance', 'eventService', CreateEventController],
                controllerAs: 'vm'
            }).result.then(function (data) {
                vm.selectedEvent = data;
                vm.events.unshift(vm.selectedEvent);
                logger.success('Successfully created ' + data.name);
            });
        }

        vm.showGuestUpload = function () {
            logger.log('show upload');
            $modal.open({
                keyboard: false,
                backdrop: 'static',
                templateUrl: '/app/events/views/guest-upload.html',
                controller: ['logger', '$uibModalInstance', 'fileService', 'selectedEvent', UploadGuestController],
                controllerAs: 'vm',
                resolve: {
                    selectedEvent: vm.selectedEvent
                }
            }).result.then(function (result) {
                if (result.success) {
                    logger.success(result.message);
                } else {
                    logger.error(result.message);
                }
                vm.changeEvent();
            });
        }

        function getEvents() {
            vm.isBusy = true; 
            return service.get()
                .then(function (data) {
                    vm.events = data;
                }).finally(function () {
                    vm.isBusy = false; 
                });
        }

        //TODO: REMOVE
        function complete() {
            //vm.isBusy = false;
            //vm.selectedEvent = vm.events[0];
            //vm.changeEvent();
        }
    };

    function UploadGuestController(logger, $modal, service, event) {
        var vm = this;
        vm.event = event;

        vm.cancel = function () {
            vm.file = undefined;
            $modal.dismiss();
        }

        vm.fileSelected = function ($file, $event) {
            vm.result = null;
        };


        vm.save = function () {
            vm.isBusy = true;
            vm.result = {
                success: false
            }

            service.guest(vm.event.id, vm.file)
                    .then(function (data) {
                        vm.result.success = true;
                        vm.result.message = data;
                    }).catch(function (error) {
                        vm.result.message = error.data.message;
                    }).finally(function () {
                        vm.file = undefined;
                        vm.isBusy = false;
                        $modal.close(vm.result);
                    });
        }
    }

    function CreateEventController(logger, $modal, service) {
        var vm = this;

        vm.dateFormat = "MM/DD/YYYY hh:mm";

        vm.event = {
            startDate: new Date(),
            template: {}
        };

        vm.cancel = function () {
            $modal.dismiss();
        }

        vm.save = function () {
            vm.event.template.name = vm.event.name;
            service.create(vm.event)
                .then(function (data) {
                    $modal.close(data);
                });
        }
    }
})();
//app.filter.js
//mark.lawrence

angular.module('app.filter').filter('percentage', ['$filter', function ($filter) {
    return function (input, decimals) {
        return $filter('number')(input * 100, decimals) + '%';
    };
}]);

angular.module('app.filter', []).filter('checkmark', function () {
    return function (input) {
        return input ? '\u2713' : '\u2718';
    };
});

angular.module('app.filter').filter('yesNo', function () {
    return function (input) {
        return input ? 'Yes' : 'No';
    }
});

angular.module('app.filter').filter('updateStatus', function () {
    return function (input) {
        if (input === 1) {
            return 'Unchanged';
        }
        if (input === 2) {
            return 'Changed';
        }
        if (input === 6) {
            return 'Reconciled';
        }
    };
});
//mark.lawrence
//mailers.js

(function () {
    var controllerId = 'MailerController';

    angular.module('app.mailers').controller(controllerId, MainController);

    MainController.$inject = ['logger', '$uibModal', 'campaignService', 'reasonService', 'mailerService'];

    function MainController(logger, $modal, campaignService, reasonService, mailerService) {
        var vm = this;
        var tableStateRef;

        vm.title = 'Mailers Manager';
        vm.description = "Update Mailer Acquisition Data";

        vm.campaigns = [];
        vm.reasons = [];
        vm.currentEdit = {};
        vm.itemToEdit = {};

        vm.mailers = [];
        vm.searchModel = {
            page: 1,
            pageSize: 10,
            orderBy: 'campaignId',
            orderDirection: 'desc',
            suppress: false
        };
        vm.supress = false;
        //vm.downloadCsv = downloadCsv;
        vm.isBusy = false;

        activate();

        function activate() {
            logger.log(controllerId + ' activated');
            getCampaigns();
            getReasons();
        }

        vm.cancelEdit = function (id) {
            vm.currentEdit[id] = false;
        };

        vm.editItem = function (item) {
            vm.currentEdit[item.id] = true;
            angular.copy(item, vm.itemToEdit = {});
        }

        vm.paged = function paged(pageNum) {
            vm.lastDeleted = null;
            vm.lastUpdated = null;
            vm.search(tableStateRef);
        };

        vm.save = function (item) {
            vm.currentEdit[item.id] = false;
            vm.itemToEdit.suppress = true;
            mailerService.update(vm.itemToEdit)
                .then(function (data) {
                    angular.extend(item, data);
                    logger.success('Suppressed ' + item.finderNumber);
                });
        }

        vm.search = function (tableState) {
            tableStateRef = tableState;

            if (typeof (tableState.sort.predicate) != "undefined") {
                vm.searchModel.orderBy = tableState.sort.predicate;
                vm.searchModel.orderDirection = tableState.sort.reverse ? 'desc' : 'asc';
            }
            if (typeof (tableState.search.predicateObject) != "undefined") {
                vm.searchModel.firstName = tableState.search.predicateObject.firstName;
                vm.searchModel.lastName = tableState.search.predicateObject.lastName;
                vm.searchModel.address = tableState.search.predicateObject.address;
                vm.searchModel.city = tableState.search.predicateObject.city;
                vm.searchModel.state = tableState.search.predicateObject.state;
                vm.searchModel.zipcode = tableState.search.predicateObject.zipcode;
                vm.searchModel.finderNumber = tableState.search.predicateObject.finderNumber;
                vm.searchModel.sourceCode = tableState.search.predicateObject.sourceCode;
                vm.searchModel.campaignId = tableState.search.predicateObject.campaignId;
                vm.searchModel.reasonId = tableState.search.predicateObject.reasonId;
            }

            vm.isBusy = true;
            mailerService.query(vm.searchModel)
                .then(function (data) {
                    vm.mailers = data.items;
                    vm.searchModel = data;
                    vm.isBusy = false;
                });
        }

        vm.filterSuppress = function () {
            vm.search(tableStateRef);
        }

        function getCampaigns() {
            campaignService.get()
                .then(function (data) {
                    vm.campaigns = data;
                });
        }

        function getReasons() {
            reasonService.get()
                .then(function (data) {
                    vm.reasons = data;
                });
        }
    }
})();
//mark.lawrence
//nav.js

(function () {
    'use strict';

    var controllerId = 'NavController';

    angular.module('app.nav').controller(controllerId, mainController);

    mainController.$inject = ['logger'];

    function mainController(logger) {
        var vm = this;

        activate();

        function activate() {
            logger.log(controllerId + ' activated');
            vm.user = JSON.parse(localStorage.getItem('currentUser'));
        }
    };
})();
//mark.lawrence
//campaign.service.js

(function () {
    'use strict';

    var serviceId = 'campaignService';
    angular.module('app.service').factory(serviceId, serviceController);

    function serviceController(logger, $http, config) {
        logger.log(serviceId + ' loaded');
        var url = config.apiUrl + config.apiEndPoints.Campaign;

        var service = {
            get: get,
            update: update,
            query: query
            //            remove: remove,
            //            save: save,
            //            search: search,
        }

        return service;

        function get() {
            return $http.get(url)
                .then(function (response) {
                    return response.data;
                });
        }

        function query(name) {
            return $http.get(url + '/' + name)
                .then(function (response) {
                    return response.data;
                });
        }

        function update(template) {
            return $http.put(url, template)
                .then(function (response) {
                    return response.data;
                });
        }
    }
})();
//constituent.service.js
//mark.lawrence

(function () {
    'use strict';

    var serviceId = 'constituentService';
    angular.module('app.service').factory(serviceId, serviceController);

    function serviceController(logger, $http, config) {
        logger.log(serviceId + ' loaded');
        var url = config.apiUrl + config.apiEndPoints.Constituent;

        var service = {
            query: query,
            update: update,

            //TODO: Remove???
            remove: remove,
            get: get,
            create: create,
            download: download,
            save: save
        }

        return service;

        function create() {
        }

        function download(vm) {
            vm.allRecords = true;
            return $http.post(URL + '/search', vm)
                .then(function (response) {
                    return response.data;
                });
        }

        function get(id) {
            return $http.get(URL + '/id')
                .then(function (response) {
                    return response.data;
                });
        }

        function query(vm) {
            return $http.post(url + '/search', vm)
              .then(function (response) {
                  return response.data;
              });
        }

        function update(item) {
            return $http.put(url, item)
                .then(function (response) {
                    return response.data;
                });
        }

        function remove() { }

        function save() { }
    }
})();
//mark.lawrence
//event.service.js

(function () {
    'use strict';

    var serviceId = 'eventService';
    angular.module('app.service').factory(serviceId, serviceController);

    function serviceController(logger, $http, config) {
        logger.log(serviceId + ' loaded');
        var url = config.apiUrl + config.apiEndPoints.Event;

        var service = {
            create: create,
            remove: remove,
            get: get,
            getById: getById,
            getGuests: getGuests, 
            update: update,
            query: query
        }

        return service;

        function create(event) {
            return $http.post(url, event)
                .then(_success).catch(error);
        }

        function remove(id) {
            return $http.delete(url + '/' + id).then(_success).catch(error);
        };

        function get() {
            return $http.get(url)
                .then(_success).catch(error);
        }

        function getById(id) {
            return $http.get(url + '/' + id)
                .then(_success).catch(error);
        }

        function getGuests(id, vm) {
            return $http.post(url + '/' + id + '/guests', vm)
                .then(_success).catch(error);
        }

        function query(name) {
            return $http.get(url + '/' + name)
                .then(_success).catch(error);
        }

        function update(event) {
            return $http.put(url, event)
                .then(_success).catch(error);
        }

        function _success(response) {
            return response.data;
        };

        function error(error) {
            return error.data.message; 
        }
    }
})();
//mark.lawrence
//file.service.js

(function () {

    'use strict';

    var serviceId = 'fileService';
    angular.module('app.service').factory(serviceId, serviceController);

    function serviceController(logger, $http, config) {
        logger.log(serviceId + ' loaded');
        var url = config.apiUrl + config.apiEndPoints.File;

        var service = {
            guest: guest
        }

        return service;

        function guest(id, datafile) {
            return $http.post(url + '/guest/' + id, formDataObject(datafile), {
                transformRequest: angular.identity,
                headers: { 'Content-Type': undefined }
            }).then(function (response) {
                return response.data;
            });
        }

        function formDataObject(data) {
            var fd = new FormData();
            fd.append('file', data);
            return fd;
        }
    }
})();
//mark.lawrence
//guest.service.js

(function () {
    'use strict';

    var serviceId = 'guestService';
    angular.module('app.service').factory(serviceId, serviceController);

    function serviceController(logger, $http, config) {
        logger.log(serviceId + ' loaded');
        var url = config.apiUrl + config.apiEndPoints.Guest;

        var service = {
            create: create,
            remove: remove,
            get: get,
            getById: getById,
            update: update,
            query: query
        }

        return service;

        function create(event) {
            return $http.post(url, event)
                .then(function (response) {
                    return response.data;
                });
        }

        function remove(id) {
            return $http.delete(url + '/' + id).then(_success);
        };

        function get() {
            return $http.get(url)
                .then(function (response) {
                    return response.data;
                });
        }

        function getById(id) {
            return $http.get(url + '/' + id)
                .then(function (response) {
                    return response.data;
                });
        }

        function query(name) {
            return $http.get(url + '/' + name)
                .then(function (response) {
                    return response.data;
                });
        }

        function update(event) {
            return $http.put(url, event)
                .then(function (response) {
                    return response.data;
                });
        }

        function _success(response) {
            return response.data;
        };
    }
})();
//mark.lawrence
//mailer.service.js

(function () {
    'use strict';

    var serviceId = 'mailerService';
    angular.module('app.service').factory(serviceId, serviceController);

    function serviceController(logger, $http, config) {
        logger.log(serviceId + ' loaded');
        var url = config.apiUrl + config.apiEndPoints.Mailer;

        var service = {
            get: get,
            query: query,
            update: update
            //            remove: remove,
            //            save: save,
            //            search: search,
        }

        return service;

        function get(id) {
            return $http.get(URL + '/id')
                .then(function (response) {
                    return response.data;
                });
        }

        function query(vm) {
            return $http.post(url + '/search', vm)
                .then(function (response) {
                    return response.data;
                });
        }

        function update(item) {
            return $http.put(url, item)
                .then(function (response) {
                    return response.data;
                });
        }
    }
})();
//mark.lawrence
//reason.service.js

(function () {
    'use strict';

    var serviceId = 'reasonService';
    angular.module('app.service').factory(serviceId, serviceController);

    function serviceController(logger, $http, config) {
        logger.log(serviceId + ' loaded');
        var url = config.apiUrl + config.apiEndPoints.Reason;

        var service = {
            get: get,
            update: update,
            query: query
            //            remove: remove,
            //            save: save,
            //            search: search,
        }

        return service;

        function get() {
            return $http.get(url)
                .then(function (response) {
                    return response.data;
                });
        }

        function query(name) {
            return $http.get(url + '/' + name)
                .then(function (response) {
                    return response.data;
                });
        }

        function update(template) {
            return $http.put(url, template)
                .then(function (response) {
                    return response.data;
                });
        }
    }
})();
//tax.service.js
//mark.lawrence

(function () {
    'use strict';

    var serviceId = 'taxService';
    angular.module('app.service').factory(serviceId, serviceController);

    function serviceController(logger, $http, config) {
        logger.log(serviceId + ' loaded');
        var url = config.apiUrl + config.apiEndPoints.Tax;

        var service = {
            create: create,
            remove: remove,
            update: update

            //TODO: Remove ???
            //get: get,
            //query: query,
            //save: save
        }

        function remove(id) {
            return $http.delete(url + '/' + id)
                .then(function (response) {
                    return response.data;
                });
        }

        function create(item) {
            logger.log('item', item);
            logger.log('url', url);
            return $http.post(url, item)
                .then(function (response) {
                    return response.data;
                });
        }

        function update(item) {
            return $http.put(url, item)
                .then(function (response) {
                    return response.data;
                });
        }

        return service;

        function get(id) { }

        function query() {
        }
    }
})();
//template.service.js
//mark.lawrence

(function () {
    'use strict';

    var serviceId = 'templateService';
    angular.module('app.service').factory(serviceId, serviceController);

    function serviceController(logger, $http, config) {
        logger.log(serviceId + ' loaded');
        var url = config.apiUrl + config.apiEndPoints.Template;

        var service = {
            get: get,
            update: update,
            query: query
            //            remove: remove,
            //            save: save,
            //            search: search,
        }

        return service;

        function get() {
            return $http.get(url)
                .then(function (response) {
                    return response.data;
                });
        }

        function query(name) {
            return $http.get(url + '/' + name)
                .then(function (response) {
                    return response.data;
                });
        }

        function update(template) {
            return $http.put(url, template)
                .then(function (response) {
                    return response.data;
                });
        }
    }
})();
//user.service.js
//mark.lawrence

(function () {
    'use strict';

    var serviceId = 'userService';
    angular.module('app.service').factory(serviceId, serviceController);

    function serviceController(logger, $http, config) {
        logger.log(serviceId + ' loaded');
        var url = config.apiUrl + config.apiEndPoints.User;

        var service = {
            availableRoles: availableRoles,
            create: create,
            get: get,
            query: query,
            remove: remove,
            update: update
        }

        return service;

        function availableRoles() {
            return $http.get(url + '/roles').then(_success);
        }

        function create(user) {
            return $http.post(url, user).then(_success, function (error) {
                logger.log('error', error);
            });
        }

        function get() {
            return $http.get(url).then(_success);
        }

        function query(searchTerm) {
            var searchUrl = url + '/search/';

            if (searchTerm != undefined && searchTerm.length > 0) {
                searchUrl += '?' + searchTerm;
            };
            return $http.get(searchUrl).then(_success);
        }

        function update(user) {
            return $http.put(url, user).then(_success);
        }

        function remove(id) {
            return $http.delete(url + '/' + id).then(_success);
        }

        function _success(response) {
            return response.data;
        }
    }
})();
//manager.js
//mark.lawrence

(function () {
    var controllerId = 'TaxController';

    angular.module('app.tax').controller(controllerId, MainController);

    MainController.$inject = ['logger', '$uibModal', 'constituentService'];

    function MainController(logger, $modal, service) {
        var vm = this;
        var tableStateRef;

        vm.title = 'Tax Data Manager';
        vm.description = "Update Tax and Constituent Data";

        vm.people = [];
        vm.searchModel = {
            page: 1,
            pageSize: 15,
            orderBy: 'Name',
            orderDirection: 'desc'
        };

        vm.downloadCsv = downloadCsv;
        vm.isBusy = false;

        vm.updateStatusOptions = [
            { id: null, title: 'All' }, { id: 1, title: 'Unchanged' }, { id: 2, title: 'Changed' },
            { id: 6, title: 'Reconciled' }
        ];

        activate();

        function activate() {
            logger.log(controllerId + ' activated');
        }

        //TODO: Export constituent changes
        function downloadCsv() {
            return service.download(vm.data)
                .then(function (data) {
                    var dataFile = [];
                    _.forEach(data.items,
                        function (item) {
                            dataFile.push({
                                'RecordId': item.id,
                                'LookupID': item.lookupId,
                                'FinderNumber': item.finderNumber,
                                'Name': item.name,
                                'EmailAddress': item.email,
                                'AddressLine1': item.street,
                                'AddressLine2': item.street2,
                                'City': item.city,
                                'State': item.state,
                                'ZIP': item.zipcode
                            });
                        });
                    return dataFile;
                });
        }

        vm.editItem = function (item) {
            $modal.open({
                templateUrl: '/app/tax/views/constituent.html',
                controller: ['logger', '$uibModalInstance', 'constituentService', 'item', EditConstituentController],
                controllerAs: 'vm',
                resolve: {
                    item: function () { return item; }
                }
            }).result.then(function (data) {
                angular.extend(item, data);
                logger.success('Successfully updated ' + item.name);
            });
        }

        vm.paged = function paged(pageNum) {
            vm.lastDeleted = null;
            vm.lastUpdated = null;
            vm.search(tableStateRef);
        };

        vm.search = function (tableState) {
            tableStateRef = tableState;

            if (!vm.searchModel.isPriority) vm.searchModel.isPriority = null;

            if (typeof (tableState.sort.predicate) != "undefined") {
                vm.searchModel.orderBy = tableState.sort.predicate;
                vm.searchModel.orderDirection = tableState.sort.reverse ? 'desc' : 'asc';
            }
            if (typeof (tableState.search.predicateObject) != "undefined") {
                vm.searchModel.name = tableState.search.predicateObject.name;
                vm.searchModel.lookupId = tableState.search.predicateObject.lookupId;
                vm.searchModel.finderNumber = tableState.search.predicateObject.finderNumber;
                vm.searchModel.zipcode = tableState.search.predicateObject.zipcode;
                vm.searchModel.email = tableState.search.predicateObject.email;
                vm.searchModel.phone = tableState.search.predicateObject.phone;
                vm.searchModel.updateStatus = tableState.search.predicateObject.updateStatus;
            }

            vm.isBusy = true;
            service.query(vm.searchModel)
                .then(function (data) {
                    vm.people = data.items;
                    vm.searchModel = data;
                    vm.isBusy = false;
                });
        }

        vm.reconcileItem = function (item) {
            //TODO: Replace with CONSTANTS
            item.updateStatus = 6;
            service.update(item).then(function (response) {
                logger.success('Reconciled ' + item.name);
            });
        }

        vm.showTaxItems = function (constituent) {
            $modal.open({
                templateUrl: '/app/tax/views/taxitems.html',
                controller: ['logger', '$uibModalInstance', 'constituent', 'taxService', TaxItemController],
                controllerAs: 'vm',
                resolve: {
                    constituent: function () { return constituent; }
                }
            });
        }
    }

    function TaxItemController(logger, $modal, constituent, service) {
        var vm = this;
        var currentYear = parseInt(moment().get('Year'));

        vm.selectedYear = currentYear - 1;
        logger.log('selectedYear', vm.selectedYear);

        vm.dateOptions = {
            formatYear: 'yyyy',
            maxDate: new Date('12/30/' + vm.selectedYear),
            minDate: new Date('1/1/' + vm.selectedYear),
            startingDay: 1
        };
        vm.altInputFormats = ['M!/d!/yyyy'];

        vm.years = [];

        vm.minDate = new Date('1/1/' + vm.selectedYear);
        vm.maxDate = new Date('12/30/' + vm.selectedYear);

        vm.addItem = addItem;
        vm.cancelEdit = cancelEdit;
        vm.constituent = constituent;
        vm.deleteItem = deleteItem;
        vm.editItem = editItem;
        vm.itemToEdit = {};
        vm.newItem = {};
        vm.saveItem = saveItem;
        vm.taxItems = constituent.taxItems;
        vm.yearChanged = yearChanged;

        activate();

        function activate() {
            getYears();
        }

        function getYears() {
            for (var i = 0; i < 5; i++) {
                vm.years.push(currentYear - i);
            }
        }

        function addItem() {
            vm.newItem.constituentId = constituent.id;
            vm.newItem.taxYear = moment(vm.newItem.donationDate).year();

            service.create(vm.newItem)
                .then(function (data) {
                    vm.taxItems.push(data);
                    vm.newItem = {};
                    logger.success('Added tax item');
                });
        }

        function cancelEdit() {
            vm.currentEdit = {};
        }

        function deleteItem(item) {
            var idx = vm.taxItems.indexOf(item);
            service.remove(item.id)
                .then(function (data) {
                    vm.taxItems.splice(idx, 1);
                    logger.warning('deleted ' + item.donationDate);
                });
        }

        function editItem(item) {
            vm.currentEdit = {};
            vm.currentEdit[item.id] = true;
            vm.itemToEdit = angular.copy(item);
            vm.itemToEdit.donationDate = moment(vm.itemToEdit.donationDate).toDate();
        }

        function saveItem(item) {
            service.update(vm.itemToEdit)
                .then(function (response) {
                    angular.extend(item, vm.itemToEdit);
                    vm.currentEdit = {};
                    logger.success('Updated tax item ' + moment(item.donationDate).format('MM/dd/yyyy'));
                });
        }

        function yearChanged() {
            vm.dateOptions = {
                maxDate: new Date('12/30/' + vm.selectedYear),
                minDate: new Date('1/1/' + vm.selectedYear)
            };
            vm.newItem.donationDate = vm.dateOptions.minDate;
        }
    }

    function EditConstituentController(logger, $modal, service, item) {
        var vm = this;

        vm.item = angular.copy(item);

        vm.close = function () {
            $modal.dismiss();
        }

        vm.save = function () {
            //TODO: Replace with CONSTANTS
            vm.item.updateStatus = 2;
            service.update(vm.item)
                .then(function (data) {
                    //angular.extend(item, vm.item);
                    $modal.close(vm.item);
                });
        }
    }
})();
//template.js
//mark.lawrence

(function () {
    var controllerId = 'TemplateController';

    angular.module('app.template').controller(controllerId, MainController);

    MainController.$inject = ['logger', 'templateService'];

    function MainController(logger, service) {
        var vm = this;

        vm.title = 'Templates';
        vm.description = 'Update event templates';

        vm.templates = [];
        vm.selectedTemplate = {};

        vm.template = {};
        vm.templateCopy = {};

        activate();

        function activate() {
            logger.log(controllerId + ' activated');
            getTemplates();
        }

        function getTemplates() {
            service.get()
                .then(function (data) {
                    vm.templates = data;
                    logger.log('templates', data);
                });
        }

        vm.fileSelected = function ($files, $file, $event, $rejectedFiles) {
            var reader = new FileReader();
            reader.onload = function (e) {
                var dataURL = reader.result;
                vm.selectedTemplate.image = dataURL.split(',')[1];
                vm.selectedTemplate.mimeType = $file.type;
            };
            reader.readAsDataURL($file);
        };

        vm.save = function () {
            vm.isBusy = true;
            service.update(vm.selectedTemplate)
                .then(function (data) {
                    vm.selectedTemplate = angular.extend(vm.selectedTemplate, data);
                    logger.success('Saved ' + vm.selectedTemplate.name);
                }).finally(function () {
                    vm.isBusy = false;
                });
        }
    }
})();
(function () {
    'use strict';

    var controllerId = 'UserController';

    angular.module('app.users').controller(controllerId, UserController);

    UserController.$inject = ['logger', 'userService', 'defaults', 'config'];

    function UserController(logger, service, defaults, config) {
        var vm = this;
        vm.title = 'User Manager';
        vm.description = 'Edit and update users';
        var keyCodes = config.keyCodes;

        vm.availableRoles = [];
        vm.clearCreate = clearCreate;
        vm.currentEdit = {};
        vm.isBusy = false;
        vm.lastDeleted = null;
        vm.lastUpdated = null;
        vm.itemToEdit = {};

        vm.user = {
            //userName: null,
            roles: ['user'],
            fullName: '',
            password: defaults.GENERIC_PASSWORD
        };

        var tableStateRef;

        activate();

        function activate() {
            logger.log(controllerId + ' activated');
            getAvailableRoles();
        };

        vm.addItem = function () {
            vm.user.fullName = parseFullName(vm.user.userName);
            vm.user.email = vm.user.userName + defaults.EMAIL_SUFFIX;
            service.create(vm.user)
                .then(function (data) {
                    //TODO: mapping would allow removal of extend method
                    vm.user = angular.extend(vm.user, data);
                    vm.users.unshift(angular.copy(vm.user));
                    logger.success('User ' + vm.user.userName + ' created!');
                    vm.user.userName = null;
                    //TODO: show error user already exists
                });
        };

        vm.cancelEdit = function (id) {
            vm.currentEdit[id] = false;
        };

        vm.deleteItem = function (user) {
            angular.copy(user, vm.lastDeleted = {});
            service.remove(user.id)
                .then(function (data) {
                    var idx = vm.users.indexOf(user);
                    vm.users.splice(idx, 1);
                });
        };

        vm.editItem = function (user) {
            vm.currentEdit[user.id] = true;
            angular.copy(user, vm.itemToEdit = {});
        };

        function getAvailableRoles() {
            service.availableRoles()
                .then(function (data) {
                    vm.availableRoles = data;
                });
        };

        vm.saveItem = function (user) {
            vm.isBusy = true;

            vm.currentEdit[user.id] = false;
            angular.copy(user, vm.lastUpdated = {});
            var roles = [];

            _.forEach(vm.itemToEdit.roles,
                function (role) {
                    roles.push(role.name);
                });
            vm.itemToEdit.roles = roles;

            service.update(vm.itemToEdit)
                .then(function (data) {
                    angular.extend(user, data);
                    logger.success('User ' + data.userName + ' updated!');
                    vm.isBusy = false;
                });
        };

        vm.search = function (tableState) {
            tableStateRef = tableState;
            var searchTerm;

            if (typeof (tableState.search.predicateObject) != 'undefined') {
                searchTerm = tableState.search.predicateObject.searchTerm;
            }

            vm.isBusy = true;
            service.query(searchTerm)
                .then(function (data) {
                    vm.users = data;
                    logger.log('users', vm.users);
                })
                .finally(function () {
                    vm.isBusy = false;
                });
        };

        vm.undoDelete = function () {
            var roles = [];

            _.forEach(vm.lastDeleted.roles, function (role) {
                roles.push(role.name);
                logger.log('role', role.name);
            });
            vm.lastDeleted.roles = roles;
            vm.lastDeleted.password = defaults.GENERIC_PASSWORD;

            service.create(vm.lastDeleted).then(function (data) {
                logger.success('Successfully restored ' + data.userName);
                vm.users.unshift(data);
                vm.lastDeleted = null;
            });
        };

        vm.undoChange = function () {
            vm.isBusy = true;

            service.update(vm.lastUpdated)
                .then(function (data) {
                    angular.forEach(vm.users,
                        function (u, i) {
                            if (u.id === vm.lastUpdated.id) {
                                vm.users[i] = vm.lastUpdated;
                            }
                        });
                    logger.success('Successfully restored ' + data.userName);
                    vm.lastUpdated = null;
                })
                .finally(function () {
                    vm.isBusy = false;
                });
        };

        function clearCreate($event) {
            if ($event.keyCode === keyCodes.esc) {
                vm.user.userName = '';
            };
        };

        function parseFullName(name) {
            var arr = name.split('.');
            var fullname = '';

            _.forEach(arr, function (v) {
                fullname += _.capitalize(v) + ' ';
            });

            return _.trim(fullname);
        };
    };
})();
//# sourceMappingURL=data:application/json;base64,eyJ2ZXJzaW9uIjozLCJzb3VyY2VzIjpbImFwcC5tb2R1bGUuanMiLCJjb3JlL2NvcmUubW9kdWxlLmpzIiwiY29yZS9jb25maWcuanMiLCJibG9ja3MvZXhjZXB0aW9uL2V4Y2VwdGlvbi5tb2R1bGUuanMiLCJibG9ja3MvbG9nZ2VyL2xvZ2dlci5tb2R1bGUuanMiLCJldmVudHMvZXZlbnQubW9kdWxlLmpzIiwiZmlsdGVycy9maWx0ZXIubW9kdWxlLmpzIiwibWFpbGVycy9tYWlsZXJzLm1vZHVsZS5qcyIsIm5hdi9uYXYubW9kdWxlLmpzIiwic2VydmljZXMvc2VydmljZS5tb2R1bGUuanMiLCJ0YXgvdGF4Lm1vZHVsZS5qcyIsInRlbXBsYXRlcy90ZW1wbGF0ZS5tb2R1bGUuanMiLCJ1c2Vycy91c2Vycy5tb2R1bGUuanMiLCJibG9ja3MvZXhjZXB0aW9uL2V4Y2VwdGlvbi1oYW5kbGVyLnByb3ZpZGVyLmpzIiwiYmxvY2tzL2V4Y2VwdGlvbi9leGNlcHRpb24uanMiLCJibG9ja3MvbG9nZ2VyL2xvZ2dlci5qcyIsImRpcmVjdGl2ZXMvY2xlYXIta2V5LmRpcmVjdGl2ZS5qcyIsImRpcmVjdGl2ZXMvZGF0ZS1mb3JtYXQuZGlyZWN0aXZlLmpzIiwiZGlyZWN0aXZlcy9kYXRlLWlucHV0LmRpcmVjdGl2ZS5qcyIsImRpcmVjdGl2ZXMvc21hcnQtdGFibGUuZGlyZWN0aXZlLmpzIiwiZGlyZWN0aXZlcy90b2dnbGVDaGVja2JveC5kaXJlY3RpdmUuanMiLCJldmVudHMvZWRpdEd1ZXN0LmNvbnRyb2xsZXIuanMiLCJldmVudHMvZXZlbnRzLmpzIiwiZmlsdGVycy9hcHAuZmlsdGVycy5qcyIsIm1haWxlcnMvbWFpbGVycy5qcyIsIm5hdi9uYXYuanMiLCJzZXJ2aWNlcy9jYW1wYWlnbi5zZXJ2aWNlLmpzIiwic2VydmljZXMvY29uc3RpdHVlbnQuc2VydmljZS5qcyIsInNlcnZpY2VzL2V2ZW50LnNlcnZpY2UuanMiLCJzZXJ2aWNlcy9maWxlLnNlcnZpY2UuanMiLCJzZXJ2aWNlcy9ndWVzdC5zZXJ2aWNlLmpzIiwic2VydmljZXMvbWFpbGVyLnNlcnZpY2UuanMiLCJzZXJ2aWNlcy9yZWFzb24uc2VydmljZS5qcyIsInNlcnZpY2VzL3RheC5zZXJ2aWNlLmpzIiwic2VydmljZXMvdGVtcGxhdGUuc2VydmljZS5qcyIsInNlcnZpY2VzL3VzZXIuc2VydmljZS5qcyIsInRheC9tYW5hZ2VyLmpzIiwidGVtcGxhdGVzL3RlbXBsYXRlLmpzIiwidXNlcnMvdXNlcnMuanMiXSwibmFtZXMiOltdLCJtYXBwaW5ncyI6IkFBQUE7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQ25CQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUNoQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUN6REE7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FDTEE7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQ0pBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQ0xBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQ0xBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQ0xBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQ0xBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQ0xBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQ0xBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUNQQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FDSkE7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FDcEVBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FDeEJBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUM5Q0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUNsQkE7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FDakJBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQ2hDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQ3JCQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FDakRBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FDcENBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQzdXQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQ2pDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQ2xIQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FDdEJBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FDN0NBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FDL0RBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUNuRUE7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FDbkNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUNuRUE7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUM3Q0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUM3Q0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUN0REE7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUM3Q0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FDM0RBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FDblBBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUMxREE7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0EiLCJmaWxlIjoibW9kdWxlcy5taW4uanMiLCJzb3VyY2VzQ29udGVudCI6WyIvL21hcmsubGF3cmVuY2VcclxuLy9hcHAubW9kdWxlLmpzXHJcblxyXG4oZnVuY3Rpb24gKCkge1xyXG4gICAgYW5ndWxhci5tb2R1bGUoJ2FwcCcsXHJcbiAgICBbXHJcbiAgICAgICAgLy9hcHBsaWNhdGlvbiBtb2R1bGVzXHJcbiAgICAgICAgJ2FwcC5jb3JlJyxcclxuICAgICAgICAnYXBwLnNlcnZpY2UnLFxyXG4gICAgICAgICdhcHAuZmlsdGVyJyxcclxuXHJcbiAgICAgICAgLy9mZWF0dXJlIGFyZWFzXHJcbiAgICAgICAgJ2FwcC5uYXYnLFxyXG4gICAgICAgICdhcHAudXNlcnMnLFxyXG4gICAgICAgICdhcHAudGF4JyxcclxuICAgICAgICAnYXBwLnRlbXBsYXRlJyxcclxuICAgICAgICAnYXBwLm1haWxlcnMnLFxyXG4gICAgICAgICdhcHAuZXZlbnRzJ1xyXG4gICAgXSk7XHJcbn0pKCk7IiwiLy9jb3JlLm1vZHVsZS5qc1xyXG4vL21hcmsubGF3cmVuY2VcclxuXHJcbihmdW5jdGlvbiAoKSB7XHJcbiAgICBhbmd1bGFyLm1vZHVsZSgnYXBwLmNvcmUnLFxyXG4gICAgICAgIFtcclxuICAgICAgICAgICAgLy9hbmd1bGFyIG1vZHVsZXNcclxuICAgICAgICAgICAgJ25nTWVzc2FnZXMnLFxyXG4gICAgICAgICAgICAnYW5ndWxhckxvY2FsU3RvcmFnZScsXHJcbiAgICAgICAgICAgICduZ1JvdXRlJyxcclxuICAgICAgICAgICAgJ25nQW5pbWF0ZScsXHJcblxyXG4gICAgICAgICAgICAvL2N1c3RvbSBtb2R1bGVzXHJcbiAgICAgICAgICAgICdibG9ja3MubG9nZ2VyJyxcclxuICAgICAgICAgICAgJ2Jsb2Nrcy5leGNlcHRpb24nLFxyXG5cclxuICAgICAgICAgICAgLy90aGlyZCBwYXJ0eSBtb2R1bGVzXHJcbiAgICAgICAgICAgICdzbWFydC10YWJsZScsXHJcbiAgICAgICAgICAgICd1aS5ib290c3RyYXAnLFxyXG4gICAgICAgICAgICAnbmdUYWdzSW5wdXQnLFxyXG4gICAgICAgICAgICAnbmdGaWxlVXBsb2FkJyxcclxuICAgICAgICAgICAgJ3J6TW9kdWxlJyxcclxuICAgICAgICAgICAgJ3N3aXRjaGVyJyxcclxuICAgICAgICAgICAgJ2dmbC50ZXh0QXZhdGFyJyxcclxuICAgICAgICAgICAgJ3RleHRBbmd1bGFyJyxcclxuICAgICAgICAgICAgJ3VpLmJvb3RzdHJhcC5kYXRldGltZXBpY2tlcicsIFxyXG4gICAgICAgICAgICAnYW5ndWxhci1jb25maXJtJ1xyXG4gICAgICAgICAgICAvLyduZy1maWxlLWlucHV0J1xyXG4gICAgICAgIF0pXHJcbiAgICAgICAgLmNvbnN0YW50KCd0b2FzdHInLCB0b2FzdHIpXHJcbiAgICAgICAgLmNvbnN0YW50KCdtb21lbnQnLCBtb21lbnQpO1xyXG5cclxufSkoKTsiLCIvL2NvbmZpZy5qc1xyXG4vL21hcmsubGF3cmVuY2VcclxuKGZ1bmN0aW9uICgpIHtcclxuICAgIGZ1bmN0aW9uIHRvYXN0ckNvbmZpZyh0b2FzdHIpIHtcclxuICAgICAgICB0b2FzdHIub3B0aW9ucy50aW1lT3V0ID0gNDAwMDtcclxuICAgICAgICB0b2FzdHIub3B0aW9ucy5wb3NpdGlvbkNsYXNzID0gJ3RvYXN0LWJvdHRvbS1yaWdodCc7XHJcbiAgICB9O1xyXG5cclxuICAgIHZhciBrZXlDb2RlcyA9IHtcclxuICAgICAgICBiYWNrc3BhY2U6IDgsXHJcbiAgICAgICAgdGFiOiA5LFxyXG4gICAgICAgIGVudGVyOiAxMyxcclxuICAgICAgICBlc2M6IDI3LFxyXG4gICAgICAgIHNwYWNlOiAzMixcclxuICAgICAgICBwYWdldXA6IDMzLFxyXG4gICAgICAgIHBhZ2Vkb3duOiAzNCxcclxuICAgICAgICBlbmQ6IDM1LFxyXG4gICAgICAgIGhvbWU6IDM2LFxyXG4gICAgICAgIGxlZnQ6IDM3LFxyXG4gICAgICAgIHVwOiAzOCxcclxuICAgICAgICByaWdodDogMzksXHJcbiAgICAgICAgZG93bjogNDAsXHJcbiAgICAgICAgaW5zZXJ0OiA0NSxcclxuICAgICAgICBkZWw6IDQ2XHJcbiAgICB9O1xyXG5cclxuICAgIHZhciBhcGlFbmRQb2ludHMgPSB7XHJcbiAgICAgICAgVXNlcjogJ3VzZXJzJyxcclxuICAgICAgICBDb25zdGl0dWVudDogJ2NvbnN0aXR1ZW50JyxcclxuICAgICAgICBUYXg6ICd0YXgnLFxyXG4gICAgICAgIFRlbXBsYXRlOiAndGVtcGxhdGUnLFxyXG4gICAgICAgIENhbXBhaWduOiAnY2FtcGFpZ24nLFxyXG4gICAgICAgIE1haWxlcjogJ21haWxlcicsXHJcbiAgICAgICAgUmVhc29uOiAncmVhc29uJyxcclxuICAgICAgICBFdmVudDogJ2V2ZW50JyxcclxuICAgICAgICBHdWVzdDogJ2d1ZXN0JyxcclxuICAgICAgICBGaWxlOiAnZmlsZSdcclxuICAgIH07XHJcblxyXG4gICAgdmFyIGNvbmZpZyA9IHtcclxuICAgICAgICBhcHBFcnJvclByZWZpeDogJ1tERyBFcnJvcl0gJywgLy9Db25maWd1cmUgdGhlIGV4Y2VwdGlvbkhhbmRsZXIgZGVjb3JhdG9yXHJcbiAgICAgICAgYXBwVGl0bGU6ICdEb25vckdhdGV3YXknLFxyXG4gICAgICAgIHZlcnNpb246ICcxLjAuMCcsXHJcbiAgICAgICAgYXBpVXJsOiAnaHR0cDovLycgKyB3aW5kb3cubG9jYXRpb24uaG9zdCArICcvYXBpLycsXHJcbiAgICAgICAga2V5Q29kZXM6IGtleUNvZGVzLFxyXG4gICAgICAgIGFwaUVuZFBvaW50czogYXBpRW5kUG9pbnRzXHJcbiAgICB9O1xyXG5cclxuICAgIHZhciBkZWZhdWx0cyA9IHtcclxuICAgICAgICBFTUFJTF9TVUZGSVg6ICdAc3BsY2VudGVyLm9yZycsXHJcbiAgICAgICAgR0VORVJJQ19QQVNTV09SRDogJzFQQHNzd29yZCdcclxuICAgIH07XHJcblxyXG4gICAgYW5ndWxhci5tb2R1bGUoJ2FwcC5jb3JlJylcclxuICAgICAgICAuY29uZmlnKHRvYXN0ckNvbmZpZylcclxuICAgICAgICAuY29uc3RhbnQoJ2NvbmZpZycsIGNvbmZpZylcclxuICAgICAgICAudmFsdWUoJ2RlZmF1bHRzJywgZGVmYXVsdHMpO1xyXG59KSgpOyIsIi8vbWFyay5sYXdyZW5jZVxyXG4vL2V4Y2VwdGlvbi5tb2R1bGUuanNcclxuXHJcbihmdW5jdGlvbiAoKSB7XHJcbiAgICBhbmd1bGFyLm1vZHVsZSgnYmxvY2tzLmV4Y2VwdGlvbicsIFsnYmxvY2tzLmxvZ2dlciddKTtcclxufSkoKTsiLCIoZnVuY3Rpb24gKCkge1xyXG4gICAgJ3VzZSBzdHJpY3QnO1xyXG5cclxuICAgIGFuZ3VsYXIubW9kdWxlKCdibG9ja3MubG9nZ2VyJywgW10pO1xyXG59KSgpOyIsIi8vbWFyay5sYXdyZW5jZVxyXG4vL2V2ZW50Lm1vZHVsZS5qc1xyXG5cclxuKGZ1bmN0aW9uICgpIHtcclxuICAgIGFuZ3VsYXIubW9kdWxlKCdhcHAuZXZlbnRzJywgW10pO1xyXG59KSgpOyIsIi8vZmlsdGVyLm1vZHVsZS5qc1xyXG4vL21hcmsubGF3cmVuY2VcclxuXHJcbihmdW5jdGlvbiAoKSB7XHJcbiAgICBhbmd1bGFyLm1vZHVsZSgnYXBwLmZpbHRlcicsIFtdKTtcclxufSkoKTsiLCIvL21hcmsubGF3cmVuY2VcclxuLy9tYWlsZXJzLm1vZHVsZS5qc1xyXG5cclxuKGZ1bmN0aW9uICgpIHtcclxuICAgIGFuZ3VsYXIubW9kdWxlKCdhcHAubWFpbGVycycsIFtdKTtcclxufSkoKTsiLCIvL21hcmsubGF3cmVuY2VcclxuLy9uYXYubW9kdWxlLmpzXHJcblxyXG4oZnVuY3Rpb24gKCkge1xyXG4gICAgYW5ndWxhci5tb2R1bGUoJ2FwcC5uYXYnLCBbXSk7XHJcbn0pKCk7IiwiLy9zZXJ2aWNlLm1vZHVsZS5qc1xyXG4vL21hcmsubGF3cmVuY2VcclxuXHJcbihmdW5jdGlvbiAoKSB7XHJcbiAgICBhbmd1bGFyLm1vZHVsZSgnYXBwLnNlcnZpY2UnLCBbXSk7XHJcbn0pKCk7IiwiLy90YXgubW9kdWxlLmpzXHJcbi8vbWFyay5sYXdyZW5jZVxyXG5cclxuKGZ1bmN0aW9uICgpIHtcclxuICAgIGFuZ3VsYXIubW9kdWxlKCdhcHAudGF4JywgW10pO1xyXG59KSgpOyIsIi8vbWFyay5sYXdyZW5jZVxyXG4vL3RlbXBsYXRlLm1vZHVsZS5qc1xyXG5cclxuKGZ1bmN0aW9uICgpIHtcclxuICAgIChmdW5jdGlvbiAoKSB7XHJcbiAgICAgICAgYW5ndWxhci5tb2R1bGUoJ2FwcC50ZW1wbGF0ZScsIFtdKTtcclxuICAgIH0pKCk7XHJcbn0pKCk7IiwiKGZ1bmN0aW9uICgpIHtcclxuICAgICd1c2Ugc3RyaWN0JztcclxuXHJcbiAgICBhbmd1bGFyLm1vZHVsZSgnYXBwLnVzZXJzJywgW10pO1xyXG59KSgpOyIsIi8vbWFyay5sYXdyZW5jZVxyXG4vL2V4Y2VwdGlvbi1oYW5kbGVyLnByb3ZpZGVyLmpzXHJcblxyXG4vLyBJbmNsdWRlIGluIGluZGV4Lmh0bWwgc28gdGhhdCBhcHAgbGV2ZWwgZXhjZXB0aW9ucyBhcmUgaGFuZGxlZC5cclxuLy8gRXhjbHVkZSBmcm9tIHRlc3RSdW5uZXIuaHRtbCB3aGljaCBzaG91bGQgcnVuIGV4YWN0bHkgd2hhdCBpdCB3YW50cyB0byBydW5cclxuKGZ1bmN0aW9uICgpIHtcclxuICAgICd1c2Ugc3RyaWN0JztcclxuXHJcbiAgICBhbmd1bGFyXHJcbiAgICAgICAgLm1vZHVsZSgnYmxvY2tzLmV4Y2VwdGlvbicpXHJcbiAgICAgICAgLnByb3ZpZGVyKCdleGNlcHRpb25IYW5kbGVyJywgZXhjZXB0aW9uSGFuZGxlclByb3ZpZGVyKVxyXG4gICAgICAgIC5jb25maWcoY29uZmlnKTtcclxuXHJcbiAgICAvKipcclxuICAgICAqIE11c3QgY29uZmlndXJlIHRoZSBleGNlcHRpb24gaGFuZGxpbmdcclxuICAgICAqIEByZXR1cm4ge1t0eXBlXX1cclxuICAgICAqL1xyXG4gICAgZnVuY3Rpb24gZXhjZXB0aW9uSGFuZGxlclByb3ZpZGVyKCkge1xyXG4gICAgICAgIC8qIGpzaGludCB2YWxpZHRoaXM6dHJ1ZSAqL1xyXG4gICAgICAgIHRoaXMuY29uZmlnID0ge1xyXG4gICAgICAgICAgICBhcHBFcnJvclByZWZpeDogdW5kZWZpbmVkXHJcbiAgICAgICAgfTtcclxuXHJcbiAgICAgICAgdGhpcy5jb25maWd1cmUgPSBmdW5jdGlvbiAoYXBwRXJyb3JQcmVmaXgpIHtcclxuICAgICAgICAgICAgdGhpcy5jb25maWcuYXBwRXJyb3JQcmVmaXggPSBhcHBFcnJvclByZWZpeDtcclxuICAgICAgICB9O1xyXG5cclxuICAgICAgICB0aGlzLiRnZXQgPSBmdW5jdGlvbiAoKSB7XHJcbiAgICAgICAgICAgIHJldHVybiB7IGNvbmZpZzogdGhpcy5jb25maWcgfTtcclxuICAgICAgICB9O1xyXG4gICAgfTtcclxuXHJcbiAgICAvKipcclxuICAgICAqIENvbmZpZ3VyZSBieSBzZXR0aW5nIGFuIG9wdGlvbmFsIHN0cmluZyB2YWx1ZSBmb3IgYXBwRXJyb3JQcmVmaXguXHJcbiAgICAgKiBBY2Nlc3NpYmxlIHZpYSBjb25maWcuYXBwRXJyb3JQcmVmaXggKHZpYSBjb25maWcgdmFsdWUpLlxyXG4gICAgICogQHBhcmFtICB7W3R5cGVdfSAkcHJvdmlkZVxyXG4gICAgICogQHJldHVybiB7W3R5cGVdfVxyXG4gICAgICogQG5nSW5qZWN0XHJcbiAgICAgKi9cclxuICAgIGZ1bmN0aW9uIGNvbmZpZygkcHJvdmlkZSkge1xyXG4gICAgICAgICRwcm92aWRlLmRlY29yYXRvcignJGV4Y2VwdGlvbkhhbmRsZXInLCBleHRlbmRFeGNlcHRpb25IYW5kbGVyKTtcclxuICAgIH07XHJcblxyXG4gICAgLyoqXHJcbiAgICAgKiBFeHRlbmQgdGhlICRleGNlcHRpb25IYW5kbGVyIHNlcnZpY2UgdG8gYWxzbyBkaXNwbGF5IGEgdG9hc3QuXHJcbiAgICAgKiBAcGFyYW0gIHtPYmplY3R9ICRkZWxlZ2F0ZVxyXG4gICAgICogQHBhcmFtICB7T2JqZWN0fSBleGNlcHRpb25IYW5kbGVyXHJcbiAgICAgKiBAcGFyYW0gIHtPYmplY3R9IGxvZ2dlclxyXG4gICAgICogQHJldHVybiB7RnVuY3Rpb259IHRoZSBkZWNvcmF0ZWQgJGV4Y2VwdGlvbkhhbmRsZXIgc2VydmljZVxyXG4gICAgICovXHJcbiAgICBmdW5jdGlvbiBleHRlbmRFeGNlcHRpb25IYW5kbGVyKCRkZWxlZ2F0ZSwgZXhjZXB0aW9uSGFuZGxlciwgbG9nZ2VyKSB7XHJcbiAgICAgICAgcmV0dXJuIGZ1bmN0aW9uIChleGNlcHRpb24sIGNhdXNlKSB7XHJcbiAgICAgICAgICAgIHZhciBhcHBFcnJvclByZWZpeCA9IGV4Y2VwdGlvbkhhbmRsZXIuY29uZmlnLmFwcEVycm9yUHJlZml4IHx8ICcnO1xyXG4gICAgICAgICAgICB2YXIgZXJyb3JEYXRhID0geyBleGNlcHRpb246IGV4Y2VwdGlvbiwgY2F1c2U6IGNhdXNlIH07XHJcbiAgICAgICAgICAgIGV4Y2VwdGlvbi5tZXNzYWdlID0gYXBwRXJyb3JQcmVmaXggKyBleGNlcHRpb24ubWVzc2FnZTtcclxuICAgICAgICAgICAgJGRlbGVnYXRlKGV4Y2VwdGlvbiwgY2F1c2UpO1xyXG4gICAgICAgICAgICAvKipcclxuICAgICAgICAgICAgICogQ291bGQgYWRkIHRoZSBlcnJvciB0byBhIHNlcnZpY2UncyBjb2xsZWN0aW9uLFxyXG4gICAgICAgICAgICAgKiBhZGQgZXJyb3JzIHRvICRyb290U2NvcGUsIGxvZyBlcnJvcnMgdG8gcmVtb3RlIHdlYiBzZXJ2ZXIsXHJcbiAgICAgICAgICAgICAqIG9yIGxvZyBsb2NhbGx5LiBPciB0aHJvdyBoYXJkLiBJdCBpcyBlbnRpcmVseSB1cCB0byB5b3UuXHJcbiAgICAgICAgICAgICAqIHRocm93IGV4Y2VwdGlvbjtcclxuICAgICAgICAgICAgICpcclxuICAgICAgICAgICAgICogQGV4YW1wbGVcclxuICAgICAgICAgICAgICogICAgIHRocm93IHsgbWVzc2FnZTogJ2Vycm9yIG1lc3NhZ2Ugd2UgYWRkZWQnIH07XHJcbiAgICAgICAgICAgICAqL1xyXG4gICAgICAgICAgICBsb2dnZXIuZXJyb3IoZXhjZXB0aW9uLm1lc3NhZ2UsIGVycm9yRGF0YSk7XHJcbiAgICAgICAgfTtcclxuICAgIH07XHJcbn0pKCk7IiwiLy9tYXJrLmxhd3JlbmNlXHJcbi8vZXhjZXB0aW9uLmpzXHJcblxyXG4oZnVuY3Rpb24gKCkge1xyXG4gICAgJ3VzZSBzdHJpY3QnO1xyXG5cclxuICAgIGFuZ3VsYXJcclxuICAgICAgICAubW9kdWxlKCdibG9ja3MuZXhjZXB0aW9uJylcclxuICAgICAgICAuZmFjdG9yeSgnZXhjZXB0aW9uJywgZXhjZXB0aW9uKTtcclxuXHJcbiAgICAvKiBAbmdJbmplY3QgKi9cclxuICAgIGZ1bmN0aW9uIGV4Y2VwdGlvbihsb2dnZXIpIHtcclxuICAgICAgICB2YXIgc2VydmljZSA9IHtcclxuICAgICAgICAgICAgY2F0Y2hlcjogY2F0Y2hlclxyXG4gICAgICAgIH07XHJcblxyXG4gICAgICAgIHJldHVybiBzZXJ2aWNlO1xyXG5cclxuICAgICAgICBmdW5jdGlvbiBjYXRjaGVyKG1lc3NhZ2UpIHtcclxuICAgICAgICAgICAgcmV0dXJuIGZ1bmN0aW9uIChyZWFzb24pIHtcclxuICAgICAgICAgICAgICAgIGxvZ2dlci5lcnJvcihtZXNzYWdlLCByZWFzb24pO1xyXG4gICAgICAgICAgICB9O1xyXG4gICAgICAgIH07XHJcbiAgICB9O1xyXG59KSgpOyIsIi8vbWFyay5sYXdyZW5jZVxyXG4vL2xvZ2dlci5qc1xyXG5cclxuKGZ1bmN0aW9uICgpIHtcclxuICAgICd1c2Ugc3RyaWN0JztcclxuXHJcbiAgICBhbmd1bGFyLm1vZHVsZSgnYmxvY2tzLmxvZ2dlcicpLmZhY3RvcnkoJ2xvZ2dlcicsIGxvZ2dlcik7XHJcblxyXG4gICAgbG9nZ2VyLiRpbmplY3QgPSBbJyRsb2cnLCAndG9hc3RyJ107XHJcblxyXG4gICAgZnVuY3Rpb24gbG9nZ2VyKCRsb2csIHRvYXN0cikge1xyXG4gICAgICAgIHZhciBzZXJ2aWNlID0ge1xyXG4gICAgICAgICAgICBzaG93VG9hc3RzOiB0cnVlLFxyXG5cclxuICAgICAgICAgICAgZXJyb3I6IGVycm9yLFxyXG4gICAgICAgICAgICBpbmZvOiBpbmZvLFxyXG4gICAgICAgICAgICBzdWNjZXNzOiBzdWNjZXNzLFxyXG4gICAgICAgICAgICB3YXJuaW5nOiB3YXJuaW5nLFxyXG5cclxuICAgICAgICAgICAgLy8gc3RyYWlnaHQgdG8gY29uc29sZTsgYnlwYXNzIHRvYXN0clxyXG4gICAgICAgICAgICBsb2c6ICRsb2cubG9nXHJcbiAgICAgICAgfTtcclxuXHJcbiAgICAgICAgcmV0dXJuIHNlcnZpY2U7XHJcbiAgICAgICAgLy8vLy8vLy8vLy8vLy8vLy8vLy8vXHJcblxyXG4gICAgICAgIGZ1bmN0aW9uIGVycm9yKG1lc3NhZ2UsIGRhdGEsIHRpdGxlKSB7XHJcbiAgICAgICAgICAgIHRvYXN0ci5lcnJvcihtZXNzYWdlLCB0aXRsZSk7XHJcbiAgICAgICAgICAgICRsb2cuZXJyb3IoJ0Vycm9yOiAnICsgbWVzc2FnZSwgZGF0YSk7XHJcbiAgICAgICAgfTtcclxuXHJcbiAgICAgICAgZnVuY3Rpb24gaW5mbyhtZXNzYWdlLCBkYXRhLCB0aXRsZSkge1xyXG4gICAgICAgICAgICB0b2FzdHIuaW5mbyhtZXNzYWdlLCB0aXRsZSk7XHJcbiAgICAgICAgICAgICRsb2cuaW5mbygnSW5mbzogJyArIG1lc3NhZ2UsIGRhdGEpO1xyXG4gICAgICAgIH07XHJcblxyXG4gICAgICAgIGZ1bmN0aW9uIHN1Y2Nlc3MobWVzc2FnZSwgZGF0YSwgdGl0bGUpIHtcclxuICAgICAgICAgICAgdG9hc3RyLnN1Y2Nlc3MobWVzc2FnZSwgdGl0bGUpO1xyXG4gICAgICAgICAgICAkbG9nLmluZm8oJ1N1Y2Nlc3M6ICcgKyBtZXNzYWdlLCBkYXRhKTtcclxuICAgICAgICB9O1xyXG5cclxuICAgICAgICBmdW5jdGlvbiB3YXJuaW5nKG1lc3NhZ2UsIGRhdGEsIHRpdGxlKSB7XHJcbiAgICAgICAgICAgIHRvYXN0ci53YXJuaW5nKG1lc3NhZ2UsIHRpdGxlKTtcclxuICAgICAgICAgICAgJGxvZy53YXJuKCdXYXJuaW5nOiAnICsgbWVzc2FnZSwgZGF0YSk7XHJcbiAgICAgICAgfTtcclxuICAgIH07XHJcbn0pKCk7IiwiLy9tYXJrLmxhd3JlbmNlXHJcbi8vY2xlYXIta2V5LmRpcmVjdGl2ZS5qc1xyXG5cclxuKGZ1bmN0aW9uICgpIHtcclxuICAgIGFuZ3VsYXIubW9kdWxlKCdhcHAnKS5kaXJlY3RpdmUoXCJjbGVhcktleVwiLCBmdW5jdGlvbiAoKSB7XHJcbiAgICAgICAgcmV0dXJuIHtcclxuICAgICAgICAgICAgcmVzdHJpY3Q6ICdFQScsXHJcbiAgICAgICAgICAgIHJlcXVpcmU6ICduZ01vZGVsJyxcclxuICAgICAgICAgICAgbGluazogZnVuY3Rpb24gKHNjb3BlLCBlbCwgYXR0cnMsIGN0cmwpIHtcclxuICAgICAgICAgICAgICAgIGVsLm9uKCdrZXlkb3duJywgZnVuY3Rpb24gKGV2ZW50KSB7XHJcbiAgICAgICAgICAgICAgICAgICAgaWYgKGV2ZW50LndoaWNoICE9PSAyNykgeyByZXR1cm47IH0gLy8gY2hlY2sga2V5IGhvdyB5b3Ugd2FudFxyXG4gICAgICAgICAgICAgICAgICAgIGN0cmwuJHNldFZpZXdWYWx1ZShudWxsKTtcclxuICAgICAgICAgICAgICAgICAgICBjdHJsLiRyZW5kZXIoKTtcclxuICAgICAgICAgICAgICAgICAgICBzY29wZS4kYXBwbHkoKTtcclxuICAgICAgICAgICAgICAgIH0pO1xyXG4gICAgICAgICAgICB9XHJcbiAgICAgICAgfTtcclxuICAgIH0pO1xyXG59KSgpOyIsIi8vbWFyay5sYXdyZW5jZVxyXG4vL2RhdGUtZm9ybWF0LmRpcmVjdGl2ZS5qc1xyXG5cclxuKGZ1bmN0aW9uICgpIHtcclxuICAgIGFuZ3VsYXIubW9kdWxlKCdhcHAnKVxyXG4gICAgICAgIC5kaXJlY3RpdmUoJ2RhdGVGb3JtYXQnLFxyXG4gICAgICAgICAgICBmdW5jdGlvbiAoZGF0ZUZpbHRlciwgJHBhcnNlKSB7XHJcbiAgICAgICAgICAgICAgICByZXR1cm4ge1xyXG4gICAgICAgICAgICAgICAgICAgIHJlc3RyaWN0OiAnRUFDJyxcclxuICAgICAgICAgICAgICAgICAgICByZXF1aXJlOiAnP25nTW9kZWwnLFxyXG4gICAgICAgICAgICAgICAgICAgIGxpbms6IGZ1bmN0aW9uIChzY29wZSwgZWxlbWVudCwgYXR0cnMsIG5nTW9kZWwsIGN0cmwpIHtcclxuICAgICAgICAgICAgICAgICAgICAgICAgbmdNb2RlbC4kcGFyc2Vycy5wdXNoKGZ1bmN0aW9uICh2aWV3VmFsdWUpIHtcclxuICAgICAgICAgICAgICAgICAgICAgICAgICAgIHJldHVybiBkYXRlRmlsdGVyKHZpZXdWYWx1ZSwgJ01NL2RkL3l5eXkgaDptbSBhJyk7XHJcbiAgICAgICAgICAgICAgICAgICAgICAgIH0pO1xyXG4gICAgICAgICAgICAgICAgICAgIH1cclxuICAgICAgICAgICAgICAgIH1cclxuICAgICAgICAgICAgfSk7XHJcbn0pKCk7IiwiLy9tYXJrLmxhd3JlbmNlXHJcbi8vZGF0ZS1pbnB1dC5kaXJlY3RpdmUuanNcclxuXHJcbihmdW5jdGlvbiAoKSB7XHJcbiAgICBhbmd1bGFyLm1vZHVsZSgnYXBwJykuZGlyZWN0aXZlKCdkYXRlSW5wdXQnLCBmdW5jdGlvbiAoJHdpbmRvdykge1xyXG4gICAgICAgIHJldHVybiB7XHJcbiAgICAgICAgICAgIHJlcXVpcmU6ICdebmdNb2RlbCcsXG4gICAgICAgICAgICByZXN0cmljdDogJ0EnLFxuICAgICAgICAgICAgbGluazogZnVuY3Rpb24gKHNjb3BlLCBlbG0sIGF0dHJzLCBjdHJsKSB7XHJcbiAgICAgICAgICAgICAgICB2YXIgbW9tZW50ID0gJHdpbmRvdy5tb21lbnQ7XG4gICAgICAgICAgICAgICAgdmFyIGRhdGVGb3JtYXQgPSBhdHRycy5kYXRlSW5wdXQ7XHJcbiAgICAgICAgICAgICAgICBhdHRycy4kb2JzZXJ2ZSgnZGF0ZUlucHV0JywgZnVuY3Rpb24gKG5ld1ZhbHVlKSB7XHJcbiAgICAgICAgICAgICAgICAgICAgaWYgKGRhdGVGb3JtYXQgPT0gbmV3VmFsdWUgfHwgIWN0cmwuJG1vZGVsVmFsdWUpIHJldHVybjtcbiAgICAgICAgICAgICAgICAgICAgZGF0ZUZvcm1hdCA9IG5ld1ZhbHVlO1xuICAgICAgICAgICAgICAgICAgICBjdHJsLiRtb2RlbFZhbHVlID0gbmV3IERhdGUoY3RybC4kc2V0Vmlld1ZhbHVlKTtcclxuICAgICAgICAgICAgICAgIH0pO1xuXG4gICAgICAgICAgICAgICAgY3RybC4kZm9ybWF0dGVycy51bnNoaWZ0KGZ1bmN0aW9uIChtb2RlbFZhbHVlKSB7XHJcbiAgICAgICAgICAgICAgICAgICAgc2NvcGUgPSBzY29wZTtcbiAgICAgICAgICAgICAgICAgICAgaWYgKCFkYXRlRm9ybWF0IHx8ICFtb2RlbFZhbHVlKSByZXR1cm4gXCJcIjtcbiAgICAgICAgICAgICAgICAgICAgdmFyIHJldFZhbCA9IG1vbWVudChtb2RlbFZhbHVlKS5mb3JtYXQoZGF0ZUZvcm1hdCk7XG4gICAgICAgICAgICAgICAgICAgIHJldHVybiByZXRWYWw7XHJcbiAgICAgICAgICAgICAgICB9KTtcblxuICAgICAgICAgICAgICAgIGN0cmwuJHBhcnNlcnMudW5zaGlmdChmdW5jdGlvbiAodmlld1ZhbHVlKSB7XHJcbiAgICAgICAgICAgICAgICAgICAgc2NvcGUgPSBzY29wZTtcbiAgICAgICAgICAgICAgICAgICAgdmFyIGRhdGUgPSBtb21lbnQodmlld1ZhbHVlLCBkYXRlRm9ybWF0KTtcbiAgICAgICAgICAgICAgICAgICAgcmV0dXJuIChkYXRlICYmIGRhdGUuaXNWYWxpZCgpICYmIGRhdGUueWVhcigpID4gMTk1MCkgPyBkYXRlLnRvRGF0ZSgpIDogXCJcIjtcclxuICAgICAgICAgICAgICAgIH0pO1xyXG4gICAgICAgICAgICB9XHJcbiAgICAgICAgfTtcclxuICAgIH0pO1xyXG59KSgpOyIsIi8vbWFyay5sYXdyZW5jZVxyXG4vL3NtYXJ0LXRhYmxlLmNsZWFyS2V5LmpzXHJcblxyXG4oZnVuY3Rpb24gKCkge1xyXG4gICAgYW5ndWxhci5tb2R1bGUoJ2FwcCcpLmRpcmVjdGl2ZShcInN0Q2xlYXJLZXlcIiwgZnVuY3Rpb24gKCkge1xyXG4gICAgICAgIHJldHVybiB7XHJcbiAgICAgICAgICAgIHJlc3RyaWN0OiAnRUEnLFxyXG4gICAgICAgICAgICByZXF1aXJlOiAnXnN0VGFibGUnLFxyXG4gICAgICAgICAgICBsaW5rOiBmdW5jdGlvbiAoc2NvcGUsIGVsZW1lbnQsIGF0dHJzLCBjdHJsKSB7XHJcbiAgICAgICAgICAgICAgICBlbGVtZW50Lm9uKCdrZXlkb3duJywgZnVuY3Rpb24gKGV2ZW50KSB7XHJcbiAgICAgICAgICAgICAgICAgICAgaWYgKGV2ZW50LndoaWNoICE9PSAyNykgeyByZXR1cm47IH0gLy8gY2hlY2sga2V5IGhvdyB5b3Ugd2FudFxyXG4gICAgICAgICAgICAgICAgICAgIHJldHVybiBzY29wZS4kYXBwbHkoZnVuY3Rpb24gKCkge1xyXG4gICAgICAgICAgICAgICAgICAgICAgICB2YXIgZmllbGROYW1lID0gZWxlbWVudC5jb250ZXh0LmF0dHJpYnV0ZXNbJ3N0LXNlYXJjaCddLnZhbHVlO1xyXG4gICAgICAgICAgICAgICAgICAgICAgICB2YXIgdGFibGVTdGF0ZSA9IGN0cmwudGFibGVTdGF0ZSgpO1xyXG4gICAgICAgICAgICAgICAgICAgICAgICB0YWJsZVN0YXRlLnNlYXJjaC5wcmVkaWNhdGVPYmplY3RbZmllbGROYW1lXSA9ICcnO1xyXG4gICAgICAgICAgICAgICAgICAgICAgICByZXR1cm4gY3RybC5waXBlKCk7XHJcbiAgICAgICAgICAgICAgICAgICAgfSk7XHJcbiAgICAgICAgICAgICAgICB9KTtcclxuICAgICAgICAgICAgfVxyXG4gICAgICAgIH07XHJcbiAgICB9KTtcclxufSkoKTsiLCIoZnVuY3Rpb24oKSB7XHJcblxyXG5cclxuICAgIHZhciBhcHAgPSBhbmd1bGFyLm1vZHVsZSgnYXBwJyk7XHJcblxyXG4gICAgYXBwLmRpcmVjdGl2ZSgndG9nZ2xlQ2hlY2tib3gnLCBmdW5jdGlvbigkdGltZW91dCkge1xyXG5cclxuICAgICAgICAvKipcclxuICAgICAqIERpcmVjdGl2ZVxyXG4gICAgICovXHJcbiAgICAgICAgcmV0dXJuIHtcclxuICAgICAgICAgICAgcmVzdHJpY3Q6ICdBJyxcclxuICAgICAgICAgICAgdHJhbnNjbHVkZTogdHJ1ZSxcclxuICAgICAgICAgICAgcmVwbGFjZTogZmFsc2UsXHJcbiAgICAgICAgICAgIHJlcXVpcmU6ICduZ01vZGVsJyxcclxuICAgICAgICAgICAgbGluazogZnVuY3Rpb24oJHNjb3BlLCAkZWxlbWVudCwgJGF0dHIsIG5nTW9kZWwpIHtcclxuXHJcbiAgICAgICAgICAgICAgICAvLyB1cGRhdGUgbW9kZWwgZnJvbSBFbGVtZW50XHJcbiAgICAgICAgICAgICAgICB2YXIgdXBkYXRlTW9kZWxGcm9tRWxlbWVudCA9IGZ1bmN0aW9uKCkge1xyXG4gICAgICAgICAgICAgICAgICAgIC8vIElmIG1vZGlmaWVkXHJcbiAgICAgICAgICAgICAgICAgICAgdmFyIGNoZWNrZWQgPSAkZWxlbWVudC5wcm9wKCdjaGVja2VkJyk7XHJcbiAgICAgICAgICAgICAgICAgICAgaWYgKGNoZWNrZWQgIT0gbmdNb2RlbC4kdmlld1ZhbHVlKSB7XHJcbiAgICAgICAgICAgICAgICAgICAgICAgIC8vIFVwZGF0ZSBuZ01vZGVsXHJcbiAgICAgICAgICAgICAgICAgICAgICAgIG5nTW9kZWwuJHNldFZpZXdWYWx1ZShjaGVja2VkKTtcclxuICAgICAgICAgICAgICAgICAgICAgICAgJHNjb3BlLiRhcHBseSgpO1xyXG4gICAgICAgICAgICAgICAgICAgIH1cclxuICAgICAgICAgICAgICAgIH07XHJcblxyXG4gICAgICAgICAgICAgICAgLy8gVXBkYXRlIGlucHV0IGZyb20gTW9kZWxcclxuICAgICAgICAgICAgICAgIHZhciB1cGRhdGVFbGVtZW50RnJvbU1vZGVsID0gZnVuY3Rpb24obmV3VmFsdWUpIHtcclxuICAgICAgICAgICAgICAgICAgICAkZWxlbWVudC50cmlnZ2VyKCdjaGFuZ2UnKTtcclxuICAgICAgICAgICAgICAgIH07XHJcblxyXG4gICAgICAgICAgICAgICAgLy8gT2JzZXJ2ZTogRWxlbWVudCBjaGFuZ2VzIGFmZmVjdCBNb2RlbFxyXG4gICAgICAgICAgICAgICAgJGVsZW1lbnQub24oJ2NoYW5nZScsIGZ1bmN0aW9uKCkge1xyXG4gICAgICAgICAgICAgICAgICAgIHVwZGF0ZU1vZGVsRnJvbUVsZW1lbnQoKTtcclxuICAgICAgICAgICAgICAgIH0pO1xyXG5cclxuICAgICAgICAgICAgICAgICRzY29wZS4kd2F0Y2goZnVuY3Rpb24oKSB7XHJcbiAgICAgICAgICAgICAgICAgICAgcmV0dXJuIG5nTW9kZWwuJHZpZXdWYWx1ZTtcclxuICAgICAgICAgICAgICAgIH0sIGZ1bmN0aW9uKG5ld1ZhbHVlKSB7XHJcbiAgICAgICAgICAgICAgICAgICAgdXBkYXRlRWxlbWVudEZyb21Nb2RlbChuZXdWYWx1ZSk7XHJcbiAgICAgICAgICAgICAgICB9LCB0cnVlKTtcclxuXHJcbiAgICAgICAgICAgICAgICAvLyBJbml0aWFsaXNlIEJvb3RzdHJhcFRvZ2dsZVxyXG4gICAgICAgICAgICAgICAgJGVsZW1lbnQuYm9vdHN0cmFwVG9nZ2xlKCk7XHJcbiAgICAgICAgICAgIH1cclxuICAgICAgICB9O1xyXG4gICAgfSk7XHJcbn0pKCk7IiwiLy9tYXJrLmxhd3JlbmNlXHJcbi8vZWRpdEd1ZXN0LmNvbnRyb2xsZXIuanNcclxuXHJcbihmdW5jdGlvbiAoKSB7XHJcbiAgICAndXNlIHN0cmljdCc7XHJcblxyXG4gICAgdmFyIGNvbnRyb2xsZXJJZCA9ICdFZGl0R3Vlc3RDb250cm9sbGVyJztcclxuXHJcbiAgICBhbmd1bGFyLm1vZHVsZSgnYXBwLmV2ZW50cycpLmNvbnRyb2xsZXIoY29udHJvbGxlcklkLCBtYWluQ29udHJvbGxlcik7XHJcblxyXG4gICAgbWFpbkNvbnRyb2xsZXIuJGluamVjdCA9IFsnbG9nZ2VyJywgJyR1aWJNb2RhbEluc3RhbmNlJywgJ2d1ZXN0U2VydmljZScsICd0ZW1wbGF0ZVNlcnZpY2UnLCAnZ3Vlc3QnXTtcclxuXHJcbiAgICBmdW5jdGlvbiBtYWluQ29udHJvbGxlcihsb2dnZXIsICRtb2RhbCwgc2VydmljZSwgdGVtcGxhdGVTZXJ2aWNlLCBndWVzdCkge1xyXG4gICAgICAgIHZhciB2bSA9IHRoaXM7XHJcbiAgICAgICAgdm0udGl0bGUgPSAnRWRpdCBHdWVzdCc7XHJcblxyXG4gICAgICAgIHZtLmd1ZXN0ID0gYW5ndWxhci5jb3B5KGd1ZXN0KTtcclxuXHJcbiAgICAgICAgbG9nZ2VyLmxvZygnZ3Vlc3QnLCBndWVzdCk7XHJcblxyXG4gICAgICAgIHZtLmNhbmNlbCA9IGZ1bmN0aW9uICgpIHtcclxuICAgICAgICAgICAgJG1vZGFsLmRpc21pc3MoKTtcclxuICAgICAgICB9XHJcblxyXG4gICAgICAgIHZtLnNhdmUgPSBmdW5jdGlvbiAoKSB7XHJcbiAgICAgICAgICAgIHNlcnZpY2UudXBkYXRlKHZtLmd1ZXN0KVxyXG4gICAgICAgICAgICAgICAgLnRoZW4oZnVuY3Rpb24gKGRhdGEpIHtcclxuICAgICAgICAgICAgICAgICAgICBhbmd1bGFyLmV4dGVuZCh2bS5ndWVzdCwgZGF0YSk7XHJcbiAgICAgICAgICAgICAgICAgICAgbG9nZ2VyLmxvZygnZ3Vlc3QnLCB2bS5ndWVzdCk7XHJcbiAgICAgICAgICAgICAgICAgICAgJG1vZGFsLmNsb3NlKHZtLmd1ZXN0KTtcclxuICAgICAgICAgICAgICAgIH0pLmZpbmFsbHkoZnVuY3Rpb24gKCkge1xyXG4gICAgICAgICAgICAgICAgfSk7XHJcbiAgICAgICAgfVxyXG4gICAgfVxyXG5cclxuXHJcbn0pKCk7IiwiLy9tYXJrLmxhd3JlbmNlXHJcbi8vZXZlbnRzLmpzXHJcblxyXG4oZnVuY3Rpb24gKCkge1xyXG4gICAgJ3VzZSBzdHJpY3QnO1xyXG5cclxuICAgIHZhciBjb250cm9sbGVySWQgPSAnRXZlbnRDb250cm9sbGVyJztcclxuXHJcbiAgICBhbmd1bGFyLm1vZHVsZSgnYXBwLmV2ZW50cycpLmNvbnRyb2xsZXIoY29udHJvbGxlcklkLCBtYWluQ29udHJvbGxlcik7XHJcblxyXG4gICAgbWFpbkNvbnRyb2xsZXIuJGluamVjdCA9IFsnbG9nZ2VyJywgJyR1aWJNb2RhbCcsICdldmVudFNlcnZpY2UnLCAnZ3Vlc3RTZXJ2aWNlJywgJ3RlbXBsYXRlU2VydmljZSddO1xyXG5cclxuICAgIGZ1bmN0aW9uIG1haW5Db250cm9sbGVyKGxvZ2dlciwgJG1vZGFsLCBzZXJ2aWNlLCBndWVzdFNlcnZpY2UsIHRlbXBsYXRlU2VydmljZSkge1xyXG4gICAgICAgIHZhciB2bSA9IHRoaXM7XHJcbiAgICAgICAgdmFyIHRhYmxlU3RhdGVSZWY7XHJcbiAgICAgICAgdmFyIHBhZ2VTaXplRGVmYXVsdCA9IDEwO1xyXG5cclxuICAgICAgICB2bS5zaG93V2FpdExpc3QgPSBmYWxzZTtcclxuICAgICAgICB2bS5zaG93TWFpbFF1ZXVlID0gZmFsc2U7XHJcblxyXG4gICAgICAgIHZtLnRpdGxlID0gJ0V2ZW50IE1hbmFnZXInO1xyXG4gICAgICAgIHZtLmRlc2NyaXB0aW9uID0gXCJNYW5hZ2UgRG9ub3IgRXZlbnRzXCI7XHJcbiAgICAgICAgdm0uY3VycmVudERhdGUgPSBuZXcgRGF0ZSgpO1xyXG5cclxuICAgICAgICB2bS5kYXRlT3B0aW9ucyA9IHtcclxuICAgICAgICAgICAgZGF0ZURpc2FibGVkOiBmYWxzZSxcbiAgICAgICAgICAgIGZvcm1hdFllYXI6ICd5eScsXG4gICAgICAgICAgICBtYXhEYXRlOiBuZXcgRGF0ZSgyMDIwLCA1LCAyMiksXG4gICAgICAgICAgICBtaW5EYXRlOiBuZXcgRGF0ZSgpLFxuICAgICAgICAgICAgc3RhcnRpbmdEYXk6IDFcclxuICAgICAgICB9O1xyXG5cclxuICAgICAgICB2bS5kYXRlRm9ybWF0ID0gXCJNTS9ERC9ZWVlZIGg6bW0gYVwiO1xyXG4gICAgICAgIHZtLmV2ZW50cyA9IFtdO1xyXG5cclxuICAgICAgICB2bS5zZWFyY2hNb2RlbCA9IHtcclxuICAgICAgICAgICAgcGFnZTogMSxcclxuICAgICAgICAgICAgcGFnZVNpemU6IHBhZ2VTaXplRGVmYXVsdCxcclxuICAgICAgICAgICAgb3JkZXJCeTogJ2lkJyxcclxuICAgICAgICAgICAgb3JkZXJEaXJlY3Rpb246ICdhc2MnXHJcbiAgICAgICAgfTtcclxuXHJcbiAgICAgICAgdm0udGFicyA9IFtcclxuICAgICAgICAgICAgeyB0aXRsZTogJ0RldGFpbHMnLCB0ZW1wbGF0ZTogJ2FwcC9ldmVudHMvdmlld3MvaG9tZS5odG1sJywgYWN0aXZlOiBmYWxzZSwgaWNvbjogJ2ZhLWluZm8tY2lyY2xlJyB9LFxyXG4gICAgICAgICAgICB7IHRpdGxlOiAnR3Vlc3RzJywgdGVtcGxhdGU6ICdhcHAvZXZlbnRzL3ZpZXdzL2d1ZXN0LWxpc3QuaHRtbCcsIGFjdGl2ZTogdHJ1ZSwgaWNvbjogJ2ZhLXVzZXJzJyB9LFxyXG4gICAgICAgICAgICAvL3sgdGl0bGU6ICdNYWlsIFF1ZXVlJywgdGVtcGxhdGU6ICdhcHAvZXZlbnRzL3ZpZXdzL21haWwtcXVldWUuaHRtbCcsIGFjdGl2ZTogZmFsc2UsIGljb246ICcnIH0sXHJcbiAgICAgICAgICAgIC8veyB0aXRsZTogJ1dhaXRpbmcgUXVldWUnLCB0ZW1wbGF0ZTogJ2FwcC9ldmVudHMvdmlld3Mvd2FpdC1xdWV1ZS5odG1sJywgYWN0aXZlOiBmYWxzZSwgaWNvbjogJycgfSxcclxuICAgICAgICAgICAgeyB0aXRsZTogJ1RlbXBsYXRlJywgdGVtcGxhdGU6ICdhcHAvZXZlbnRzL3ZpZXdzL3RlbXBsYXRlLmh0bWwnLCBhY3RpdmU6IGZhbHNlLCBpY29uOiAnZmEtZmlsZS10ZXh0JyB9XHJcbiAgICAgICAgXTtcclxuXHJcbiAgICAgICAgYWN0aXZhdGUoKTtcclxuXHJcbiAgICAgICAgZnVuY3Rpb24gYWN0aXZhdGUoKSB7XHJcbiAgICAgICAgICAgIGxvZ2dlci5sb2coY29udHJvbGxlcklkICsgJyBhY3RpdmF0ZWQnKTtcclxuICAgICAgICAgICAgZ2V0RXZlbnRzKCkudGhlbihmdW5jdGlvbiAoKSB7XHJcbiAgICAgICAgICAgICAgICAvL1RPRE86IFJFTU9WRSBUSElTIFxyXG4gICAgICAgICAgICAgICAgdm0uc2VsZWN0ZWRFdmVudCA9IHZtLmV2ZW50c1swXTtcclxuICAgICAgICAgICAgfSk7XHJcblxyXG4gICAgICAgIH1cclxuXHJcbiAgICAgICAgdm0uYWRkVG9NYWlsUXVldWUgPSBmdW5jdGlvbiAoZ3Vlc3QpIHtcclxuICAgICAgICAgICAgdm0uaXNCdXN5ID0gdHJ1ZTtcclxuICAgICAgICAgICAgZ3Vlc3QuaXNXYWl0aW5nID0gZmFsc2U7XHJcbiAgICAgICAgICAgIGd1ZXN0LmlzQXR0ZW5kaW5nID0gdHJ1ZTtcclxuICAgICAgICAgICAgZ3Vlc3RTZXJ2aWNlLnVwZGF0ZShndWVzdClcclxuICAgICAgICAgICAgICAgIC50aGVuKGZ1bmN0aW9uIChkYXRhKSB7XHJcbiAgICAgICAgICAgICAgICAgICAgbG9nZ2VyLmxvZygnYWRkZWQgZ3Vlc3QnLCBkYXRhKTtcclxuICAgICAgICAgICAgICAgICAgICBsb2dnZXIuaW5mbygnQWRkZWQgR3Vlc3QgdG8gUXVldWU6ICcgKyBkYXRhLm5hbWUpO1xyXG4gICAgICAgICAgICAgICAgICAgIGd1ZXN0ID0gZGF0YTtcclxuICAgICAgICAgICAgICAgIH0pLmZpbmFsbHkoZnVuY3Rpb24gKCkge1xyXG4gICAgICAgICAgICAgICAgICAgIC8vY29tcGxldGUoKTtcclxuICAgICAgICAgICAgICAgICAgICB2bS5pc0J1c3kgPSBmYWxzZTtcclxuICAgICAgICAgICAgICAgIH0pO1xyXG4gICAgICAgIH1cclxuXHJcbiAgICAgICAgdm0uY2hhbmdlRXZlbnQgPSBmdW5jdGlvbiAoKSB7XHJcbiAgICAgICAgICAgIHZtLmlzQnVzeSA9IHRydWU7XHJcbiAgICAgICAgICAgIGlmICghdm0uc2VsZWN0ZWRFdmVudCkgcmV0dXJuO1xyXG4gICAgICAgICAgICBzZXJ2aWNlLmdldEJ5SWQodm0uc2VsZWN0ZWRFdmVudC5pZClcclxuICAgICAgICAgICAgICAgIC50aGVuKGZ1bmN0aW9uIChkYXRhKSB7XHJcbiAgICAgICAgICAgICAgICAgICAgYW5ndWxhci5leHRlbmQodm0uc2VsZWN0ZWRFdmVudCwgZGF0YSk7XHJcbiAgICAgICAgICAgICAgICAgICAgdm0uc2VsZWN0ZWRFdmVudC5pc0V4cGlyZWQgPSBtb21lbnQodm0uc2VsZWN0ZWRFdmVudC5lbmREYXRlKS50b0RhdGUoKSA8IHZtLmN1cnJlbnREYXRlO1xyXG4gICAgICAgICAgICAgICAgICAgIHZtLmd1ZXN0cyA9IHZtLnNlbGVjdGVkRXZlbnQuZ3Vlc3RzO1xyXG4gICAgICAgICAgICAgICAgICAgIGxvZ2dlci5sb2coJ2V2ZW50Jywgdm0uc2VsZWN0ZWRFdmVudCk7XHJcbiAgICAgICAgICAgICAgICB9KS5maW5hbGx5KGZ1bmN0aW9uICgpIHtcclxuICAgICAgICAgICAgICAgICAgICB2bS5pc0J1c3kgPSBmYWxzZTtcclxuICAgICAgICAgICAgICAgICAgICB2bS5zZWFyY2hHdWVzdHModGFibGVTdGF0ZVJlZik7XHJcbiAgICAgICAgICAgICAgICB9KTtcclxuXHJcbiAgICAgICAgfVxyXG5cclxuICAgICAgICB2bS5kZWxldGVFdmVudCA9IGZ1bmN0aW9uIChpZCkge1xyXG4gICAgICAgICAgICAvL1RPRE86IENvbmZpcm1hdGlvbiBvbiBkZWxldGVcclxuICAgICAgICAgICAgdm0uaXNCdXN5ID0gdHJ1ZTtcclxuICAgICAgICAgICAgc2VydmljZS5yZW1vdmUoaWQpXHJcbiAgICAgICAgICAgICAgICAudGhlbihmdW5jdGlvbiAoZGF0YSkge1xyXG4gICAgICAgICAgICAgICAgICAgIHZtLnNlbGVjdGVkRXZlbnQgPSBudWxsO1xyXG4gICAgICAgICAgICAgICAgICAgIGxvZ2dlci5zdWNjZXNzKCdEZWxldGVkIGV2ZW50Jyk7XHJcbiAgICAgICAgICAgICAgICB9KS5maW5hbGx5KGZ1bmN0aW9uICgpIHtcclxuICAgICAgICAgICAgICAgICAgICB2bS5pc0J1c3kgPSBmYWxzZTtcclxuICAgICAgICAgICAgICAgICAgICBnZXRFdmVudHMoKTtcclxuICAgICAgICAgICAgICAgIH0pO1xyXG4gICAgICAgIH1cclxuXHJcbiAgICAgICAgdm0ucmVnaXN0ZXJHdWVzdCA9IGZ1bmN0aW9uIChndWVzdCkge1xyXG5cclxuICAgICAgICAgICAgJG1vZGFsLm9wZW4oe1xyXG4gICAgICAgICAgICAgICAgdGVtcGxhdGVVcmw6ICcvYXBwL2V2ZW50cy92aWV3cy9lZGl0LWd1ZXN0Lmh0bWwnLFxyXG4gICAgICAgICAgICAgICAgY29udHJvbGxlcjogJ0VkaXRHdWVzdENvbnRyb2xsZXInLFxyXG4gICAgICAgICAgICAgICAgY29udHJvbGxlckFzOiAndm0nLFxyXG4gICAgICAgICAgICAgICAgcmVzb2x2ZToge1xyXG4gICAgICAgICAgICAgICAgICAgIGd1ZXN0OiBndWVzdFxyXG4gICAgICAgICAgICAgICAgfVxyXG4gICAgICAgICAgICB9KS5yZXN1bHQudGhlbihmdW5jdGlvbiAocmVzdWx0KSB7XHJcbiAgICAgICAgICAgICAgICBsb2dnZXIubG9nKCdyZXN1bHQnLCByZXN1bHQpO1xyXG4gICAgICAgICAgICAgICAgYW5ndWxhci5leHRlbmQoZ3Vlc3QsIHJlc3VsdCk7XHJcbiAgICAgICAgICAgIH0pO1xyXG4gICAgICAgIH1cclxuXHJcbiAgICAgICAgdm0uZmlsdGVyV2FpdGluZ1F1ZXVlID0gZnVuY3Rpb24gKCkge1xyXG4gICAgICAgICAgICB2bS5zaG93V2FpdExpc3QgPSAhdm0uc2hvd1dhaXRMaXN0O1xyXG4gICAgICAgICAgICB2bS5zaG93TWFpbFF1ZXVlID0gZmFsc2U7XHJcbiAgICAgICAgICAgIHZhciBpc1dhaXRpbmcgPSB2bS5zZWFyY2hNb2RlbC5pc1dhaXRpbmcgPSAhdm0uc2VhcmNoTW9kZWwuaXNXYWl0aW5nID09PSB0cnVlID8gdHJ1ZSA6IG51bGw7XHJcbiAgICAgICAgICAgIHZtLnNlYXJjaE1vZGVsID0ge1xyXG4gICAgICAgICAgICAgICAgcGFnZTogMSxcclxuICAgICAgICAgICAgICAgIHBhZ2VTaXplOiBwYWdlU2l6ZURlZmF1bHQsXHJcbiAgICAgICAgICAgICAgICBvcmRlckJ5OiAnaWQnLFxyXG4gICAgICAgICAgICAgICAgb3JkZXJEaXJlY3Rpb246ICdhc2MnLFxyXG4gICAgICAgICAgICAgICAgaXNXYWl0aW5nOiBpc1dhaXRpbmcsXHJcbiAgICAgICAgICAgICAgICBpc0F0dGVuZGluZzogdHJ1ZSxcclxuICAgICAgICAgICAgICAgIGlzTWFpbGVkOiBudWxsXHJcbiAgICAgICAgICAgIH1cclxuICAgICAgICAgICAgdm0uc2VhcmNoR3Vlc3RzKHRhYmxlU3RhdGVSZWYpO1xyXG4gICAgICAgIH1cclxuXHJcbiAgICAgICAgdm0uZmlsdGVyTWFpbFF1ZXVlID0gZnVuY3Rpb24gKCkge1xyXG4gICAgICAgICAgICB2bS5zaG93TWFpbFF1ZXVlID0gIXZtLnNob3dNYWlsUXVldWU7XHJcbiAgICAgICAgICAgIHZtLnNob3dXYWl0TGlzdCA9IGZhbHNlO1xyXG4gICAgICAgICAgICB2YXIgaXNBdHRlbmRpbmcgPSB2bS5zZWFyY2hNb2RlbC5pc0F0dGVuZGluZyA9ICF2bS5zZWFyY2hNb2RlbC5pc0F0dGVuZGluZyA9PT0gdHJ1ZSA/IHRydWUgOiBudWxsO1xyXG4gICAgICAgICAgICB2YXIgaXNXYWl0aW5nID0gdm0uc2VhcmNoTW9kZWwuaXNXYWl0aW5nID0gIXZtLnNlYXJjaE1vZGVsLmlzV2FpdGluZyA9PT0gdHJ1ZSA/IGZhbHNlIDogbnVsbDtcclxuICAgICAgICAgICAgdm0uc2VhcmNoTW9kZWwgPSB7XHJcbiAgICAgICAgICAgICAgICBwYWdlOiAxLFxyXG4gICAgICAgICAgICAgICAgcGFnZVNpemU6IHBhZ2VTaXplRGVmYXVsdCxcclxuICAgICAgICAgICAgICAgIG9yZGVyQnk6ICdpZCcsXHJcbiAgICAgICAgICAgICAgICBvcmRlckRpcmVjdGlvbjogJ2FzYycsXHJcbiAgICAgICAgICAgICAgICBpc0F0dGVuZGluZzogaXNBdHRlbmRpbmcsXHJcbiAgICAgICAgICAgICAgICBpc01haWxlZDogZmFsc2UsXHJcbiAgICAgICAgICAgICAgICBpc1dhaXRpbmc6IGlzV2FpdGluZ1xyXG4gICAgICAgICAgICB9XHJcbiAgICAgICAgICAgIHZtLnNlYXJjaEd1ZXN0cyh0YWJsZVN0YXRlUmVmKTtcclxuICAgICAgICB9XHJcblxyXG4gICAgICAgIHZtLm1haWxUaWNrZXQgPSBmdW5jdGlvbiAoZ3Vlc3QpIHtcclxuICAgICAgICAgICAgdm0uaXNCdXN5ID0gdHJ1ZTtcclxuICAgICAgICAgICAgZ3Vlc3QuaXNNYWlsZWQgPSB0cnVlO1xyXG4gICAgICAgICAgICB2bS5pc1dhaXRpbmcgPSBmYWxzZTtcclxuICAgICAgICAgICAgZ3Vlc3RTZXJ2aWNlLnVwZGF0ZShndWVzdClcclxuICAgICAgICAgICAgICAgIC50aGVuKGZ1bmN0aW9uIChkYXRhKSB7XHJcbiAgICAgICAgICAgICAgICAgICAgYW5ndWxhci5leHRlbmQoZ3Vlc3QsIGRhdGEpO1xyXG4gICAgICAgICAgICAgICAgICAgIGxvZ2dlci5zdWNjZXNzKCdJc3N1ZWQgdGlja2V0IHRvOiAnICsgZ3Vlc3QubmFtZSk7XHJcbiAgICAgICAgICAgICAgICB9KS5maW5hbGx5KGZ1bmN0aW9uICgpIHtcclxuICAgICAgICAgICAgICAgICAgICB2bS5pc0J1c3kgPSBmYWxzZTtcclxuICAgICAgICAgICAgICAgIH0pO1xyXG4gICAgICAgIH1cclxuXHJcbiAgICAgICAgdm0uc2VhcmNoR3Vlc3RzID0gZnVuY3Rpb24gKHRhYmxlU3RhdGUpIHtcclxuICAgICAgICAgICAgdGFibGVTdGF0ZVJlZiA9IHRhYmxlU3RhdGU7XHJcbiAgICAgICAgICAgIGlmICghdm0uc2VsZWN0ZWRFdmVudCkgcmV0dXJuO1xyXG5cclxuICAgICAgICAgICAgaWYgKHR5cGVvZiAodGFibGVTdGF0ZS5zb3J0LnByZWRpY2F0ZSkgIT0gXCJ1bmRlZmluZWRcIikge1xyXG4gICAgICAgICAgICAgICAgdm0uc2VhcmNoTW9kZWwub3JkZXJCeSA9IHRhYmxlU3RhdGUuc29ydC5wcmVkaWNhdGU7XHJcbiAgICAgICAgICAgICAgICB2bS5zZWFyY2hNb2RlbC5vcmRlckRpcmVjdGlvbiA9IHRhYmxlU3RhdGUuc29ydC5yZXZlcnNlID8gJ2Rlc2MnIDogJ2FzYyc7XHJcbiAgICAgICAgICAgIH1cclxuICAgICAgICAgICAgaWYgKHR5cGVvZiAodGFibGVTdGF0ZS5zZWFyY2gucHJlZGljYXRlT2JqZWN0KSAhPSBcInVuZGVmaW5lZFwiKSB7XHJcbiAgICAgICAgICAgICAgICB2bS5zZWFyY2hNb2RlbC5uYW1lID0gdGFibGVTdGF0ZS5zZWFyY2gucHJlZGljYXRlT2JqZWN0Lm5hbWU7XHJcbiAgICAgICAgICAgICAgICB2bS5zZWFyY2hNb2RlbC5hZGRyZXNzID0gdGFibGVTdGF0ZS5zZWFyY2gucHJlZGljYXRlT2JqZWN0LmFkZHJlc3M7XHJcbiAgICAgICAgICAgICAgICB2bS5zZWFyY2hNb2RlbC5jaXR5ID0gdGFibGVTdGF0ZS5zZWFyY2gucHJlZGljYXRlT2JqZWN0LmNpdHk7XHJcbiAgICAgICAgICAgICAgICB2bS5zZWFyY2hNb2RlbC5zdGF0ZSA9IHRhYmxlU3RhdGUuc2VhcmNoLnByZWRpY2F0ZU9iamVjdC5zdGF0ZTtcclxuICAgICAgICAgICAgICAgIHZtLnNlYXJjaE1vZGVsLnppcGNvZGUgPSB0YWJsZVN0YXRlLnNlYXJjaC5wcmVkaWNhdGVPYmplY3QuemlwY29kZTtcclxuICAgICAgICAgICAgICAgIHZtLnNlYXJjaE1vZGVsLmd1ZXN0Q291bnQgPSB0YWJsZVN0YXRlLnNlYXJjaC5wcmVkaWNhdGVPYmplY3QuZ3Vlc3RDb3VudDtcclxuICAgICAgICAgICAgICAgIHZtLnNlYXJjaE1vZGVsLnBob25lID0gdGFibGVTdGF0ZS5zZWFyY2gucHJlZGljYXRlT2JqZWN0LnBob25lO1xyXG4gICAgICAgICAgICAgICAgdm0uc2VhcmNoTW9kZWwuZW1haWwgPSB0YWJsZVN0YXRlLnNlYXJjaC5wcmVkaWNhdGVPYmplY3QuZW1haWw7XHJcbiAgICAgICAgICAgICAgICB2bS5zZWFyY2hNb2RlbC5hY2NvdW50SWQgPSB0YWJsZVN0YXRlLnNlYXJjaC5wcmVkaWNhdGVPYmplY3QuYWNjb3VudElkO1xyXG4gICAgICAgICAgICAgICAgdm0uc2VhcmNoTW9kZWwuZmluZGVyTnVtYmVyID0gdGFibGVTdGF0ZS5zZWFyY2gucHJlZGljYXRlT2JqZWN0LmZpbmRlck51bWJlcjtcclxuICAgICAgICAgICAgICAgIHZtLnNlYXJjaE1vZGVsLmlzTWFpbGVkID0gdGFibGVTdGF0ZS5zZWFyY2gucHJlZGljYXRlT2JqZWN0LmlzTWFpbGVkO1xyXG4gICAgICAgICAgICB9XHJcblxyXG4gICAgICAgICAgICB2bS5pc0J1c3kgPSB0cnVlO1xyXG4gICAgICAgICAgICByZXR1cm4gc2VydmljZS5nZXRHdWVzdHModm0uc2VsZWN0ZWRFdmVudC5pZCwgdm0uc2VhcmNoTW9kZWwpXHJcbiAgICAgICAgICAgICAgICAudGhlbihmdW5jdGlvbiAoZGF0YSkge1xyXG4gICAgICAgICAgICAgICAgICAgIHZtLnNlbGVjdGVkRXZlbnQuZ3Vlc3RzID0gZGF0YS5pdGVtcztcclxuICAgICAgICAgICAgICAgICAgICB2bS5zZWFyY2hNb2RlbCA9IGRhdGE7XHJcbiAgICAgICAgICAgICAgICAgICAgbG9nZ2VyLmxvZygnc2VhcmNoJywgdm0uc2VhcmNoTW9kZWwpO1xyXG4gICAgICAgICAgICAgICAgICAgIHZtLmlzQnVzeSA9IGZhbHNlO1xyXG4gICAgICAgICAgICAgICAgfSk7XHJcblxyXG4gICAgICAgIH1cclxuXHJcbiAgICAgICAgdm0ucGFnZWQgPSBmdW5jdGlvbiBwYWdlZCgpIHtcclxuICAgICAgICAgICAgdm0uc2VhcmNoR3Vlc3RzKHRhYmxlU3RhdGVSZWYpO1xyXG4gICAgICAgIH07XHJcblxyXG4gICAgICAgIHZtLnNhdmVFdmVudCA9IGZ1bmN0aW9uIChmb3JtKSB7XHJcbiAgICAgICAgICAgIHZtLmlzQnVzeSA9IHRydWU7XHJcbiAgICAgICAgICAgIHJldHVybiBzZXJ2aWNlLnVwZGF0ZSh2bS5zZWxlY3RlZEV2ZW50KVxyXG4gICAgICAgICAgICAgICAgLnRoZW4oZnVuY3Rpb24gKGRhdGEpIHtcclxuICAgICAgICAgICAgICAgICAgICBsb2dnZXIuc3VjY2VzcygnU2F2ZWQgRXZlbnQ6ICcgKyBkYXRhLm5hbWUpO1xyXG4gICAgICAgICAgICAgICAgICAgIGFuZ3VsYXIuZXh0ZW5kKHZtLnNlbGVjdGVkRXZlbnQsIGRhdGEpO1xyXG4gICAgICAgICAgICAgICAgICAgIHZtLnNlbGVjdGVkRXZlbnQuaXNFeHBpcmVkID0gbW9tZW50KHZtLnNlbGVjdGVkRXZlbnQuZW5kRGF0ZSkudG9EYXRlKCkgPCB2bS5jdXJyZW50RGF0ZTtcclxuICAgICAgICAgICAgICAgIH0pXHJcbiAgICAgICAgICAgICAgICAuZmluYWxseShmdW5jdGlvbiAoKSB7XHJcbiAgICAgICAgICAgICAgICAgICAgZm9ybS4kc2V0UHJpc3RpbmUoKTtcclxuICAgICAgICAgICAgICAgICAgICB2bS5pc0J1c3kgPSBmYWxzZTtcclxuICAgICAgICAgICAgICAgIH0pO1xyXG4gICAgICAgIH1cclxuXHJcbiAgICAgICAgdm0uZmlsZVNlbGVjdGVkID0gZnVuY3Rpb24gKCRmaWxlcywgJGZpbGUsICRldmVudCwgJHJlamVjdGVkRmlsZXMpIHtcclxuICAgICAgICAgICAgdmFyIHJlYWRlciA9IG5ldyBGaWxlUmVhZGVyKCk7XHJcbiAgICAgICAgICAgIHJlYWRlci5vbmxvYWRzdGFydCA9IGZ1bmN0aW9uICgpIHtcclxuXHJcbiAgICAgICAgICAgICAgICB2bS5pc0J1c3kgPSB0cnVlO1xyXG4gICAgICAgICAgICB9O1xyXG4gICAgICAgICAgICByZWFkZXIub25sb2FkZW5kID0gZnVuY3Rpb24gKCkge1xyXG4gICAgICAgICAgICAgICAgdm0uaXNCdXN5ID0gZmFsc2U7XHJcblxyXG4gICAgICAgICAgICB9XHJcbiAgICAgICAgICAgIHJlYWRlci5vbmxvYWQgPSBmdW5jdGlvbiAoZSkge1xyXG4gICAgICAgICAgICAgICAgdmFyIGRhdGFVUkwgPSByZWFkZXIucmVzdWx0O1xyXG4gICAgICAgICAgICAgICAgdm0uc2VsZWN0ZWRFdmVudC50ZW1wbGF0ZS5pbWFnZSA9IGRhdGFVUkwuc3BsaXQoJywnKVsxXTtcclxuICAgICAgICAgICAgICAgIHZtLnNlbGVjdGVkRXZlbnQudGVtcGxhdGUubWltZVR5cGUgPSAkZmlsZS50eXBlO1xyXG4gICAgICAgICAgICB9O1xyXG4gICAgICAgICAgICByZWFkZXIucmVhZEFzRGF0YVVSTCgkZmlsZSk7XHJcblxyXG4gICAgICAgIH07XHJcblxyXG4gICAgICAgIHZtLnNhdmVUZW1wbGF0ZSA9IGZ1bmN0aW9uICgpIHtcclxuICAgICAgICAgICAgdm0uaXNCdXN5ID0gdHJ1ZTtcclxuICAgICAgICAgICAgdGVtcGxhdGVTZXJ2aWNlLnVwZGF0ZSh2bS5zZWxlY3RlZEV2ZW50LnRlbXBsYXRlKVxyXG4gICAgICAgICAgICAgICAgLnRoZW4oZnVuY3Rpb24gKGRhdGEpIHtcclxuICAgICAgICAgICAgICAgICAgICB2bS5zZWxlY3RlZEV2ZW50LnRlbXBsYXRlID0gYW5ndWxhci5leHRlbmQodm0uc2VsZWN0ZWRFdmVudC50ZW1wbGF0ZSwgZGF0YSk7XHJcbiAgICAgICAgICAgICAgICAgICAgbG9nZ2VyLnN1Y2Nlc3MoJ1NhdmVkIHRlbXBsYXRlOiAnICsgZGF0YS5uYW1lKTtcclxuICAgICAgICAgICAgICAgIH0pLmZpbmFsbHkoZnVuY3Rpb24gKCkge1xyXG4gICAgICAgICAgICAgICAgICAgIGNvbXBsZXRlKCk7XHJcbiAgICAgICAgICAgICAgICB9KTtcclxuICAgICAgICB9XHJcblxyXG4gICAgICAgIHZtLnRvZ2dsZUNhbmNlbCA9IGZ1bmN0aW9uIChmb3JtKSB7XHJcbiAgICAgICAgICAgIHZtLnNlbGVjdGVkRXZlbnQuaXNDYW5jZWxsZWQgPSAhdm0uc2VsZWN0ZWRFdmVudC5pc0NhbmNlbGxlZDtcclxuICAgICAgICAgICAgdm0uc2F2ZUV2ZW50KGZvcm0pLnRoZW4oZnVuY3Rpb24gKCkge1xyXG4gICAgICAgICAgICAgICAgaWYgKHZtLnNlbGVjdGVkRXZlbnQuaXNDYW5jZWxsZWQpIHtcclxuICAgICAgICAgICAgICAgICAgICBsb2dnZXIud2FybmluZygnQ2FuY2VsbGVkIGV2ZW50Jyk7XHJcbiAgICAgICAgICAgICAgICB9IGVsc2Uge1xyXG4gICAgICAgICAgICAgICAgICAgIGxvZ2dlci5pbmZvKCdSZXN0b3JlZCBldmVudCcpO1xyXG4gICAgICAgICAgICAgICAgfVxyXG4gICAgICAgICAgICB9KTtcclxuICAgICAgICB9XHJcblxyXG4gICAgICAgIHZtLnNob3dDcmVhdGVFdmVudCA9IGZ1bmN0aW9uICgpIHtcclxuICAgICAgICAgICAgJG1vZGFsLm9wZW4oe1xyXG4gICAgICAgICAgICAgICAgdGVtcGxhdGVVcmw6ICcvYXBwL2V2ZW50cy92aWV3cy9jcmVhdGUtZXZlbnQuaHRtbCcsXHJcbiAgICAgICAgICAgICAgICBjb250cm9sbGVyOiBbJ2xvZ2dlcicsICckdWliTW9kYWxJbnN0YW5jZScsICdldmVudFNlcnZpY2UnLCBDcmVhdGVFdmVudENvbnRyb2xsZXJdLFxyXG4gICAgICAgICAgICAgICAgY29udHJvbGxlckFzOiAndm0nXHJcbiAgICAgICAgICAgIH0pLnJlc3VsdC50aGVuKGZ1bmN0aW9uIChkYXRhKSB7XHJcbiAgICAgICAgICAgICAgICB2bS5zZWxlY3RlZEV2ZW50ID0gZGF0YTtcclxuICAgICAgICAgICAgICAgIHZtLmV2ZW50cy51bnNoaWZ0KHZtLnNlbGVjdGVkRXZlbnQpO1xyXG4gICAgICAgICAgICAgICAgbG9nZ2VyLnN1Y2Nlc3MoJ1N1Y2Nlc3NmdWxseSBjcmVhdGVkICcgKyBkYXRhLm5hbWUpO1xyXG4gICAgICAgICAgICB9KTtcclxuICAgICAgICB9XHJcblxyXG4gICAgICAgIHZtLnNob3dHdWVzdFVwbG9hZCA9IGZ1bmN0aW9uICgpIHtcclxuICAgICAgICAgICAgbG9nZ2VyLmxvZygnc2hvdyB1cGxvYWQnKTtcclxuICAgICAgICAgICAgJG1vZGFsLm9wZW4oe1xyXG4gICAgICAgICAgICAgICAga2V5Ym9hcmQ6IGZhbHNlLFxyXG4gICAgICAgICAgICAgICAgYmFja2Ryb3A6ICdzdGF0aWMnLFxyXG4gICAgICAgICAgICAgICAgdGVtcGxhdGVVcmw6ICcvYXBwL2V2ZW50cy92aWV3cy9ndWVzdC11cGxvYWQuaHRtbCcsXHJcbiAgICAgICAgICAgICAgICBjb250cm9sbGVyOiBbJ2xvZ2dlcicsICckdWliTW9kYWxJbnN0YW5jZScsICdmaWxlU2VydmljZScsICdzZWxlY3RlZEV2ZW50JywgVXBsb2FkR3Vlc3RDb250cm9sbGVyXSxcclxuICAgICAgICAgICAgICAgIGNvbnRyb2xsZXJBczogJ3ZtJyxcclxuICAgICAgICAgICAgICAgIHJlc29sdmU6IHtcclxuICAgICAgICAgICAgICAgICAgICBzZWxlY3RlZEV2ZW50OiB2bS5zZWxlY3RlZEV2ZW50XHJcbiAgICAgICAgICAgICAgICB9XHJcbiAgICAgICAgICAgIH0pLnJlc3VsdC50aGVuKGZ1bmN0aW9uIChyZXN1bHQpIHtcclxuICAgICAgICAgICAgICAgIGlmIChyZXN1bHQuc3VjY2Vzcykge1xyXG4gICAgICAgICAgICAgICAgICAgIGxvZ2dlci5zdWNjZXNzKHJlc3VsdC5tZXNzYWdlKTtcclxuICAgICAgICAgICAgICAgIH0gZWxzZSB7XHJcbiAgICAgICAgICAgICAgICAgICAgbG9nZ2VyLmVycm9yKHJlc3VsdC5tZXNzYWdlKTtcclxuICAgICAgICAgICAgICAgIH1cclxuICAgICAgICAgICAgICAgIHZtLmNoYW5nZUV2ZW50KCk7XHJcbiAgICAgICAgICAgIH0pO1xyXG4gICAgICAgIH1cclxuXHJcbiAgICAgICAgZnVuY3Rpb24gZ2V0RXZlbnRzKCkge1xyXG4gICAgICAgICAgICB2bS5pc0J1c3kgPSB0cnVlOyBcclxuICAgICAgICAgICAgcmV0dXJuIHNlcnZpY2UuZ2V0KClcclxuICAgICAgICAgICAgICAgIC50aGVuKGZ1bmN0aW9uIChkYXRhKSB7XHJcbiAgICAgICAgICAgICAgICAgICAgdm0uZXZlbnRzID0gZGF0YTtcclxuICAgICAgICAgICAgICAgIH0pLmZpbmFsbHkoZnVuY3Rpb24gKCkge1xyXG4gICAgICAgICAgICAgICAgICAgIHZtLmlzQnVzeSA9IGZhbHNlOyBcclxuICAgICAgICAgICAgICAgIH0pO1xyXG4gICAgICAgIH1cclxuXHJcbiAgICAgICAgLy9UT0RPOiBSRU1PVkVcclxuICAgICAgICBmdW5jdGlvbiBjb21wbGV0ZSgpIHtcclxuICAgICAgICAgICAgLy92bS5pc0J1c3kgPSBmYWxzZTtcclxuICAgICAgICAgICAgLy92bS5zZWxlY3RlZEV2ZW50ID0gdm0uZXZlbnRzWzBdO1xyXG4gICAgICAgICAgICAvL3ZtLmNoYW5nZUV2ZW50KCk7XHJcbiAgICAgICAgfVxyXG4gICAgfTtcclxuXHJcbiAgICBmdW5jdGlvbiBVcGxvYWRHdWVzdENvbnRyb2xsZXIobG9nZ2VyLCAkbW9kYWwsIHNlcnZpY2UsIGV2ZW50KSB7XHJcbiAgICAgICAgdmFyIHZtID0gdGhpcztcclxuICAgICAgICB2bS5ldmVudCA9IGV2ZW50O1xyXG5cclxuICAgICAgICB2bS5jYW5jZWwgPSBmdW5jdGlvbiAoKSB7XHJcbiAgICAgICAgICAgIHZtLmZpbGUgPSB1bmRlZmluZWQ7XHJcbiAgICAgICAgICAgICRtb2RhbC5kaXNtaXNzKCk7XHJcbiAgICAgICAgfVxyXG5cclxuICAgICAgICB2bS5maWxlU2VsZWN0ZWQgPSBmdW5jdGlvbiAoJGZpbGUsICRldmVudCkge1xyXG4gICAgICAgICAgICB2bS5yZXN1bHQgPSBudWxsO1xyXG4gICAgICAgIH07XHJcblxyXG5cclxuICAgICAgICB2bS5zYXZlID0gZnVuY3Rpb24gKCkge1xyXG4gICAgICAgICAgICB2bS5pc0J1c3kgPSB0cnVlO1xyXG4gICAgICAgICAgICB2bS5yZXN1bHQgPSB7XHJcbiAgICAgICAgICAgICAgICBzdWNjZXNzOiBmYWxzZVxyXG4gICAgICAgICAgICB9XHJcblxyXG4gICAgICAgICAgICBzZXJ2aWNlLmd1ZXN0KHZtLmV2ZW50LmlkLCB2bS5maWxlKVxyXG4gICAgICAgICAgICAgICAgICAgIC50aGVuKGZ1bmN0aW9uIChkYXRhKSB7XHJcbiAgICAgICAgICAgICAgICAgICAgICAgIHZtLnJlc3VsdC5zdWNjZXNzID0gdHJ1ZTtcclxuICAgICAgICAgICAgICAgICAgICAgICAgdm0ucmVzdWx0Lm1lc3NhZ2UgPSBkYXRhO1xyXG4gICAgICAgICAgICAgICAgICAgIH0pLmNhdGNoKGZ1bmN0aW9uIChlcnJvcikge1xyXG4gICAgICAgICAgICAgICAgICAgICAgICB2bS5yZXN1bHQubWVzc2FnZSA9IGVycm9yLmRhdGEubWVzc2FnZTtcclxuICAgICAgICAgICAgICAgICAgICB9KS5maW5hbGx5KGZ1bmN0aW9uICgpIHtcclxuICAgICAgICAgICAgICAgICAgICAgICAgdm0uZmlsZSA9IHVuZGVmaW5lZDtcclxuICAgICAgICAgICAgICAgICAgICAgICAgdm0uaXNCdXN5ID0gZmFsc2U7XHJcbiAgICAgICAgICAgICAgICAgICAgICAgICRtb2RhbC5jbG9zZSh2bS5yZXN1bHQpO1xyXG4gICAgICAgICAgICAgICAgICAgIH0pO1xyXG4gICAgICAgIH1cclxuICAgIH1cclxuXHJcbiAgICBmdW5jdGlvbiBDcmVhdGVFdmVudENvbnRyb2xsZXIobG9nZ2VyLCAkbW9kYWwsIHNlcnZpY2UpIHtcclxuICAgICAgICB2YXIgdm0gPSB0aGlzO1xyXG5cclxuICAgICAgICB2bS5kYXRlRm9ybWF0ID0gXCJNTS9ERC9ZWVlZIGhoOm1tXCI7XHJcblxyXG4gICAgICAgIHZtLmV2ZW50ID0ge1xyXG4gICAgICAgICAgICBzdGFydERhdGU6IG5ldyBEYXRlKCksXHJcbiAgICAgICAgICAgIHRlbXBsYXRlOiB7fVxyXG4gICAgICAgIH07XHJcblxyXG4gICAgICAgIHZtLmNhbmNlbCA9IGZ1bmN0aW9uICgpIHtcclxuICAgICAgICAgICAgJG1vZGFsLmRpc21pc3MoKTtcclxuICAgICAgICB9XHJcblxyXG4gICAgICAgIHZtLnNhdmUgPSBmdW5jdGlvbiAoKSB7XHJcbiAgICAgICAgICAgIHZtLmV2ZW50LnRlbXBsYXRlLm5hbWUgPSB2bS5ldmVudC5uYW1lO1xyXG4gICAgICAgICAgICBzZXJ2aWNlLmNyZWF0ZSh2bS5ldmVudClcclxuICAgICAgICAgICAgICAgIC50aGVuKGZ1bmN0aW9uIChkYXRhKSB7XHJcbiAgICAgICAgICAgICAgICAgICAgJG1vZGFsLmNsb3NlKGRhdGEpO1xyXG4gICAgICAgICAgICAgICAgfSk7XHJcbiAgICAgICAgfVxyXG4gICAgfVxyXG59KSgpOyIsIi8vYXBwLmZpbHRlci5qc1xyXG4vL21hcmsubGF3cmVuY2VcclxuXHJcbmFuZ3VsYXIubW9kdWxlKCdhcHAuZmlsdGVyJykuZmlsdGVyKCdwZXJjZW50YWdlJywgWyckZmlsdGVyJywgZnVuY3Rpb24gKCRmaWx0ZXIpIHtcclxuICAgIHJldHVybiBmdW5jdGlvbiAoaW5wdXQsIGRlY2ltYWxzKSB7XHJcbiAgICAgICAgcmV0dXJuICRmaWx0ZXIoJ251bWJlcicpKGlucHV0ICogMTAwLCBkZWNpbWFscykgKyAnJSc7XHJcbiAgICB9O1xyXG59XSk7XHJcblxyXG5hbmd1bGFyLm1vZHVsZSgnYXBwLmZpbHRlcicsIFtdKS5maWx0ZXIoJ2NoZWNrbWFyaycsIGZ1bmN0aW9uICgpIHtcclxuICAgIHJldHVybiBmdW5jdGlvbiAoaW5wdXQpIHtcclxuICAgICAgICByZXR1cm4gaW5wdXQgPyAnXFx1MjcxMycgOiAnXFx1MjcxOCc7XHJcbiAgICB9O1xyXG59KTtcclxuXHJcbmFuZ3VsYXIubW9kdWxlKCdhcHAuZmlsdGVyJykuZmlsdGVyKCd5ZXNObycsIGZ1bmN0aW9uICgpIHtcclxuICAgIHJldHVybiBmdW5jdGlvbiAoaW5wdXQpIHtcclxuICAgICAgICByZXR1cm4gaW5wdXQgPyAnWWVzJyA6ICdObyc7XHJcbiAgICB9XHJcbn0pO1xyXG5cclxuYW5ndWxhci5tb2R1bGUoJ2FwcC5maWx0ZXInKS5maWx0ZXIoJ3VwZGF0ZVN0YXR1cycsIGZ1bmN0aW9uICgpIHtcclxuICAgIHJldHVybiBmdW5jdGlvbiAoaW5wdXQpIHtcclxuICAgICAgICBpZiAoaW5wdXQgPT09IDEpIHtcclxuICAgICAgICAgICAgcmV0dXJuICdVbmNoYW5nZWQnO1xyXG4gICAgICAgIH1cclxuICAgICAgICBpZiAoaW5wdXQgPT09IDIpIHtcclxuICAgICAgICAgICAgcmV0dXJuICdDaGFuZ2VkJztcclxuICAgICAgICB9XHJcbiAgICAgICAgaWYgKGlucHV0ID09PSA2KSB7XHJcbiAgICAgICAgICAgIHJldHVybiAnUmVjb25jaWxlZCc7XHJcbiAgICAgICAgfVxyXG4gICAgfTtcclxufSk7IiwiLy9tYXJrLmxhd3JlbmNlXHJcbi8vbWFpbGVycy5qc1xyXG5cclxuKGZ1bmN0aW9uICgpIHtcclxuICAgIHZhciBjb250cm9sbGVySWQgPSAnTWFpbGVyQ29udHJvbGxlcic7XHJcblxyXG4gICAgYW5ndWxhci5tb2R1bGUoJ2FwcC5tYWlsZXJzJykuY29udHJvbGxlcihjb250cm9sbGVySWQsIE1haW5Db250cm9sbGVyKTtcclxuXHJcbiAgICBNYWluQ29udHJvbGxlci4kaW5qZWN0ID0gWydsb2dnZXInLCAnJHVpYk1vZGFsJywgJ2NhbXBhaWduU2VydmljZScsICdyZWFzb25TZXJ2aWNlJywgJ21haWxlclNlcnZpY2UnXTtcclxuXHJcbiAgICBmdW5jdGlvbiBNYWluQ29udHJvbGxlcihsb2dnZXIsICRtb2RhbCwgY2FtcGFpZ25TZXJ2aWNlLCByZWFzb25TZXJ2aWNlLCBtYWlsZXJTZXJ2aWNlKSB7XHJcbiAgICAgICAgdmFyIHZtID0gdGhpcztcclxuICAgICAgICB2YXIgdGFibGVTdGF0ZVJlZjtcclxuXHJcbiAgICAgICAgdm0udGl0bGUgPSAnTWFpbGVycyBNYW5hZ2VyJztcclxuICAgICAgICB2bS5kZXNjcmlwdGlvbiA9IFwiVXBkYXRlIE1haWxlciBBY3F1aXNpdGlvbiBEYXRhXCI7XHJcblxyXG4gICAgICAgIHZtLmNhbXBhaWducyA9IFtdO1xyXG4gICAgICAgIHZtLnJlYXNvbnMgPSBbXTtcclxuICAgICAgICB2bS5jdXJyZW50RWRpdCA9IHt9O1xyXG4gICAgICAgIHZtLml0ZW1Ub0VkaXQgPSB7fTtcclxuXHJcbiAgICAgICAgdm0ubWFpbGVycyA9IFtdO1xyXG4gICAgICAgIHZtLnNlYXJjaE1vZGVsID0ge1xyXG4gICAgICAgICAgICBwYWdlOiAxLFxyXG4gICAgICAgICAgICBwYWdlU2l6ZTogMTAsXHJcbiAgICAgICAgICAgIG9yZGVyQnk6ICdjYW1wYWlnbklkJyxcclxuICAgICAgICAgICAgb3JkZXJEaXJlY3Rpb246ICdkZXNjJyxcclxuICAgICAgICAgICAgc3VwcHJlc3M6IGZhbHNlXHJcbiAgICAgICAgfTtcclxuICAgICAgICB2bS5zdXByZXNzID0gZmFsc2U7XHJcbiAgICAgICAgLy92bS5kb3dubG9hZENzdiA9IGRvd25sb2FkQ3N2O1xyXG4gICAgICAgIHZtLmlzQnVzeSA9IGZhbHNlO1xyXG5cclxuICAgICAgICBhY3RpdmF0ZSgpO1xyXG5cclxuICAgICAgICBmdW5jdGlvbiBhY3RpdmF0ZSgpIHtcclxuICAgICAgICAgICAgbG9nZ2VyLmxvZyhjb250cm9sbGVySWQgKyAnIGFjdGl2YXRlZCcpO1xyXG4gICAgICAgICAgICBnZXRDYW1wYWlnbnMoKTtcclxuICAgICAgICAgICAgZ2V0UmVhc29ucygpO1xyXG4gICAgICAgIH1cclxuXHJcbiAgICAgICAgdm0uY2FuY2VsRWRpdCA9IGZ1bmN0aW9uIChpZCkge1xyXG4gICAgICAgICAgICB2bS5jdXJyZW50RWRpdFtpZF0gPSBmYWxzZTtcclxuICAgICAgICB9O1xyXG5cclxuICAgICAgICB2bS5lZGl0SXRlbSA9IGZ1bmN0aW9uIChpdGVtKSB7XHJcbiAgICAgICAgICAgIHZtLmN1cnJlbnRFZGl0W2l0ZW0uaWRdID0gdHJ1ZTtcclxuICAgICAgICAgICAgYW5ndWxhci5jb3B5KGl0ZW0sIHZtLml0ZW1Ub0VkaXQgPSB7fSk7XHJcbiAgICAgICAgfVxyXG5cclxuICAgICAgICB2bS5wYWdlZCA9IGZ1bmN0aW9uIHBhZ2VkKHBhZ2VOdW0pIHtcclxuICAgICAgICAgICAgdm0ubGFzdERlbGV0ZWQgPSBudWxsO1xyXG4gICAgICAgICAgICB2bS5sYXN0VXBkYXRlZCA9IG51bGw7XHJcbiAgICAgICAgICAgIHZtLnNlYXJjaCh0YWJsZVN0YXRlUmVmKTtcclxuICAgICAgICB9O1xyXG5cclxuICAgICAgICB2bS5zYXZlID0gZnVuY3Rpb24gKGl0ZW0pIHtcclxuICAgICAgICAgICAgdm0uY3VycmVudEVkaXRbaXRlbS5pZF0gPSBmYWxzZTtcclxuICAgICAgICAgICAgdm0uaXRlbVRvRWRpdC5zdXBwcmVzcyA9IHRydWU7XHJcbiAgICAgICAgICAgIG1haWxlclNlcnZpY2UudXBkYXRlKHZtLml0ZW1Ub0VkaXQpXHJcbiAgICAgICAgICAgICAgICAudGhlbihmdW5jdGlvbiAoZGF0YSkge1xyXG4gICAgICAgICAgICAgICAgICAgIGFuZ3VsYXIuZXh0ZW5kKGl0ZW0sIGRhdGEpO1xyXG4gICAgICAgICAgICAgICAgICAgIGxvZ2dlci5zdWNjZXNzKCdTdXBwcmVzc2VkICcgKyBpdGVtLmZpbmRlck51bWJlcik7XHJcbiAgICAgICAgICAgICAgICB9KTtcclxuICAgICAgICB9XHJcblxyXG4gICAgICAgIHZtLnNlYXJjaCA9IGZ1bmN0aW9uICh0YWJsZVN0YXRlKSB7XHJcbiAgICAgICAgICAgIHRhYmxlU3RhdGVSZWYgPSB0YWJsZVN0YXRlO1xyXG5cclxuICAgICAgICAgICAgaWYgKHR5cGVvZiAodGFibGVTdGF0ZS5zb3J0LnByZWRpY2F0ZSkgIT0gXCJ1bmRlZmluZWRcIikge1xyXG4gICAgICAgICAgICAgICAgdm0uc2VhcmNoTW9kZWwub3JkZXJCeSA9IHRhYmxlU3RhdGUuc29ydC5wcmVkaWNhdGU7XHJcbiAgICAgICAgICAgICAgICB2bS5zZWFyY2hNb2RlbC5vcmRlckRpcmVjdGlvbiA9IHRhYmxlU3RhdGUuc29ydC5yZXZlcnNlID8gJ2Rlc2MnIDogJ2FzYyc7XHJcbiAgICAgICAgICAgIH1cclxuICAgICAgICAgICAgaWYgKHR5cGVvZiAodGFibGVTdGF0ZS5zZWFyY2gucHJlZGljYXRlT2JqZWN0KSAhPSBcInVuZGVmaW5lZFwiKSB7XHJcbiAgICAgICAgICAgICAgICB2bS5zZWFyY2hNb2RlbC5maXJzdE5hbWUgPSB0YWJsZVN0YXRlLnNlYXJjaC5wcmVkaWNhdGVPYmplY3QuZmlyc3ROYW1lO1xyXG4gICAgICAgICAgICAgICAgdm0uc2VhcmNoTW9kZWwubGFzdE5hbWUgPSB0YWJsZVN0YXRlLnNlYXJjaC5wcmVkaWNhdGVPYmplY3QubGFzdE5hbWU7XHJcbiAgICAgICAgICAgICAgICB2bS5zZWFyY2hNb2RlbC5hZGRyZXNzID0gdGFibGVTdGF0ZS5zZWFyY2gucHJlZGljYXRlT2JqZWN0LmFkZHJlc3M7XHJcbiAgICAgICAgICAgICAgICB2bS5zZWFyY2hNb2RlbC5jaXR5ID0gdGFibGVTdGF0ZS5zZWFyY2gucHJlZGljYXRlT2JqZWN0LmNpdHk7XHJcbiAgICAgICAgICAgICAgICB2bS5zZWFyY2hNb2RlbC5zdGF0ZSA9IHRhYmxlU3RhdGUuc2VhcmNoLnByZWRpY2F0ZU9iamVjdC5zdGF0ZTtcclxuICAgICAgICAgICAgICAgIHZtLnNlYXJjaE1vZGVsLnppcGNvZGUgPSB0YWJsZVN0YXRlLnNlYXJjaC5wcmVkaWNhdGVPYmplY3QuemlwY29kZTtcclxuICAgICAgICAgICAgICAgIHZtLnNlYXJjaE1vZGVsLmZpbmRlck51bWJlciA9IHRhYmxlU3RhdGUuc2VhcmNoLnByZWRpY2F0ZU9iamVjdC5maW5kZXJOdW1iZXI7XHJcbiAgICAgICAgICAgICAgICB2bS5zZWFyY2hNb2RlbC5zb3VyY2VDb2RlID0gdGFibGVTdGF0ZS5zZWFyY2gucHJlZGljYXRlT2JqZWN0LnNvdXJjZUNvZGU7XHJcbiAgICAgICAgICAgICAgICB2bS5zZWFyY2hNb2RlbC5jYW1wYWlnbklkID0gdGFibGVTdGF0ZS5zZWFyY2gucHJlZGljYXRlT2JqZWN0LmNhbXBhaWduSWQ7XHJcbiAgICAgICAgICAgICAgICB2bS5zZWFyY2hNb2RlbC5yZWFzb25JZCA9IHRhYmxlU3RhdGUuc2VhcmNoLnByZWRpY2F0ZU9iamVjdC5yZWFzb25JZDtcclxuICAgICAgICAgICAgfVxyXG5cclxuICAgICAgICAgICAgdm0uaXNCdXN5ID0gdHJ1ZTtcclxuICAgICAgICAgICAgbWFpbGVyU2VydmljZS5xdWVyeSh2bS5zZWFyY2hNb2RlbClcclxuICAgICAgICAgICAgICAgIC50aGVuKGZ1bmN0aW9uIChkYXRhKSB7XHJcbiAgICAgICAgICAgICAgICAgICAgdm0ubWFpbGVycyA9IGRhdGEuaXRlbXM7XHJcbiAgICAgICAgICAgICAgICAgICAgdm0uc2VhcmNoTW9kZWwgPSBkYXRhO1xyXG4gICAgICAgICAgICAgICAgICAgIHZtLmlzQnVzeSA9IGZhbHNlO1xyXG4gICAgICAgICAgICAgICAgfSk7XHJcbiAgICAgICAgfVxyXG5cclxuICAgICAgICB2bS5maWx0ZXJTdXBwcmVzcyA9IGZ1bmN0aW9uICgpIHtcclxuICAgICAgICAgICAgdm0uc2VhcmNoKHRhYmxlU3RhdGVSZWYpO1xyXG4gICAgICAgIH1cclxuXHJcbiAgICAgICAgZnVuY3Rpb24gZ2V0Q2FtcGFpZ25zKCkge1xyXG4gICAgICAgICAgICBjYW1wYWlnblNlcnZpY2UuZ2V0KClcclxuICAgICAgICAgICAgICAgIC50aGVuKGZ1bmN0aW9uIChkYXRhKSB7XHJcbiAgICAgICAgICAgICAgICAgICAgdm0uY2FtcGFpZ25zID0gZGF0YTtcclxuICAgICAgICAgICAgICAgIH0pO1xyXG4gICAgICAgIH1cclxuXHJcbiAgICAgICAgZnVuY3Rpb24gZ2V0UmVhc29ucygpIHtcclxuICAgICAgICAgICAgcmVhc29uU2VydmljZS5nZXQoKVxyXG4gICAgICAgICAgICAgICAgLnRoZW4oZnVuY3Rpb24gKGRhdGEpIHtcclxuICAgICAgICAgICAgICAgICAgICB2bS5yZWFzb25zID0gZGF0YTtcclxuICAgICAgICAgICAgICAgIH0pO1xyXG4gICAgICAgIH1cclxuICAgIH1cclxufSkoKTsiLCIvL21hcmsubGF3cmVuY2VcclxuLy9uYXYuanNcclxuXHJcbihmdW5jdGlvbiAoKSB7XHJcbiAgICAndXNlIHN0cmljdCc7XHJcblxyXG4gICAgdmFyIGNvbnRyb2xsZXJJZCA9ICdOYXZDb250cm9sbGVyJztcclxuXHJcbiAgICBhbmd1bGFyLm1vZHVsZSgnYXBwLm5hdicpLmNvbnRyb2xsZXIoY29udHJvbGxlcklkLCBtYWluQ29udHJvbGxlcik7XHJcblxyXG4gICAgbWFpbkNvbnRyb2xsZXIuJGluamVjdCA9IFsnbG9nZ2VyJ107XHJcblxyXG4gICAgZnVuY3Rpb24gbWFpbkNvbnRyb2xsZXIobG9nZ2VyKSB7XHJcbiAgICAgICAgdmFyIHZtID0gdGhpcztcclxuXHJcbiAgICAgICAgYWN0aXZhdGUoKTtcclxuXHJcbiAgICAgICAgZnVuY3Rpb24gYWN0aXZhdGUoKSB7XHJcbiAgICAgICAgICAgIGxvZ2dlci5sb2coY29udHJvbGxlcklkICsgJyBhY3RpdmF0ZWQnKTtcclxuICAgICAgICAgICAgdm0udXNlciA9IEpTT04ucGFyc2UobG9jYWxTdG9yYWdlLmdldEl0ZW0oJ2N1cnJlbnRVc2VyJykpO1xyXG4gICAgICAgIH1cclxuICAgIH07XHJcbn0pKCk7IiwiLy9tYXJrLmxhd3JlbmNlXHJcbi8vY2FtcGFpZ24uc2VydmljZS5qc1xyXG5cclxuKGZ1bmN0aW9uICgpIHtcclxuICAgICd1c2Ugc3RyaWN0JztcclxuXHJcbiAgICB2YXIgc2VydmljZUlkID0gJ2NhbXBhaWduU2VydmljZSc7XHJcbiAgICBhbmd1bGFyLm1vZHVsZSgnYXBwLnNlcnZpY2UnKS5mYWN0b3J5KHNlcnZpY2VJZCwgc2VydmljZUNvbnRyb2xsZXIpO1xyXG5cclxuICAgIGZ1bmN0aW9uIHNlcnZpY2VDb250cm9sbGVyKGxvZ2dlciwgJGh0dHAsIGNvbmZpZykge1xyXG4gICAgICAgIGxvZ2dlci5sb2coc2VydmljZUlkICsgJyBsb2FkZWQnKTtcclxuICAgICAgICB2YXIgdXJsID0gY29uZmlnLmFwaVVybCArIGNvbmZpZy5hcGlFbmRQb2ludHMuQ2FtcGFpZ247XHJcblxyXG4gICAgICAgIHZhciBzZXJ2aWNlID0ge1xyXG4gICAgICAgICAgICBnZXQ6IGdldCxcclxuICAgICAgICAgICAgdXBkYXRlOiB1cGRhdGUsXHJcbiAgICAgICAgICAgIHF1ZXJ5OiBxdWVyeVxyXG4gICAgICAgICAgICAvLyAgICAgICAgICAgIHJlbW92ZTogcmVtb3ZlLFxyXG4gICAgICAgICAgICAvLyAgICAgICAgICAgIHNhdmU6IHNhdmUsXHJcbiAgICAgICAgICAgIC8vICAgICAgICAgICAgc2VhcmNoOiBzZWFyY2gsXHJcbiAgICAgICAgfVxyXG5cclxuICAgICAgICByZXR1cm4gc2VydmljZTtcclxuXHJcbiAgICAgICAgZnVuY3Rpb24gZ2V0KCkge1xyXG4gICAgICAgICAgICByZXR1cm4gJGh0dHAuZ2V0KHVybClcclxuICAgICAgICAgICAgICAgIC50aGVuKGZ1bmN0aW9uIChyZXNwb25zZSkge1xyXG4gICAgICAgICAgICAgICAgICAgIHJldHVybiByZXNwb25zZS5kYXRhO1xyXG4gICAgICAgICAgICAgICAgfSk7XHJcbiAgICAgICAgfVxyXG5cclxuICAgICAgICBmdW5jdGlvbiBxdWVyeShuYW1lKSB7XHJcbiAgICAgICAgICAgIHJldHVybiAkaHR0cC5nZXQodXJsICsgJy8nICsgbmFtZSlcclxuICAgICAgICAgICAgICAgIC50aGVuKGZ1bmN0aW9uIChyZXNwb25zZSkge1xyXG4gICAgICAgICAgICAgICAgICAgIHJldHVybiByZXNwb25zZS5kYXRhO1xyXG4gICAgICAgICAgICAgICAgfSk7XHJcbiAgICAgICAgfVxyXG5cclxuICAgICAgICBmdW5jdGlvbiB1cGRhdGUodGVtcGxhdGUpIHtcclxuICAgICAgICAgICAgcmV0dXJuICRodHRwLnB1dCh1cmwsIHRlbXBsYXRlKVxyXG4gICAgICAgICAgICAgICAgLnRoZW4oZnVuY3Rpb24gKHJlc3BvbnNlKSB7XHJcbiAgICAgICAgICAgICAgICAgICAgcmV0dXJuIHJlc3BvbnNlLmRhdGE7XHJcbiAgICAgICAgICAgICAgICB9KTtcclxuICAgICAgICB9XHJcbiAgICB9XHJcbn0pKCk7IiwiLy9jb25zdGl0dWVudC5zZXJ2aWNlLmpzXHJcbi8vbWFyay5sYXdyZW5jZVxyXG5cclxuKGZ1bmN0aW9uICgpIHtcclxuICAgICd1c2Ugc3RyaWN0JztcclxuXHJcbiAgICB2YXIgc2VydmljZUlkID0gJ2NvbnN0aXR1ZW50U2VydmljZSc7XHJcbiAgICBhbmd1bGFyLm1vZHVsZSgnYXBwLnNlcnZpY2UnKS5mYWN0b3J5KHNlcnZpY2VJZCwgc2VydmljZUNvbnRyb2xsZXIpO1xyXG5cclxuICAgIGZ1bmN0aW9uIHNlcnZpY2VDb250cm9sbGVyKGxvZ2dlciwgJGh0dHAsIGNvbmZpZykge1xyXG4gICAgICAgIGxvZ2dlci5sb2coc2VydmljZUlkICsgJyBsb2FkZWQnKTtcclxuICAgICAgICB2YXIgdXJsID0gY29uZmlnLmFwaVVybCArIGNvbmZpZy5hcGlFbmRQb2ludHMuQ29uc3RpdHVlbnQ7XHJcblxyXG4gICAgICAgIHZhciBzZXJ2aWNlID0ge1xyXG4gICAgICAgICAgICBxdWVyeTogcXVlcnksXHJcbiAgICAgICAgICAgIHVwZGF0ZTogdXBkYXRlLFxyXG5cclxuICAgICAgICAgICAgLy9UT0RPOiBSZW1vdmU/Pz9cclxuICAgICAgICAgICAgcmVtb3ZlOiByZW1vdmUsXHJcbiAgICAgICAgICAgIGdldDogZ2V0LFxyXG4gICAgICAgICAgICBjcmVhdGU6IGNyZWF0ZSxcclxuICAgICAgICAgICAgZG93bmxvYWQ6IGRvd25sb2FkLFxyXG4gICAgICAgICAgICBzYXZlOiBzYXZlXHJcbiAgICAgICAgfVxyXG5cclxuICAgICAgICByZXR1cm4gc2VydmljZTtcclxuXHJcbiAgICAgICAgZnVuY3Rpb24gY3JlYXRlKCkge1xyXG4gICAgICAgIH1cclxuXHJcbiAgICAgICAgZnVuY3Rpb24gZG93bmxvYWQodm0pIHtcclxuICAgICAgICAgICAgdm0uYWxsUmVjb3JkcyA9IHRydWU7XHJcbiAgICAgICAgICAgIHJldHVybiAkaHR0cC5wb3N0KFVSTCArICcvc2VhcmNoJywgdm0pXHJcbiAgICAgICAgICAgICAgICAudGhlbihmdW5jdGlvbiAocmVzcG9uc2UpIHtcclxuICAgICAgICAgICAgICAgICAgICByZXR1cm4gcmVzcG9uc2UuZGF0YTtcclxuICAgICAgICAgICAgICAgIH0pO1xyXG4gICAgICAgIH1cclxuXHJcbiAgICAgICAgZnVuY3Rpb24gZ2V0KGlkKSB7XHJcbiAgICAgICAgICAgIHJldHVybiAkaHR0cC5nZXQoVVJMICsgJy9pZCcpXHJcbiAgICAgICAgICAgICAgICAudGhlbihmdW5jdGlvbiAocmVzcG9uc2UpIHtcclxuICAgICAgICAgICAgICAgICAgICByZXR1cm4gcmVzcG9uc2UuZGF0YTtcclxuICAgICAgICAgICAgICAgIH0pO1xyXG4gICAgICAgIH1cclxuXHJcbiAgICAgICAgZnVuY3Rpb24gcXVlcnkodm0pIHtcclxuICAgICAgICAgICAgcmV0dXJuICRodHRwLnBvc3QodXJsICsgJy9zZWFyY2gnLCB2bSlcclxuICAgICAgICAgICAgICAudGhlbihmdW5jdGlvbiAocmVzcG9uc2UpIHtcclxuICAgICAgICAgICAgICAgICAgcmV0dXJuIHJlc3BvbnNlLmRhdGE7XHJcbiAgICAgICAgICAgICAgfSk7XHJcbiAgICAgICAgfVxyXG5cclxuICAgICAgICBmdW5jdGlvbiB1cGRhdGUoaXRlbSkge1xyXG4gICAgICAgICAgICByZXR1cm4gJGh0dHAucHV0KHVybCwgaXRlbSlcclxuICAgICAgICAgICAgICAgIC50aGVuKGZ1bmN0aW9uIChyZXNwb25zZSkge1xyXG4gICAgICAgICAgICAgICAgICAgIHJldHVybiByZXNwb25zZS5kYXRhO1xyXG4gICAgICAgICAgICAgICAgfSk7XHJcbiAgICAgICAgfVxyXG5cclxuICAgICAgICBmdW5jdGlvbiByZW1vdmUoKSB7IH1cclxuXHJcbiAgICAgICAgZnVuY3Rpb24gc2F2ZSgpIHsgfVxyXG4gICAgfVxyXG59KSgpOyIsIi8vbWFyay5sYXdyZW5jZVxyXG4vL2V2ZW50LnNlcnZpY2UuanNcclxuXHJcbihmdW5jdGlvbiAoKSB7XHJcbiAgICAndXNlIHN0cmljdCc7XHJcblxyXG4gICAgdmFyIHNlcnZpY2VJZCA9ICdldmVudFNlcnZpY2UnO1xyXG4gICAgYW5ndWxhci5tb2R1bGUoJ2FwcC5zZXJ2aWNlJykuZmFjdG9yeShzZXJ2aWNlSWQsIHNlcnZpY2VDb250cm9sbGVyKTtcclxuXHJcbiAgICBmdW5jdGlvbiBzZXJ2aWNlQ29udHJvbGxlcihsb2dnZXIsICRodHRwLCBjb25maWcpIHtcclxuICAgICAgICBsb2dnZXIubG9nKHNlcnZpY2VJZCArICcgbG9hZGVkJyk7XHJcbiAgICAgICAgdmFyIHVybCA9IGNvbmZpZy5hcGlVcmwgKyBjb25maWcuYXBpRW5kUG9pbnRzLkV2ZW50O1xyXG5cclxuICAgICAgICB2YXIgc2VydmljZSA9IHtcclxuICAgICAgICAgICAgY3JlYXRlOiBjcmVhdGUsXHJcbiAgICAgICAgICAgIHJlbW92ZTogcmVtb3ZlLFxyXG4gICAgICAgICAgICBnZXQ6IGdldCxcclxuICAgICAgICAgICAgZ2V0QnlJZDogZ2V0QnlJZCxcclxuICAgICAgICAgICAgZ2V0R3Vlc3RzOiBnZXRHdWVzdHMsIFxyXG4gICAgICAgICAgICB1cGRhdGU6IHVwZGF0ZSxcclxuICAgICAgICAgICAgcXVlcnk6IHF1ZXJ5XHJcbiAgICAgICAgfVxyXG5cclxuICAgICAgICByZXR1cm4gc2VydmljZTtcclxuXHJcbiAgICAgICAgZnVuY3Rpb24gY3JlYXRlKGV2ZW50KSB7XHJcbiAgICAgICAgICAgIHJldHVybiAkaHR0cC5wb3N0KHVybCwgZXZlbnQpXHJcbiAgICAgICAgICAgICAgICAudGhlbihfc3VjY2VzcykuY2F0Y2goZXJyb3IpO1xyXG4gICAgICAgIH1cclxuXHJcbiAgICAgICAgZnVuY3Rpb24gcmVtb3ZlKGlkKSB7XHJcbiAgICAgICAgICAgIHJldHVybiAkaHR0cC5kZWxldGUodXJsICsgJy8nICsgaWQpLnRoZW4oX3N1Y2Nlc3MpLmNhdGNoKGVycm9yKTtcclxuICAgICAgICB9O1xyXG5cclxuICAgICAgICBmdW5jdGlvbiBnZXQoKSB7XHJcbiAgICAgICAgICAgIHJldHVybiAkaHR0cC5nZXQodXJsKVxyXG4gICAgICAgICAgICAgICAgLnRoZW4oX3N1Y2Nlc3MpLmNhdGNoKGVycm9yKTtcclxuICAgICAgICB9XHJcblxyXG4gICAgICAgIGZ1bmN0aW9uIGdldEJ5SWQoaWQpIHtcclxuICAgICAgICAgICAgcmV0dXJuICRodHRwLmdldCh1cmwgKyAnLycgKyBpZClcclxuICAgICAgICAgICAgICAgIC50aGVuKF9zdWNjZXNzKS5jYXRjaChlcnJvcik7XHJcbiAgICAgICAgfVxyXG5cclxuICAgICAgICBmdW5jdGlvbiBnZXRHdWVzdHMoaWQsIHZtKSB7XHJcbiAgICAgICAgICAgIHJldHVybiAkaHR0cC5wb3N0KHVybCArICcvJyArIGlkICsgJy9ndWVzdHMnLCB2bSlcclxuICAgICAgICAgICAgICAgIC50aGVuKF9zdWNjZXNzKS5jYXRjaChlcnJvcik7XHJcbiAgICAgICAgfVxyXG5cclxuICAgICAgICBmdW5jdGlvbiBxdWVyeShuYW1lKSB7XHJcbiAgICAgICAgICAgIHJldHVybiAkaHR0cC5nZXQodXJsICsgJy8nICsgbmFtZSlcclxuICAgICAgICAgICAgICAgIC50aGVuKF9zdWNjZXNzKS5jYXRjaChlcnJvcik7XHJcbiAgICAgICAgfVxyXG5cclxuICAgICAgICBmdW5jdGlvbiB1cGRhdGUoZXZlbnQpIHtcclxuICAgICAgICAgICAgcmV0dXJuICRodHRwLnB1dCh1cmwsIGV2ZW50KVxyXG4gICAgICAgICAgICAgICAgLnRoZW4oX3N1Y2Nlc3MpLmNhdGNoKGVycm9yKTtcclxuICAgICAgICB9XHJcblxyXG4gICAgICAgIGZ1bmN0aW9uIF9zdWNjZXNzKHJlc3BvbnNlKSB7XHJcbiAgICAgICAgICAgIHJldHVybiByZXNwb25zZS5kYXRhO1xyXG4gICAgICAgIH07XHJcblxyXG4gICAgICAgIGZ1bmN0aW9uIGVycm9yKGVycm9yKSB7XHJcbiAgICAgICAgICAgIHJldHVybiBlcnJvci5kYXRhLm1lc3NhZ2U7IFxyXG4gICAgICAgIH1cclxuICAgIH1cclxufSkoKTsiLCIvL21hcmsubGF3cmVuY2VcclxuLy9maWxlLnNlcnZpY2UuanNcclxuXHJcbihmdW5jdGlvbiAoKSB7XHJcblxyXG4gICAgJ3VzZSBzdHJpY3QnO1xyXG5cclxuICAgIHZhciBzZXJ2aWNlSWQgPSAnZmlsZVNlcnZpY2UnO1xyXG4gICAgYW5ndWxhci5tb2R1bGUoJ2FwcC5zZXJ2aWNlJykuZmFjdG9yeShzZXJ2aWNlSWQsIHNlcnZpY2VDb250cm9sbGVyKTtcclxuXHJcbiAgICBmdW5jdGlvbiBzZXJ2aWNlQ29udHJvbGxlcihsb2dnZXIsICRodHRwLCBjb25maWcpIHtcclxuICAgICAgICBsb2dnZXIubG9nKHNlcnZpY2VJZCArICcgbG9hZGVkJyk7XHJcbiAgICAgICAgdmFyIHVybCA9IGNvbmZpZy5hcGlVcmwgKyBjb25maWcuYXBpRW5kUG9pbnRzLkZpbGU7XHJcblxyXG4gICAgICAgIHZhciBzZXJ2aWNlID0ge1xyXG4gICAgICAgICAgICBndWVzdDogZ3Vlc3RcclxuICAgICAgICB9XHJcblxyXG4gICAgICAgIHJldHVybiBzZXJ2aWNlO1xyXG5cclxuICAgICAgICBmdW5jdGlvbiBndWVzdChpZCwgZGF0YWZpbGUpIHtcclxuICAgICAgICAgICAgcmV0dXJuICRodHRwLnBvc3QodXJsICsgJy9ndWVzdC8nICsgaWQsIGZvcm1EYXRhT2JqZWN0KGRhdGFmaWxlKSwge1xyXG4gICAgICAgICAgICAgICAgdHJhbnNmb3JtUmVxdWVzdDogYW5ndWxhci5pZGVudGl0eSxcclxuICAgICAgICAgICAgICAgIGhlYWRlcnM6IHsgJ0NvbnRlbnQtVHlwZSc6IHVuZGVmaW5lZCB9XHJcbiAgICAgICAgICAgIH0pLnRoZW4oZnVuY3Rpb24gKHJlc3BvbnNlKSB7XHJcbiAgICAgICAgICAgICAgICByZXR1cm4gcmVzcG9uc2UuZGF0YTtcclxuICAgICAgICAgICAgfSk7XHJcbiAgICAgICAgfVxyXG5cclxuICAgICAgICBmdW5jdGlvbiBmb3JtRGF0YU9iamVjdChkYXRhKSB7XHJcbiAgICAgICAgICAgIHZhciBmZCA9IG5ldyBGb3JtRGF0YSgpO1xyXG4gICAgICAgICAgICBmZC5hcHBlbmQoJ2ZpbGUnLCBkYXRhKTtcclxuICAgICAgICAgICAgcmV0dXJuIGZkO1xyXG4gICAgICAgIH1cclxuICAgIH1cclxufSkoKTsiLCIvL21hcmsubGF3cmVuY2VcclxuLy9ndWVzdC5zZXJ2aWNlLmpzXHJcblxyXG4oZnVuY3Rpb24gKCkge1xyXG4gICAgJ3VzZSBzdHJpY3QnO1xyXG5cclxuICAgIHZhciBzZXJ2aWNlSWQgPSAnZ3Vlc3RTZXJ2aWNlJztcclxuICAgIGFuZ3VsYXIubW9kdWxlKCdhcHAuc2VydmljZScpLmZhY3Rvcnkoc2VydmljZUlkLCBzZXJ2aWNlQ29udHJvbGxlcik7XHJcblxyXG4gICAgZnVuY3Rpb24gc2VydmljZUNvbnRyb2xsZXIobG9nZ2VyLCAkaHR0cCwgY29uZmlnKSB7XHJcbiAgICAgICAgbG9nZ2VyLmxvZyhzZXJ2aWNlSWQgKyAnIGxvYWRlZCcpO1xyXG4gICAgICAgIHZhciB1cmwgPSBjb25maWcuYXBpVXJsICsgY29uZmlnLmFwaUVuZFBvaW50cy5HdWVzdDtcclxuXHJcbiAgICAgICAgdmFyIHNlcnZpY2UgPSB7XHJcbiAgICAgICAgICAgIGNyZWF0ZTogY3JlYXRlLFxyXG4gICAgICAgICAgICByZW1vdmU6IHJlbW92ZSxcclxuICAgICAgICAgICAgZ2V0OiBnZXQsXHJcbiAgICAgICAgICAgIGdldEJ5SWQ6IGdldEJ5SWQsXHJcbiAgICAgICAgICAgIHVwZGF0ZTogdXBkYXRlLFxyXG4gICAgICAgICAgICBxdWVyeTogcXVlcnlcclxuICAgICAgICB9XHJcblxyXG4gICAgICAgIHJldHVybiBzZXJ2aWNlO1xyXG5cclxuICAgICAgICBmdW5jdGlvbiBjcmVhdGUoZXZlbnQpIHtcclxuICAgICAgICAgICAgcmV0dXJuICRodHRwLnBvc3QodXJsLCBldmVudClcclxuICAgICAgICAgICAgICAgIC50aGVuKGZ1bmN0aW9uIChyZXNwb25zZSkge1xyXG4gICAgICAgICAgICAgICAgICAgIHJldHVybiByZXNwb25zZS5kYXRhO1xyXG4gICAgICAgICAgICAgICAgfSk7XHJcbiAgICAgICAgfVxyXG5cclxuICAgICAgICBmdW5jdGlvbiByZW1vdmUoaWQpIHtcclxuICAgICAgICAgICAgcmV0dXJuICRodHRwLmRlbGV0ZSh1cmwgKyAnLycgKyBpZCkudGhlbihfc3VjY2Vzcyk7XHJcbiAgICAgICAgfTtcclxuXHJcbiAgICAgICAgZnVuY3Rpb24gZ2V0KCkge1xyXG4gICAgICAgICAgICByZXR1cm4gJGh0dHAuZ2V0KHVybClcclxuICAgICAgICAgICAgICAgIC50aGVuKGZ1bmN0aW9uIChyZXNwb25zZSkge1xyXG4gICAgICAgICAgICAgICAgICAgIHJldHVybiByZXNwb25zZS5kYXRhO1xyXG4gICAgICAgICAgICAgICAgfSk7XHJcbiAgICAgICAgfVxyXG5cclxuICAgICAgICBmdW5jdGlvbiBnZXRCeUlkKGlkKSB7XHJcbiAgICAgICAgICAgIHJldHVybiAkaHR0cC5nZXQodXJsICsgJy8nICsgaWQpXHJcbiAgICAgICAgICAgICAgICAudGhlbihmdW5jdGlvbiAocmVzcG9uc2UpIHtcclxuICAgICAgICAgICAgICAgICAgICByZXR1cm4gcmVzcG9uc2UuZGF0YTtcclxuICAgICAgICAgICAgICAgIH0pO1xyXG4gICAgICAgIH1cclxuXHJcbiAgICAgICAgZnVuY3Rpb24gcXVlcnkobmFtZSkge1xyXG4gICAgICAgICAgICByZXR1cm4gJGh0dHAuZ2V0KHVybCArICcvJyArIG5hbWUpXHJcbiAgICAgICAgICAgICAgICAudGhlbihmdW5jdGlvbiAocmVzcG9uc2UpIHtcclxuICAgICAgICAgICAgICAgICAgICByZXR1cm4gcmVzcG9uc2UuZGF0YTtcclxuICAgICAgICAgICAgICAgIH0pO1xyXG4gICAgICAgIH1cclxuXHJcbiAgICAgICAgZnVuY3Rpb24gdXBkYXRlKGV2ZW50KSB7XHJcbiAgICAgICAgICAgIHJldHVybiAkaHR0cC5wdXQodXJsLCBldmVudClcclxuICAgICAgICAgICAgICAgIC50aGVuKGZ1bmN0aW9uIChyZXNwb25zZSkge1xyXG4gICAgICAgICAgICAgICAgICAgIHJldHVybiByZXNwb25zZS5kYXRhO1xyXG4gICAgICAgICAgICAgICAgfSk7XHJcbiAgICAgICAgfVxyXG5cclxuICAgICAgICBmdW5jdGlvbiBfc3VjY2VzcyhyZXNwb25zZSkge1xyXG4gICAgICAgICAgICByZXR1cm4gcmVzcG9uc2UuZGF0YTtcclxuICAgICAgICB9O1xyXG4gICAgfVxyXG59KSgpOyIsIi8vbWFyay5sYXdyZW5jZVxyXG4vL21haWxlci5zZXJ2aWNlLmpzXHJcblxyXG4oZnVuY3Rpb24gKCkge1xyXG4gICAgJ3VzZSBzdHJpY3QnO1xyXG5cclxuICAgIHZhciBzZXJ2aWNlSWQgPSAnbWFpbGVyU2VydmljZSc7XHJcbiAgICBhbmd1bGFyLm1vZHVsZSgnYXBwLnNlcnZpY2UnKS5mYWN0b3J5KHNlcnZpY2VJZCwgc2VydmljZUNvbnRyb2xsZXIpO1xyXG5cclxuICAgIGZ1bmN0aW9uIHNlcnZpY2VDb250cm9sbGVyKGxvZ2dlciwgJGh0dHAsIGNvbmZpZykge1xyXG4gICAgICAgIGxvZ2dlci5sb2coc2VydmljZUlkICsgJyBsb2FkZWQnKTtcclxuICAgICAgICB2YXIgdXJsID0gY29uZmlnLmFwaVVybCArIGNvbmZpZy5hcGlFbmRQb2ludHMuTWFpbGVyO1xyXG5cclxuICAgICAgICB2YXIgc2VydmljZSA9IHtcclxuICAgICAgICAgICAgZ2V0OiBnZXQsXHJcbiAgICAgICAgICAgIHF1ZXJ5OiBxdWVyeSxcclxuICAgICAgICAgICAgdXBkYXRlOiB1cGRhdGVcclxuICAgICAgICAgICAgLy8gICAgICAgICAgICByZW1vdmU6IHJlbW92ZSxcclxuICAgICAgICAgICAgLy8gICAgICAgICAgICBzYXZlOiBzYXZlLFxyXG4gICAgICAgICAgICAvLyAgICAgICAgICAgIHNlYXJjaDogc2VhcmNoLFxyXG4gICAgICAgIH1cclxuXHJcbiAgICAgICAgcmV0dXJuIHNlcnZpY2U7XHJcblxyXG4gICAgICAgIGZ1bmN0aW9uIGdldChpZCkge1xyXG4gICAgICAgICAgICByZXR1cm4gJGh0dHAuZ2V0KFVSTCArICcvaWQnKVxyXG4gICAgICAgICAgICAgICAgLnRoZW4oZnVuY3Rpb24gKHJlc3BvbnNlKSB7XHJcbiAgICAgICAgICAgICAgICAgICAgcmV0dXJuIHJlc3BvbnNlLmRhdGE7XHJcbiAgICAgICAgICAgICAgICB9KTtcclxuICAgICAgICB9XHJcblxyXG4gICAgICAgIGZ1bmN0aW9uIHF1ZXJ5KHZtKSB7XHJcbiAgICAgICAgICAgIHJldHVybiAkaHR0cC5wb3N0KHVybCArICcvc2VhcmNoJywgdm0pXHJcbiAgICAgICAgICAgICAgICAudGhlbihmdW5jdGlvbiAocmVzcG9uc2UpIHtcclxuICAgICAgICAgICAgICAgICAgICByZXR1cm4gcmVzcG9uc2UuZGF0YTtcclxuICAgICAgICAgICAgICAgIH0pO1xyXG4gICAgICAgIH1cclxuXHJcbiAgICAgICAgZnVuY3Rpb24gdXBkYXRlKGl0ZW0pIHtcclxuICAgICAgICAgICAgcmV0dXJuICRodHRwLnB1dCh1cmwsIGl0ZW0pXHJcbiAgICAgICAgICAgICAgICAudGhlbihmdW5jdGlvbiAocmVzcG9uc2UpIHtcclxuICAgICAgICAgICAgICAgICAgICByZXR1cm4gcmVzcG9uc2UuZGF0YTtcclxuICAgICAgICAgICAgICAgIH0pO1xyXG4gICAgICAgIH1cclxuICAgIH1cclxufSkoKTsiLCIvL21hcmsubGF3cmVuY2VcclxuLy9yZWFzb24uc2VydmljZS5qc1xyXG5cclxuKGZ1bmN0aW9uICgpIHtcclxuICAgICd1c2Ugc3RyaWN0JztcclxuXHJcbiAgICB2YXIgc2VydmljZUlkID0gJ3JlYXNvblNlcnZpY2UnO1xyXG4gICAgYW5ndWxhci5tb2R1bGUoJ2FwcC5zZXJ2aWNlJykuZmFjdG9yeShzZXJ2aWNlSWQsIHNlcnZpY2VDb250cm9sbGVyKTtcclxuXHJcbiAgICBmdW5jdGlvbiBzZXJ2aWNlQ29udHJvbGxlcihsb2dnZXIsICRodHRwLCBjb25maWcpIHtcclxuICAgICAgICBsb2dnZXIubG9nKHNlcnZpY2VJZCArICcgbG9hZGVkJyk7XHJcbiAgICAgICAgdmFyIHVybCA9IGNvbmZpZy5hcGlVcmwgKyBjb25maWcuYXBpRW5kUG9pbnRzLlJlYXNvbjtcclxuXHJcbiAgICAgICAgdmFyIHNlcnZpY2UgPSB7XHJcbiAgICAgICAgICAgIGdldDogZ2V0LFxyXG4gICAgICAgICAgICB1cGRhdGU6IHVwZGF0ZSxcclxuICAgICAgICAgICAgcXVlcnk6IHF1ZXJ5XHJcbiAgICAgICAgICAgIC8vICAgICAgICAgICAgcmVtb3ZlOiByZW1vdmUsXHJcbiAgICAgICAgICAgIC8vICAgICAgICAgICAgc2F2ZTogc2F2ZSxcclxuICAgICAgICAgICAgLy8gICAgICAgICAgICBzZWFyY2g6IHNlYXJjaCxcclxuICAgICAgICB9XHJcblxyXG4gICAgICAgIHJldHVybiBzZXJ2aWNlO1xyXG5cclxuICAgICAgICBmdW5jdGlvbiBnZXQoKSB7XHJcbiAgICAgICAgICAgIHJldHVybiAkaHR0cC5nZXQodXJsKVxyXG4gICAgICAgICAgICAgICAgLnRoZW4oZnVuY3Rpb24gKHJlc3BvbnNlKSB7XHJcbiAgICAgICAgICAgICAgICAgICAgcmV0dXJuIHJlc3BvbnNlLmRhdGE7XHJcbiAgICAgICAgICAgICAgICB9KTtcclxuICAgICAgICB9XHJcblxyXG4gICAgICAgIGZ1bmN0aW9uIHF1ZXJ5KG5hbWUpIHtcclxuICAgICAgICAgICAgcmV0dXJuICRodHRwLmdldCh1cmwgKyAnLycgKyBuYW1lKVxyXG4gICAgICAgICAgICAgICAgLnRoZW4oZnVuY3Rpb24gKHJlc3BvbnNlKSB7XHJcbiAgICAgICAgICAgICAgICAgICAgcmV0dXJuIHJlc3BvbnNlLmRhdGE7XHJcbiAgICAgICAgICAgICAgICB9KTtcclxuICAgICAgICB9XHJcblxyXG4gICAgICAgIGZ1bmN0aW9uIHVwZGF0ZSh0ZW1wbGF0ZSkge1xyXG4gICAgICAgICAgICByZXR1cm4gJGh0dHAucHV0KHVybCwgdGVtcGxhdGUpXHJcbiAgICAgICAgICAgICAgICAudGhlbihmdW5jdGlvbiAocmVzcG9uc2UpIHtcclxuICAgICAgICAgICAgICAgICAgICByZXR1cm4gcmVzcG9uc2UuZGF0YTtcclxuICAgICAgICAgICAgICAgIH0pO1xyXG4gICAgICAgIH1cclxuICAgIH1cclxufSkoKTsiLCIvL3RheC5zZXJ2aWNlLmpzXHJcbi8vbWFyay5sYXdyZW5jZVxyXG5cclxuKGZ1bmN0aW9uICgpIHtcclxuICAgICd1c2Ugc3RyaWN0JztcclxuXHJcbiAgICB2YXIgc2VydmljZUlkID0gJ3RheFNlcnZpY2UnO1xyXG4gICAgYW5ndWxhci5tb2R1bGUoJ2FwcC5zZXJ2aWNlJykuZmFjdG9yeShzZXJ2aWNlSWQsIHNlcnZpY2VDb250cm9sbGVyKTtcclxuXHJcbiAgICBmdW5jdGlvbiBzZXJ2aWNlQ29udHJvbGxlcihsb2dnZXIsICRodHRwLCBjb25maWcpIHtcclxuICAgICAgICBsb2dnZXIubG9nKHNlcnZpY2VJZCArICcgbG9hZGVkJyk7XHJcbiAgICAgICAgdmFyIHVybCA9IGNvbmZpZy5hcGlVcmwgKyBjb25maWcuYXBpRW5kUG9pbnRzLlRheDtcclxuXHJcbiAgICAgICAgdmFyIHNlcnZpY2UgPSB7XHJcbiAgICAgICAgICAgIGNyZWF0ZTogY3JlYXRlLFxyXG4gICAgICAgICAgICByZW1vdmU6IHJlbW92ZSxcclxuICAgICAgICAgICAgdXBkYXRlOiB1cGRhdGVcclxuXHJcbiAgICAgICAgICAgIC8vVE9ETzogUmVtb3ZlID8/P1xyXG4gICAgICAgICAgICAvL2dldDogZ2V0LFxyXG4gICAgICAgICAgICAvL3F1ZXJ5OiBxdWVyeSxcclxuICAgICAgICAgICAgLy9zYXZlOiBzYXZlXHJcbiAgICAgICAgfVxyXG5cclxuICAgICAgICBmdW5jdGlvbiByZW1vdmUoaWQpIHtcclxuICAgICAgICAgICAgcmV0dXJuICRodHRwLmRlbGV0ZSh1cmwgKyAnLycgKyBpZClcclxuICAgICAgICAgICAgICAgIC50aGVuKGZ1bmN0aW9uIChyZXNwb25zZSkge1xyXG4gICAgICAgICAgICAgICAgICAgIHJldHVybiByZXNwb25zZS5kYXRhO1xyXG4gICAgICAgICAgICAgICAgfSk7XHJcbiAgICAgICAgfVxyXG5cclxuICAgICAgICBmdW5jdGlvbiBjcmVhdGUoaXRlbSkge1xyXG4gICAgICAgICAgICBsb2dnZXIubG9nKCdpdGVtJywgaXRlbSk7XHJcbiAgICAgICAgICAgIGxvZ2dlci5sb2coJ3VybCcsIHVybCk7XHJcbiAgICAgICAgICAgIHJldHVybiAkaHR0cC5wb3N0KHVybCwgaXRlbSlcclxuICAgICAgICAgICAgICAgIC50aGVuKGZ1bmN0aW9uIChyZXNwb25zZSkge1xyXG4gICAgICAgICAgICAgICAgICAgIHJldHVybiByZXNwb25zZS5kYXRhO1xyXG4gICAgICAgICAgICAgICAgfSk7XHJcbiAgICAgICAgfVxyXG5cclxuICAgICAgICBmdW5jdGlvbiB1cGRhdGUoaXRlbSkge1xyXG4gICAgICAgICAgICByZXR1cm4gJGh0dHAucHV0KHVybCwgaXRlbSlcclxuICAgICAgICAgICAgICAgIC50aGVuKGZ1bmN0aW9uIChyZXNwb25zZSkge1xyXG4gICAgICAgICAgICAgICAgICAgIHJldHVybiByZXNwb25zZS5kYXRhO1xyXG4gICAgICAgICAgICAgICAgfSk7XHJcbiAgICAgICAgfVxyXG5cclxuICAgICAgICByZXR1cm4gc2VydmljZTtcclxuXHJcbiAgICAgICAgZnVuY3Rpb24gZ2V0KGlkKSB7IH1cclxuXHJcbiAgICAgICAgZnVuY3Rpb24gcXVlcnkoKSB7XHJcbiAgICAgICAgfVxyXG4gICAgfVxyXG59KSgpOyIsIi8vdGVtcGxhdGUuc2VydmljZS5qc1xyXG4vL21hcmsubGF3cmVuY2VcclxuXHJcbihmdW5jdGlvbiAoKSB7XHJcbiAgICAndXNlIHN0cmljdCc7XHJcblxyXG4gICAgdmFyIHNlcnZpY2VJZCA9ICd0ZW1wbGF0ZVNlcnZpY2UnO1xyXG4gICAgYW5ndWxhci5tb2R1bGUoJ2FwcC5zZXJ2aWNlJykuZmFjdG9yeShzZXJ2aWNlSWQsIHNlcnZpY2VDb250cm9sbGVyKTtcclxuXHJcbiAgICBmdW5jdGlvbiBzZXJ2aWNlQ29udHJvbGxlcihsb2dnZXIsICRodHRwLCBjb25maWcpIHtcclxuICAgICAgICBsb2dnZXIubG9nKHNlcnZpY2VJZCArICcgbG9hZGVkJyk7XHJcbiAgICAgICAgdmFyIHVybCA9IGNvbmZpZy5hcGlVcmwgKyBjb25maWcuYXBpRW5kUG9pbnRzLlRlbXBsYXRlO1xyXG5cclxuICAgICAgICB2YXIgc2VydmljZSA9IHtcclxuICAgICAgICAgICAgZ2V0OiBnZXQsXHJcbiAgICAgICAgICAgIHVwZGF0ZTogdXBkYXRlLFxyXG4gICAgICAgICAgICBxdWVyeTogcXVlcnlcclxuICAgICAgICAgICAgLy8gICAgICAgICAgICByZW1vdmU6IHJlbW92ZSxcclxuICAgICAgICAgICAgLy8gICAgICAgICAgICBzYXZlOiBzYXZlLFxyXG4gICAgICAgICAgICAvLyAgICAgICAgICAgIHNlYXJjaDogc2VhcmNoLFxyXG4gICAgICAgIH1cclxuXHJcbiAgICAgICAgcmV0dXJuIHNlcnZpY2U7XHJcblxyXG4gICAgICAgIGZ1bmN0aW9uIGdldCgpIHtcclxuICAgICAgICAgICAgcmV0dXJuICRodHRwLmdldCh1cmwpXHJcbiAgICAgICAgICAgICAgICAudGhlbihmdW5jdGlvbiAocmVzcG9uc2UpIHtcclxuICAgICAgICAgICAgICAgICAgICByZXR1cm4gcmVzcG9uc2UuZGF0YTtcclxuICAgICAgICAgICAgICAgIH0pO1xyXG4gICAgICAgIH1cclxuXHJcbiAgICAgICAgZnVuY3Rpb24gcXVlcnkobmFtZSkge1xyXG4gICAgICAgICAgICByZXR1cm4gJGh0dHAuZ2V0KHVybCArICcvJyArIG5hbWUpXHJcbiAgICAgICAgICAgICAgICAudGhlbihmdW5jdGlvbiAocmVzcG9uc2UpIHtcclxuICAgICAgICAgICAgICAgICAgICByZXR1cm4gcmVzcG9uc2UuZGF0YTtcclxuICAgICAgICAgICAgICAgIH0pO1xyXG4gICAgICAgIH1cclxuXHJcbiAgICAgICAgZnVuY3Rpb24gdXBkYXRlKHRlbXBsYXRlKSB7XHJcbiAgICAgICAgICAgIHJldHVybiAkaHR0cC5wdXQodXJsLCB0ZW1wbGF0ZSlcclxuICAgICAgICAgICAgICAgIC50aGVuKGZ1bmN0aW9uIChyZXNwb25zZSkge1xyXG4gICAgICAgICAgICAgICAgICAgIHJldHVybiByZXNwb25zZS5kYXRhO1xyXG4gICAgICAgICAgICAgICAgfSk7XHJcbiAgICAgICAgfVxyXG4gICAgfVxyXG59KSgpOyIsIi8vdXNlci5zZXJ2aWNlLmpzXHJcbi8vbWFyay5sYXdyZW5jZVxyXG5cclxuKGZ1bmN0aW9uICgpIHtcclxuICAgICd1c2Ugc3RyaWN0JztcclxuXHJcbiAgICB2YXIgc2VydmljZUlkID0gJ3VzZXJTZXJ2aWNlJztcclxuICAgIGFuZ3VsYXIubW9kdWxlKCdhcHAuc2VydmljZScpLmZhY3Rvcnkoc2VydmljZUlkLCBzZXJ2aWNlQ29udHJvbGxlcik7XHJcblxyXG4gICAgZnVuY3Rpb24gc2VydmljZUNvbnRyb2xsZXIobG9nZ2VyLCAkaHR0cCwgY29uZmlnKSB7XHJcbiAgICAgICAgbG9nZ2VyLmxvZyhzZXJ2aWNlSWQgKyAnIGxvYWRlZCcpO1xyXG4gICAgICAgIHZhciB1cmwgPSBjb25maWcuYXBpVXJsICsgY29uZmlnLmFwaUVuZFBvaW50cy5Vc2VyO1xyXG5cclxuICAgICAgICB2YXIgc2VydmljZSA9IHtcclxuICAgICAgICAgICAgYXZhaWxhYmxlUm9sZXM6IGF2YWlsYWJsZVJvbGVzLFxyXG4gICAgICAgICAgICBjcmVhdGU6IGNyZWF0ZSxcclxuICAgICAgICAgICAgZ2V0OiBnZXQsXHJcbiAgICAgICAgICAgIHF1ZXJ5OiBxdWVyeSxcclxuICAgICAgICAgICAgcmVtb3ZlOiByZW1vdmUsXHJcbiAgICAgICAgICAgIHVwZGF0ZTogdXBkYXRlXHJcbiAgICAgICAgfVxyXG5cclxuICAgICAgICByZXR1cm4gc2VydmljZTtcclxuXHJcbiAgICAgICAgZnVuY3Rpb24gYXZhaWxhYmxlUm9sZXMoKSB7XHJcbiAgICAgICAgICAgIHJldHVybiAkaHR0cC5nZXQodXJsICsgJy9yb2xlcycpLnRoZW4oX3N1Y2Nlc3MpO1xyXG4gICAgICAgIH1cclxuXHJcbiAgICAgICAgZnVuY3Rpb24gY3JlYXRlKHVzZXIpIHtcclxuICAgICAgICAgICAgcmV0dXJuICRodHRwLnBvc3QodXJsLCB1c2VyKS50aGVuKF9zdWNjZXNzLCBmdW5jdGlvbiAoZXJyb3IpIHtcclxuICAgICAgICAgICAgICAgIGxvZ2dlci5sb2coJ2Vycm9yJywgZXJyb3IpO1xyXG4gICAgICAgICAgICB9KTtcclxuICAgICAgICB9XHJcblxyXG4gICAgICAgIGZ1bmN0aW9uIGdldCgpIHtcclxuICAgICAgICAgICAgcmV0dXJuICRodHRwLmdldCh1cmwpLnRoZW4oX3N1Y2Nlc3MpO1xyXG4gICAgICAgIH1cclxuXHJcbiAgICAgICAgZnVuY3Rpb24gcXVlcnkoc2VhcmNoVGVybSkge1xyXG4gICAgICAgICAgICB2YXIgc2VhcmNoVXJsID0gdXJsICsgJy9zZWFyY2gvJztcclxuXHJcbiAgICAgICAgICAgIGlmIChzZWFyY2hUZXJtICE9IHVuZGVmaW5lZCAmJiBzZWFyY2hUZXJtLmxlbmd0aCA+IDApIHtcclxuICAgICAgICAgICAgICAgIHNlYXJjaFVybCArPSAnPycgKyBzZWFyY2hUZXJtO1xyXG4gICAgICAgICAgICB9O1xyXG4gICAgICAgICAgICByZXR1cm4gJGh0dHAuZ2V0KHNlYXJjaFVybCkudGhlbihfc3VjY2Vzcyk7XHJcbiAgICAgICAgfVxyXG5cclxuICAgICAgICBmdW5jdGlvbiB1cGRhdGUodXNlcikge1xyXG4gICAgICAgICAgICByZXR1cm4gJGh0dHAucHV0KHVybCwgdXNlcikudGhlbihfc3VjY2Vzcyk7XHJcbiAgICAgICAgfVxyXG5cclxuICAgICAgICBmdW5jdGlvbiByZW1vdmUoaWQpIHtcclxuICAgICAgICAgICAgcmV0dXJuICRodHRwLmRlbGV0ZSh1cmwgKyAnLycgKyBpZCkudGhlbihfc3VjY2Vzcyk7XHJcbiAgICAgICAgfVxyXG5cclxuICAgICAgICBmdW5jdGlvbiBfc3VjY2VzcyhyZXNwb25zZSkge1xyXG4gICAgICAgICAgICByZXR1cm4gcmVzcG9uc2UuZGF0YTtcclxuICAgICAgICB9XHJcbiAgICB9XHJcbn0pKCk7IiwiLy9tYW5hZ2VyLmpzXHJcbi8vbWFyay5sYXdyZW5jZVxyXG5cclxuKGZ1bmN0aW9uICgpIHtcclxuICAgIHZhciBjb250cm9sbGVySWQgPSAnVGF4Q29udHJvbGxlcic7XHJcblxyXG4gICAgYW5ndWxhci5tb2R1bGUoJ2FwcC50YXgnKS5jb250cm9sbGVyKGNvbnRyb2xsZXJJZCwgTWFpbkNvbnRyb2xsZXIpO1xyXG5cclxuICAgIE1haW5Db250cm9sbGVyLiRpbmplY3QgPSBbJ2xvZ2dlcicsICckdWliTW9kYWwnLCAnY29uc3RpdHVlbnRTZXJ2aWNlJ107XHJcblxyXG4gICAgZnVuY3Rpb24gTWFpbkNvbnRyb2xsZXIobG9nZ2VyLCAkbW9kYWwsIHNlcnZpY2UpIHtcclxuICAgICAgICB2YXIgdm0gPSB0aGlzO1xyXG4gICAgICAgIHZhciB0YWJsZVN0YXRlUmVmO1xyXG5cclxuICAgICAgICB2bS50aXRsZSA9ICdUYXggRGF0YSBNYW5hZ2VyJztcclxuICAgICAgICB2bS5kZXNjcmlwdGlvbiA9IFwiVXBkYXRlIFRheCBhbmQgQ29uc3RpdHVlbnQgRGF0YVwiO1xyXG5cclxuICAgICAgICB2bS5wZW9wbGUgPSBbXTtcclxuICAgICAgICB2bS5zZWFyY2hNb2RlbCA9IHtcclxuICAgICAgICAgICAgcGFnZTogMSxcclxuICAgICAgICAgICAgcGFnZVNpemU6IDE1LFxyXG4gICAgICAgICAgICBvcmRlckJ5OiAnTmFtZScsXHJcbiAgICAgICAgICAgIG9yZGVyRGlyZWN0aW9uOiAnZGVzYydcclxuICAgICAgICB9O1xyXG5cclxuICAgICAgICB2bS5kb3dubG9hZENzdiA9IGRvd25sb2FkQ3N2O1xyXG4gICAgICAgIHZtLmlzQnVzeSA9IGZhbHNlO1xyXG5cclxuICAgICAgICB2bS51cGRhdGVTdGF0dXNPcHRpb25zID0gW1xyXG4gICAgICAgICAgICB7IGlkOiBudWxsLCB0aXRsZTogJ0FsbCcgfSwgeyBpZDogMSwgdGl0bGU6ICdVbmNoYW5nZWQnIH0sIHsgaWQ6IDIsIHRpdGxlOiAnQ2hhbmdlZCcgfSxcclxuICAgICAgICAgICAgeyBpZDogNiwgdGl0bGU6ICdSZWNvbmNpbGVkJyB9XHJcbiAgICAgICAgXTtcclxuXHJcbiAgICAgICAgYWN0aXZhdGUoKTtcclxuXHJcbiAgICAgICAgZnVuY3Rpb24gYWN0aXZhdGUoKSB7XHJcbiAgICAgICAgICAgIGxvZ2dlci5sb2coY29udHJvbGxlcklkICsgJyBhY3RpdmF0ZWQnKTtcclxuICAgICAgICB9XHJcblxyXG4gICAgICAgIC8vVE9ETzogRXhwb3J0IGNvbnN0aXR1ZW50IGNoYW5nZXNcclxuICAgICAgICBmdW5jdGlvbiBkb3dubG9hZENzdigpIHtcclxuICAgICAgICAgICAgcmV0dXJuIHNlcnZpY2UuZG93bmxvYWQodm0uZGF0YSlcclxuICAgICAgICAgICAgICAgIC50aGVuKGZ1bmN0aW9uIChkYXRhKSB7XHJcbiAgICAgICAgICAgICAgICAgICAgdmFyIGRhdGFGaWxlID0gW107XHJcbiAgICAgICAgICAgICAgICAgICAgXy5mb3JFYWNoKGRhdGEuaXRlbXMsXHJcbiAgICAgICAgICAgICAgICAgICAgICAgIGZ1bmN0aW9uIChpdGVtKSB7XHJcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICBkYXRhRmlsZS5wdXNoKHtcclxuICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAnUmVjb3JkSWQnOiBpdGVtLmlkLFxyXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICdMb29rdXBJRCc6IGl0ZW0ubG9va3VwSWQsXHJcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgJ0ZpbmRlck51bWJlcic6IGl0ZW0uZmluZGVyTnVtYmVyLFxyXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICdOYW1lJzogaXRlbS5uYW1lLFxyXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICdFbWFpbEFkZHJlc3MnOiBpdGVtLmVtYWlsLFxyXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICdBZGRyZXNzTGluZTEnOiBpdGVtLnN0cmVldCxcclxuICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAnQWRkcmVzc0xpbmUyJzogaXRlbS5zdHJlZXQyLFxyXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICdDaXR5JzogaXRlbS5jaXR5LFxyXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICdTdGF0ZSc6IGl0ZW0uc3RhdGUsXHJcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgJ1pJUCc6IGl0ZW0uemlwY29kZVxyXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgfSk7XHJcbiAgICAgICAgICAgICAgICAgICAgICAgIH0pO1xyXG4gICAgICAgICAgICAgICAgICAgIHJldHVybiBkYXRhRmlsZTtcclxuICAgICAgICAgICAgICAgIH0pO1xyXG4gICAgICAgIH1cclxuXHJcbiAgICAgICAgdm0uZWRpdEl0ZW0gPSBmdW5jdGlvbiAoaXRlbSkge1xyXG4gICAgICAgICAgICAkbW9kYWwub3Blbih7XHJcbiAgICAgICAgICAgICAgICB0ZW1wbGF0ZVVybDogJy9hcHAvdGF4L3ZpZXdzL2NvbnN0aXR1ZW50Lmh0bWwnLFxyXG4gICAgICAgICAgICAgICAgY29udHJvbGxlcjogWydsb2dnZXInLCAnJHVpYk1vZGFsSW5zdGFuY2UnLCAnY29uc3RpdHVlbnRTZXJ2aWNlJywgJ2l0ZW0nLCBFZGl0Q29uc3RpdHVlbnRDb250cm9sbGVyXSxcclxuICAgICAgICAgICAgICAgIGNvbnRyb2xsZXJBczogJ3ZtJyxcclxuICAgICAgICAgICAgICAgIHJlc29sdmU6IHtcclxuICAgICAgICAgICAgICAgICAgICBpdGVtOiBmdW5jdGlvbiAoKSB7IHJldHVybiBpdGVtOyB9XHJcbiAgICAgICAgICAgICAgICB9XHJcbiAgICAgICAgICAgIH0pLnJlc3VsdC50aGVuKGZ1bmN0aW9uIChkYXRhKSB7XHJcbiAgICAgICAgICAgICAgICBhbmd1bGFyLmV4dGVuZChpdGVtLCBkYXRhKTtcclxuICAgICAgICAgICAgICAgIGxvZ2dlci5zdWNjZXNzKCdTdWNjZXNzZnVsbHkgdXBkYXRlZCAnICsgaXRlbS5uYW1lKTtcclxuICAgICAgICAgICAgfSk7XHJcbiAgICAgICAgfVxyXG5cclxuICAgICAgICB2bS5wYWdlZCA9IGZ1bmN0aW9uIHBhZ2VkKHBhZ2VOdW0pIHtcclxuICAgICAgICAgICAgdm0ubGFzdERlbGV0ZWQgPSBudWxsO1xyXG4gICAgICAgICAgICB2bS5sYXN0VXBkYXRlZCA9IG51bGw7XHJcbiAgICAgICAgICAgIHZtLnNlYXJjaCh0YWJsZVN0YXRlUmVmKTtcclxuICAgICAgICB9O1xyXG5cclxuICAgICAgICB2bS5zZWFyY2ggPSBmdW5jdGlvbiAodGFibGVTdGF0ZSkge1xyXG4gICAgICAgICAgICB0YWJsZVN0YXRlUmVmID0gdGFibGVTdGF0ZTtcclxuXHJcbiAgICAgICAgICAgIGlmICghdm0uc2VhcmNoTW9kZWwuaXNQcmlvcml0eSkgdm0uc2VhcmNoTW9kZWwuaXNQcmlvcml0eSA9IG51bGw7XHJcblxyXG4gICAgICAgICAgICBpZiAodHlwZW9mICh0YWJsZVN0YXRlLnNvcnQucHJlZGljYXRlKSAhPSBcInVuZGVmaW5lZFwiKSB7XHJcbiAgICAgICAgICAgICAgICB2bS5zZWFyY2hNb2RlbC5vcmRlckJ5ID0gdGFibGVTdGF0ZS5zb3J0LnByZWRpY2F0ZTtcclxuICAgICAgICAgICAgICAgIHZtLnNlYXJjaE1vZGVsLm9yZGVyRGlyZWN0aW9uID0gdGFibGVTdGF0ZS5zb3J0LnJldmVyc2UgPyAnZGVzYycgOiAnYXNjJztcclxuICAgICAgICAgICAgfVxyXG4gICAgICAgICAgICBpZiAodHlwZW9mICh0YWJsZVN0YXRlLnNlYXJjaC5wcmVkaWNhdGVPYmplY3QpICE9IFwidW5kZWZpbmVkXCIpIHtcclxuICAgICAgICAgICAgICAgIHZtLnNlYXJjaE1vZGVsLm5hbWUgPSB0YWJsZVN0YXRlLnNlYXJjaC5wcmVkaWNhdGVPYmplY3QubmFtZTtcclxuICAgICAgICAgICAgICAgIHZtLnNlYXJjaE1vZGVsLmxvb2t1cElkID0gdGFibGVTdGF0ZS5zZWFyY2gucHJlZGljYXRlT2JqZWN0Lmxvb2t1cElkO1xyXG4gICAgICAgICAgICAgICAgdm0uc2VhcmNoTW9kZWwuZmluZGVyTnVtYmVyID0gdGFibGVTdGF0ZS5zZWFyY2gucHJlZGljYXRlT2JqZWN0LmZpbmRlck51bWJlcjtcclxuICAgICAgICAgICAgICAgIHZtLnNlYXJjaE1vZGVsLnppcGNvZGUgPSB0YWJsZVN0YXRlLnNlYXJjaC5wcmVkaWNhdGVPYmplY3QuemlwY29kZTtcclxuICAgICAgICAgICAgICAgIHZtLnNlYXJjaE1vZGVsLmVtYWlsID0gdGFibGVTdGF0ZS5zZWFyY2gucHJlZGljYXRlT2JqZWN0LmVtYWlsO1xyXG4gICAgICAgICAgICAgICAgdm0uc2VhcmNoTW9kZWwucGhvbmUgPSB0YWJsZVN0YXRlLnNlYXJjaC5wcmVkaWNhdGVPYmplY3QucGhvbmU7XHJcbiAgICAgICAgICAgICAgICB2bS5zZWFyY2hNb2RlbC51cGRhdGVTdGF0dXMgPSB0YWJsZVN0YXRlLnNlYXJjaC5wcmVkaWNhdGVPYmplY3QudXBkYXRlU3RhdHVzO1xyXG4gICAgICAgICAgICB9XHJcblxyXG4gICAgICAgICAgICB2bS5pc0J1c3kgPSB0cnVlO1xyXG4gICAgICAgICAgICBzZXJ2aWNlLnF1ZXJ5KHZtLnNlYXJjaE1vZGVsKVxyXG4gICAgICAgICAgICAgICAgLnRoZW4oZnVuY3Rpb24gKGRhdGEpIHtcclxuICAgICAgICAgICAgICAgICAgICB2bS5wZW9wbGUgPSBkYXRhLml0ZW1zO1xyXG4gICAgICAgICAgICAgICAgICAgIHZtLnNlYXJjaE1vZGVsID0gZGF0YTtcclxuICAgICAgICAgICAgICAgICAgICB2bS5pc0J1c3kgPSBmYWxzZTtcclxuICAgICAgICAgICAgICAgIH0pO1xyXG4gICAgICAgIH1cclxuXHJcbiAgICAgICAgdm0ucmVjb25jaWxlSXRlbSA9IGZ1bmN0aW9uIChpdGVtKSB7XHJcbiAgICAgICAgICAgIC8vVE9ETzogUmVwbGFjZSB3aXRoIENPTlNUQU5UU1xyXG4gICAgICAgICAgICBpdGVtLnVwZGF0ZVN0YXR1cyA9IDY7XHJcbiAgICAgICAgICAgIHNlcnZpY2UudXBkYXRlKGl0ZW0pLnRoZW4oZnVuY3Rpb24gKHJlc3BvbnNlKSB7XHJcbiAgICAgICAgICAgICAgICBsb2dnZXIuc3VjY2VzcygnUmVjb25jaWxlZCAnICsgaXRlbS5uYW1lKTtcclxuICAgICAgICAgICAgfSk7XHJcbiAgICAgICAgfVxyXG5cclxuICAgICAgICB2bS5zaG93VGF4SXRlbXMgPSBmdW5jdGlvbiAoY29uc3RpdHVlbnQpIHtcclxuICAgICAgICAgICAgJG1vZGFsLm9wZW4oe1xyXG4gICAgICAgICAgICAgICAgdGVtcGxhdGVVcmw6ICcvYXBwL3RheC92aWV3cy90YXhpdGVtcy5odG1sJyxcclxuICAgICAgICAgICAgICAgIGNvbnRyb2xsZXI6IFsnbG9nZ2VyJywgJyR1aWJNb2RhbEluc3RhbmNlJywgJ2NvbnN0aXR1ZW50JywgJ3RheFNlcnZpY2UnLCBUYXhJdGVtQ29udHJvbGxlcl0sXHJcbiAgICAgICAgICAgICAgICBjb250cm9sbGVyQXM6ICd2bScsXHJcbiAgICAgICAgICAgICAgICByZXNvbHZlOiB7XHJcbiAgICAgICAgICAgICAgICAgICAgY29uc3RpdHVlbnQ6IGZ1bmN0aW9uICgpIHsgcmV0dXJuIGNvbnN0aXR1ZW50OyB9XHJcbiAgICAgICAgICAgICAgICB9XHJcbiAgICAgICAgICAgIH0pO1xyXG4gICAgICAgIH1cclxuICAgIH1cclxuXHJcbiAgICBmdW5jdGlvbiBUYXhJdGVtQ29udHJvbGxlcihsb2dnZXIsICRtb2RhbCwgY29uc3RpdHVlbnQsIHNlcnZpY2UpIHtcclxuICAgICAgICB2YXIgdm0gPSB0aGlzO1xyXG4gICAgICAgIHZhciBjdXJyZW50WWVhciA9IHBhcnNlSW50KG1vbWVudCgpLmdldCgnWWVhcicpKTtcclxuXHJcbiAgICAgICAgdm0uc2VsZWN0ZWRZZWFyID0gY3VycmVudFllYXIgLSAxO1xyXG4gICAgICAgIGxvZ2dlci5sb2coJ3NlbGVjdGVkWWVhcicsIHZtLnNlbGVjdGVkWWVhcik7XHJcblxyXG4gICAgICAgIHZtLmRhdGVPcHRpb25zID0ge1xyXG4gICAgICAgICAgICBmb3JtYXRZZWFyOiAneXl5eScsXHJcbiAgICAgICAgICAgIG1heERhdGU6IG5ldyBEYXRlKCcxMi8zMC8nICsgdm0uc2VsZWN0ZWRZZWFyKSxcclxuICAgICAgICAgICAgbWluRGF0ZTogbmV3IERhdGUoJzEvMS8nICsgdm0uc2VsZWN0ZWRZZWFyKSxcclxuICAgICAgICAgICAgc3RhcnRpbmdEYXk6IDFcclxuICAgICAgICB9O1xyXG4gICAgICAgIHZtLmFsdElucHV0Rm9ybWF0cyA9IFsnTSEvZCEveXl5eSddO1xyXG5cclxuICAgICAgICB2bS55ZWFycyA9IFtdO1xyXG5cclxuICAgICAgICB2bS5taW5EYXRlID0gbmV3IERhdGUoJzEvMS8nICsgdm0uc2VsZWN0ZWRZZWFyKTtcclxuICAgICAgICB2bS5tYXhEYXRlID0gbmV3IERhdGUoJzEyLzMwLycgKyB2bS5zZWxlY3RlZFllYXIpO1xyXG5cclxuICAgICAgICB2bS5hZGRJdGVtID0gYWRkSXRlbTtcclxuICAgICAgICB2bS5jYW5jZWxFZGl0ID0gY2FuY2VsRWRpdDtcclxuICAgICAgICB2bS5jb25zdGl0dWVudCA9IGNvbnN0aXR1ZW50O1xyXG4gICAgICAgIHZtLmRlbGV0ZUl0ZW0gPSBkZWxldGVJdGVtO1xyXG4gICAgICAgIHZtLmVkaXRJdGVtID0gZWRpdEl0ZW07XHJcbiAgICAgICAgdm0uaXRlbVRvRWRpdCA9IHt9O1xyXG4gICAgICAgIHZtLm5ld0l0ZW0gPSB7fTtcclxuICAgICAgICB2bS5zYXZlSXRlbSA9IHNhdmVJdGVtO1xyXG4gICAgICAgIHZtLnRheEl0ZW1zID0gY29uc3RpdHVlbnQudGF4SXRlbXM7XHJcbiAgICAgICAgdm0ueWVhckNoYW5nZWQgPSB5ZWFyQ2hhbmdlZDtcclxuXHJcbiAgICAgICAgYWN0aXZhdGUoKTtcclxuXHJcbiAgICAgICAgZnVuY3Rpb24gYWN0aXZhdGUoKSB7XHJcbiAgICAgICAgICAgIGdldFllYXJzKCk7XHJcbiAgICAgICAgfVxyXG5cclxuICAgICAgICBmdW5jdGlvbiBnZXRZZWFycygpIHtcclxuICAgICAgICAgICAgZm9yICh2YXIgaSA9IDA7IGkgPCA1OyBpKyspIHtcclxuICAgICAgICAgICAgICAgIHZtLnllYXJzLnB1c2goY3VycmVudFllYXIgLSBpKTtcclxuICAgICAgICAgICAgfVxyXG4gICAgICAgIH1cclxuXHJcbiAgICAgICAgZnVuY3Rpb24gYWRkSXRlbSgpIHtcclxuICAgICAgICAgICAgdm0ubmV3SXRlbS5jb25zdGl0dWVudElkID0gY29uc3RpdHVlbnQuaWQ7XHJcbiAgICAgICAgICAgIHZtLm5ld0l0ZW0udGF4WWVhciA9IG1vbWVudCh2bS5uZXdJdGVtLmRvbmF0aW9uRGF0ZSkueWVhcigpO1xyXG5cclxuICAgICAgICAgICAgc2VydmljZS5jcmVhdGUodm0ubmV3SXRlbSlcclxuICAgICAgICAgICAgICAgIC50aGVuKGZ1bmN0aW9uIChkYXRhKSB7XHJcbiAgICAgICAgICAgICAgICAgICAgdm0udGF4SXRlbXMucHVzaChkYXRhKTtcclxuICAgICAgICAgICAgICAgICAgICB2bS5uZXdJdGVtID0ge307XHJcbiAgICAgICAgICAgICAgICAgICAgbG9nZ2VyLnN1Y2Nlc3MoJ0FkZGVkIHRheCBpdGVtJyk7XHJcbiAgICAgICAgICAgICAgICB9KTtcclxuICAgICAgICB9XHJcblxyXG4gICAgICAgIGZ1bmN0aW9uIGNhbmNlbEVkaXQoKSB7XHJcbiAgICAgICAgICAgIHZtLmN1cnJlbnRFZGl0ID0ge307XHJcbiAgICAgICAgfVxyXG5cclxuICAgICAgICBmdW5jdGlvbiBkZWxldGVJdGVtKGl0ZW0pIHtcclxuICAgICAgICAgICAgdmFyIGlkeCA9IHZtLnRheEl0ZW1zLmluZGV4T2YoaXRlbSk7XHJcbiAgICAgICAgICAgIHNlcnZpY2UucmVtb3ZlKGl0ZW0uaWQpXHJcbiAgICAgICAgICAgICAgICAudGhlbihmdW5jdGlvbiAoZGF0YSkge1xyXG4gICAgICAgICAgICAgICAgICAgIHZtLnRheEl0ZW1zLnNwbGljZShpZHgsIDEpO1xyXG4gICAgICAgICAgICAgICAgICAgIGxvZ2dlci53YXJuaW5nKCdkZWxldGVkICcgKyBpdGVtLmRvbmF0aW9uRGF0ZSk7XHJcbiAgICAgICAgICAgICAgICB9KTtcclxuICAgICAgICB9XHJcblxyXG4gICAgICAgIGZ1bmN0aW9uIGVkaXRJdGVtKGl0ZW0pIHtcclxuICAgICAgICAgICAgdm0uY3VycmVudEVkaXQgPSB7fTtcclxuICAgICAgICAgICAgdm0uY3VycmVudEVkaXRbaXRlbS5pZF0gPSB0cnVlO1xyXG4gICAgICAgICAgICB2bS5pdGVtVG9FZGl0ID0gYW5ndWxhci5jb3B5KGl0ZW0pO1xyXG4gICAgICAgICAgICB2bS5pdGVtVG9FZGl0LmRvbmF0aW9uRGF0ZSA9IG1vbWVudCh2bS5pdGVtVG9FZGl0LmRvbmF0aW9uRGF0ZSkudG9EYXRlKCk7XHJcbiAgICAgICAgfVxyXG5cclxuICAgICAgICBmdW5jdGlvbiBzYXZlSXRlbShpdGVtKSB7XHJcbiAgICAgICAgICAgIHNlcnZpY2UudXBkYXRlKHZtLml0ZW1Ub0VkaXQpXHJcbiAgICAgICAgICAgICAgICAudGhlbihmdW5jdGlvbiAocmVzcG9uc2UpIHtcclxuICAgICAgICAgICAgICAgICAgICBhbmd1bGFyLmV4dGVuZChpdGVtLCB2bS5pdGVtVG9FZGl0KTtcclxuICAgICAgICAgICAgICAgICAgICB2bS5jdXJyZW50RWRpdCA9IHt9O1xyXG4gICAgICAgICAgICAgICAgICAgIGxvZ2dlci5zdWNjZXNzKCdVcGRhdGVkIHRheCBpdGVtICcgKyBtb21lbnQoaXRlbS5kb25hdGlvbkRhdGUpLmZvcm1hdCgnTU0vZGQveXl5eScpKTtcclxuICAgICAgICAgICAgICAgIH0pO1xyXG4gICAgICAgIH1cclxuXHJcbiAgICAgICAgZnVuY3Rpb24geWVhckNoYW5nZWQoKSB7XHJcbiAgICAgICAgICAgIHZtLmRhdGVPcHRpb25zID0ge1xyXG4gICAgICAgICAgICAgICAgbWF4RGF0ZTogbmV3IERhdGUoJzEyLzMwLycgKyB2bS5zZWxlY3RlZFllYXIpLFxyXG4gICAgICAgICAgICAgICAgbWluRGF0ZTogbmV3IERhdGUoJzEvMS8nICsgdm0uc2VsZWN0ZWRZZWFyKVxyXG4gICAgICAgICAgICB9O1xyXG4gICAgICAgICAgICB2bS5uZXdJdGVtLmRvbmF0aW9uRGF0ZSA9IHZtLmRhdGVPcHRpb25zLm1pbkRhdGU7XHJcbiAgICAgICAgfVxyXG4gICAgfVxyXG5cclxuICAgIGZ1bmN0aW9uIEVkaXRDb25zdGl0dWVudENvbnRyb2xsZXIobG9nZ2VyLCAkbW9kYWwsIHNlcnZpY2UsIGl0ZW0pIHtcclxuICAgICAgICB2YXIgdm0gPSB0aGlzO1xyXG5cclxuICAgICAgICB2bS5pdGVtID0gYW5ndWxhci5jb3B5KGl0ZW0pO1xyXG5cclxuICAgICAgICB2bS5jbG9zZSA9IGZ1bmN0aW9uICgpIHtcclxuICAgICAgICAgICAgJG1vZGFsLmRpc21pc3MoKTtcclxuICAgICAgICB9XHJcblxyXG4gICAgICAgIHZtLnNhdmUgPSBmdW5jdGlvbiAoKSB7XHJcbiAgICAgICAgICAgIC8vVE9ETzogUmVwbGFjZSB3aXRoIENPTlNUQU5UU1xyXG4gICAgICAgICAgICB2bS5pdGVtLnVwZGF0ZVN0YXR1cyA9IDI7XHJcbiAgICAgICAgICAgIHNlcnZpY2UudXBkYXRlKHZtLml0ZW0pXHJcbiAgICAgICAgICAgICAgICAudGhlbihmdW5jdGlvbiAoZGF0YSkge1xyXG4gICAgICAgICAgICAgICAgICAgIC8vYW5ndWxhci5leHRlbmQoaXRlbSwgdm0uaXRlbSk7XHJcbiAgICAgICAgICAgICAgICAgICAgJG1vZGFsLmNsb3NlKHZtLml0ZW0pO1xyXG4gICAgICAgICAgICAgICAgfSk7XHJcbiAgICAgICAgfVxyXG4gICAgfVxyXG59KSgpOyIsIi8vdGVtcGxhdGUuanNcclxuLy9tYXJrLmxhd3JlbmNlXHJcblxyXG4oZnVuY3Rpb24gKCkge1xyXG4gICAgdmFyIGNvbnRyb2xsZXJJZCA9ICdUZW1wbGF0ZUNvbnRyb2xsZXInO1xyXG5cclxuICAgIGFuZ3VsYXIubW9kdWxlKCdhcHAudGVtcGxhdGUnKS5jb250cm9sbGVyKGNvbnRyb2xsZXJJZCwgTWFpbkNvbnRyb2xsZXIpO1xyXG5cclxuICAgIE1haW5Db250cm9sbGVyLiRpbmplY3QgPSBbJ2xvZ2dlcicsICd0ZW1wbGF0ZVNlcnZpY2UnXTtcclxuXHJcbiAgICBmdW5jdGlvbiBNYWluQ29udHJvbGxlcihsb2dnZXIsIHNlcnZpY2UpIHtcclxuICAgICAgICB2YXIgdm0gPSB0aGlzO1xyXG5cclxuICAgICAgICB2bS50aXRsZSA9ICdUZW1wbGF0ZXMnO1xyXG4gICAgICAgIHZtLmRlc2NyaXB0aW9uID0gJ1VwZGF0ZSBldmVudCB0ZW1wbGF0ZXMnO1xyXG5cclxuICAgICAgICB2bS50ZW1wbGF0ZXMgPSBbXTtcclxuICAgICAgICB2bS5zZWxlY3RlZFRlbXBsYXRlID0ge307XHJcblxyXG4gICAgICAgIHZtLnRlbXBsYXRlID0ge307XHJcbiAgICAgICAgdm0udGVtcGxhdGVDb3B5ID0ge307XHJcblxyXG4gICAgICAgIGFjdGl2YXRlKCk7XHJcblxyXG4gICAgICAgIGZ1bmN0aW9uIGFjdGl2YXRlKCkge1xyXG4gICAgICAgICAgICBsb2dnZXIubG9nKGNvbnRyb2xsZXJJZCArICcgYWN0aXZhdGVkJyk7XHJcbiAgICAgICAgICAgIGdldFRlbXBsYXRlcygpO1xyXG4gICAgICAgIH1cclxuXHJcbiAgICAgICAgZnVuY3Rpb24gZ2V0VGVtcGxhdGVzKCkge1xyXG4gICAgICAgICAgICBzZXJ2aWNlLmdldCgpXHJcbiAgICAgICAgICAgICAgICAudGhlbihmdW5jdGlvbiAoZGF0YSkge1xyXG4gICAgICAgICAgICAgICAgICAgIHZtLnRlbXBsYXRlcyA9IGRhdGE7XHJcbiAgICAgICAgICAgICAgICAgICAgbG9nZ2VyLmxvZygndGVtcGxhdGVzJywgZGF0YSk7XHJcbiAgICAgICAgICAgICAgICB9KTtcclxuICAgICAgICB9XHJcblxyXG4gICAgICAgIHZtLmZpbGVTZWxlY3RlZCA9IGZ1bmN0aW9uICgkZmlsZXMsICRmaWxlLCAkZXZlbnQsICRyZWplY3RlZEZpbGVzKSB7XHJcbiAgICAgICAgICAgIHZhciByZWFkZXIgPSBuZXcgRmlsZVJlYWRlcigpO1xyXG4gICAgICAgICAgICByZWFkZXIub25sb2FkID0gZnVuY3Rpb24gKGUpIHtcclxuICAgICAgICAgICAgICAgIHZhciBkYXRhVVJMID0gcmVhZGVyLnJlc3VsdDtcclxuICAgICAgICAgICAgICAgIHZtLnNlbGVjdGVkVGVtcGxhdGUuaW1hZ2UgPSBkYXRhVVJMLnNwbGl0KCcsJylbMV07XHJcbiAgICAgICAgICAgICAgICB2bS5zZWxlY3RlZFRlbXBsYXRlLm1pbWVUeXBlID0gJGZpbGUudHlwZTtcclxuICAgICAgICAgICAgfTtcclxuICAgICAgICAgICAgcmVhZGVyLnJlYWRBc0RhdGFVUkwoJGZpbGUpO1xyXG4gICAgICAgIH07XHJcblxyXG4gICAgICAgIHZtLnNhdmUgPSBmdW5jdGlvbiAoKSB7XHJcbiAgICAgICAgICAgIHZtLmlzQnVzeSA9IHRydWU7XHJcbiAgICAgICAgICAgIHNlcnZpY2UudXBkYXRlKHZtLnNlbGVjdGVkVGVtcGxhdGUpXHJcbiAgICAgICAgICAgICAgICAudGhlbihmdW5jdGlvbiAoZGF0YSkge1xyXG4gICAgICAgICAgICAgICAgICAgIHZtLnNlbGVjdGVkVGVtcGxhdGUgPSBhbmd1bGFyLmV4dGVuZCh2bS5zZWxlY3RlZFRlbXBsYXRlLCBkYXRhKTtcclxuICAgICAgICAgICAgICAgICAgICBsb2dnZXIuc3VjY2VzcygnU2F2ZWQgJyArIHZtLnNlbGVjdGVkVGVtcGxhdGUubmFtZSk7XHJcbiAgICAgICAgICAgICAgICB9KS5maW5hbGx5KGZ1bmN0aW9uICgpIHtcclxuICAgICAgICAgICAgICAgICAgICB2bS5pc0J1c3kgPSBmYWxzZTtcclxuICAgICAgICAgICAgICAgIH0pO1xyXG4gICAgICAgIH1cclxuICAgIH1cclxufSkoKTsiLCIoZnVuY3Rpb24gKCkge1xyXG4gICAgJ3VzZSBzdHJpY3QnO1xyXG5cclxuICAgIHZhciBjb250cm9sbGVySWQgPSAnVXNlckNvbnRyb2xsZXInO1xyXG5cclxuICAgIGFuZ3VsYXIubW9kdWxlKCdhcHAudXNlcnMnKS5jb250cm9sbGVyKGNvbnRyb2xsZXJJZCwgVXNlckNvbnRyb2xsZXIpO1xyXG5cclxuICAgIFVzZXJDb250cm9sbGVyLiRpbmplY3QgPSBbJ2xvZ2dlcicsICd1c2VyU2VydmljZScsICdkZWZhdWx0cycsICdjb25maWcnXTtcclxuXHJcbiAgICBmdW5jdGlvbiBVc2VyQ29udHJvbGxlcihsb2dnZXIsIHNlcnZpY2UsIGRlZmF1bHRzLCBjb25maWcpIHtcclxuICAgICAgICB2YXIgdm0gPSB0aGlzO1xyXG4gICAgICAgIHZtLnRpdGxlID0gJ1VzZXIgTWFuYWdlcic7XHJcbiAgICAgICAgdm0uZGVzY3JpcHRpb24gPSAnRWRpdCBhbmQgdXBkYXRlIHVzZXJzJztcclxuICAgICAgICB2YXIga2V5Q29kZXMgPSBjb25maWcua2V5Q29kZXM7XHJcblxyXG4gICAgICAgIHZtLmF2YWlsYWJsZVJvbGVzID0gW107XHJcbiAgICAgICAgdm0uY2xlYXJDcmVhdGUgPSBjbGVhckNyZWF0ZTtcclxuICAgICAgICB2bS5jdXJyZW50RWRpdCA9IHt9O1xyXG4gICAgICAgIHZtLmlzQnVzeSA9IGZhbHNlO1xyXG4gICAgICAgIHZtLmxhc3REZWxldGVkID0gbnVsbDtcclxuICAgICAgICB2bS5sYXN0VXBkYXRlZCA9IG51bGw7XHJcbiAgICAgICAgdm0uaXRlbVRvRWRpdCA9IHt9O1xyXG5cclxuICAgICAgICB2bS51c2VyID0ge1xyXG4gICAgICAgICAgICAvL3VzZXJOYW1lOiBudWxsLFxyXG4gICAgICAgICAgICByb2xlczogWyd1c2VyJ10sXHJcbiAgICAgICAgICAgIGZ1bGxOYW1lOiAnJyxcclxuICAgICAgICAgICAgcGFzc3dvcmQ6IGRlZmF1bHRzLkdFTkVSSUNfUEFTU1dPUkRcclxuICAgICAgICB9O1xyXG5cclxuICAgICAgICB2YXIgdGFibGVTdGF0ZVJlZjtcclxuXHJcbiAgICAgICAgYWN0aXZhdGUoKTtcclxuXHJcbiAgICAgICAgZnVuY3Rpb24gYWN0aXZhdGUoKSB7XHJcbiAgICAgICAgICAgIGxvZ2dlci5sb2coY29udHJvbGxlcklkICsgJyBhY3RpdmF0ZWQnKTtcclxuICAgICAgICAgICAgZ2V0QXZhaWxhYmxlUm9sZXMoKTtcclxuICAgICAgICB9O1xyXG5cclxuICAgICAgICB2bS5hZGRJdGVtID0gZnVuY3Rpb24gKCkge1xyXG4gICAgICAgICAgICB2bS51c2VyLmZ1bGxOYW1lID0gcGFyc2VGdWxsTmFtZSh2bS51c2VyLnVzZXJOYW1lKTtcclxuICAgICAgICAgICAgdm0udXNlci5lbWFpbCA9IHZtLnVzZXIudXNlck5hbWUgKyBkZWZhdWx0cy5FTUFJTF9TVUZGSVg7XHJcbiAgICAgICAgICAgIHNlcnZpY2UuY3JlYXRlKHZtLnVzZXIpXHJcbiAgICAgICAgICAgICAgICAudGhlbihmdW5jdGlvbiAoZGF0YSkge1xyXG4gICAgICAgICAgICAgICAgICAgIC8vVE9ETzogbWFwcGluZyB3b3VsZCBhbGxvdyByZW1vdmFsIG9mIGV4dGVuZCBtZXRob2RcclxuICAgICAgICAgICAgICAgICAgICB2bS51c2VyID0gYW5ndWxhci5leHRlbmQodm0udXNlciwgZGF0YSk7XHJcbiAgICAgICAgICAgICAgICAgICAgdm0udXNlcnMudW5zaGlmdChhbmd1bGFyLmNvcHkodm0udXNlcikpO1xyXG4gICAgICAgICAgICAgICAgICAgIGxvZ2dlci5zdWNjZXNzKCdVc2VyICcgKyB2bS51c2VyLnVzZXJOYW1lICsgJyBjcmVhdGVkIScpO1xyXG4gICAgICAgICAgICAgICAgICAgIHZtLnVzZXIudXNlck5hbWUgPSBudWxsO1xyXG4gICAgICAgICAgICAgICAgICAgIC8vVE9ETzogc2hvdyBlcnJvciB1c2VyIGFscmVhZHkgZXhpc3RzXHJcbiAgICAgICAgICAgICAgICB9KTtcclxuICAgICAgICB9O1xyXG5cclxuICAgICAgICB2bS5jYW5jZWxFZGl0ID0gZnVuY3Rpb24gKGlkKSB7XHJcbiAgICAgICAgICAgIHZtLmN1cnJlbnRFZGl0W2lkXSA9IGZhbHNlO1xyXG4gICAgICAgIH07XHJcblxyXG4gICAgICAgIHZtLmRlbGV0ZUl0ZW0gPSBmdW5jdGlvbiAodXNlcikge1xyXG4gICAgICAgICAgICBhbmd1bGFyLmNvcHkodXNlciwgdm0ubGFzdERlbGV0ZWQgPSB7fSk7XHJcbiAgICAgICAgICAgIHNlcnZpY2UucmVtb3ZlKHVzZXIuaWQpXHJcbiAgICAgICAgICAgICAgICAudGhlbihmdW5jdGlvbiAoZGF0YSkge1xyXG4gICAgICAgICAgICAgICAgICAgIHZhciBpZHggPSB2bS51c2Vycy5pbmRleE9mKHVzZXIpO1xyXG4gICAgICAgICAgICAgICAgICAgIHZtLnVzZXJzLnNwbGljZShpZHgsIDEpO1xyXG4gICAgICAgICAgICAgICAgfSk7XHJcbiAgICAgICAgfTtcclxuXHJcbiAgICAgICAgdm0uZWRpdEl0ZW0gPSBmdW5jdGlvbiAodXNlcikge1xyXG4gICAgICAgICAgICB2bS5jdXJyZW50RWRpdFt1c2VyLmlkXSA9IHRydWU7XHJcbiAgICAgICAgICAgIGFuZ3VsYXIuY29weSh1c2VyLCB2bS5pdGVtVG9FZGl0ID0ge30pO1xyXG4gICAgICAgIH07XHJcblxyXG4gICAgICAgIGZ1bmN0aW9uIGdldEF2YWlsYWJsZVJvbGVzKCkge1xyXG4gICAgICAgICAgICBzZXJ2aWNlLmF2YWlsYWJsZVJvbGVzKClcclxuICAgICAgICAgICAgICAgIC50aGVuKGZ1bmN0aW9uIChkYXRhKSB7XHJcbiAgICAgICAgICAgICAgICAgICAgdm0uYXZhaWxhYmxlUm9sZXMgPSBkYXRhO1xyXG4gICAgICAgICAgICAgICAgfSk7XHJcbiAgICAgICAgfTtcclxuXHJcbiAgICAgICAgdm0uc2F2ZUl0ZW0gPSBmdW5jdGlvbiAodXNlcikge1xyXG4gICAgICAgICAgICB2bS5pc0J1c3kgPSB0cnVlO1xyXG5cclxuICAgICAgICAgICAgdm0uY3VycmVudEVkaXRbdXNlci5pZF0gPSBmYWxzZTtcclxuICAgICAgICAgICAgYW5ndWxhci5jb3B5KHVzZXIsIHZtLmxhc3RVcGRhdGVkID0ge30pO1xyXG4gICAgICAgICAgICB2YXIgcm9sZXMgPSBbXTtcclxuXHJcbiAgICAgICAgICAgIF8uZm9yRWFjaCh2bS5pdGVtVG9FZGl0LnJvbGVzLFxyXG4gICAgICAgICAgICAgICAgZnVuY3Rpb24gKHJvbGUpIHtcclxuICAgICAgICAgICAgICAgICAgICByb2xlcy5wdXNoKHJvbGUubmFtZSk7XHJcbiAgICAgICAgICAgICAgICB9KTtcclxuICAgICAgICAgICAgdm0uaXRlbVRvRWRpdC5yb2xlcyA9IHJvbGVzO1xyXG5cclxuICAgICAgICAgICAgc2VydmljZS51cGRhdGUodm0uaXRlbVRvRWRpdClcclxuICAgICAgICAgICAgICAgIC50aGVuKGZ1bmN0aW9uIChkYXRhKSB7XHJcbiAgICAgICAgICAgICAgICAgICAgYW5ndWxhci5leHRlbmQodXNlciwgZGF0YSk7XHJcbiAgICAgICAgICAgICAgICAgICAgbG9nZ2VyLnN1Y2Nlc3MoJ1VzZXIgJyArIGRhdGEudXNlck5hbWUgKyAnIHVwZGF0ZWQhJyk7XHJcbiAgICAgICAgICAgICAgICAgICAgdm0uaXNCdXN5ID0gZmFsc2U7XHJcbiAgICAgICAgICAgICAgICB9KTtcclxuICAgICAgICB9O1xyXG5cclxuICAgICAgICB2bS5zZWFyY2ggPSBmdW5jdGlvbiAodGFibGVTdGF0ZSkge1xyXG4gICAgICAgICAgICB0YWJsZVN0YXRlUmVmID0gdGFibGVTdGF0ZTtcclxuICAgICAgICAgICAgdmFyIHNlYXJjaFRlcm07XHJcblxyXG4gICAgICAgICAgICBpZiAodHlwZW9mICh0YWJsZVN0YXRlLnNlYXJjaC5wcmVkaWNhdGVPYmplY3QpICE9ICd1bmRlZmluZWQnKSB7XHJcbiAgICAgICAgICAgICAgICBzZWFyY2hUZXJtID0gdGFibGVTdGF0ZS5zZWFyY2gucHJlZGljYXRlT2JqZWN0LnNlYXJjaFRlcm07XHJcbiAgICAgICAgICAgIH1cclxuXHJcbiAgICAgICAgICAgIHZtLmlzQnVzeSA9IHRydWU7XHJcbiAgICAgICAgICAgIHNlcnZpY2UucXVlcnkoc2VhcmNoVGVybSlcclxuICAgICAgICAgICAgICAgIC50aGVuKGZ1bmN0aW9uIChkYXRhKSB7XHJcbiAgICAgICAgICAgICAgICAgICAgdm0udXNlcnMgPSBkYXRhO1xyXG4gICAgICAgICAgICAgICAgICAgIGxvZ2dlci5sb2coJ3VzZXJzJywgdm0udXNlcnMpO1xyXG4gICAgICAgICAgICAgICAgfSlcclxuICAgICAgICAgICAgICAgIC5maW5hbGx5KGZ1bmN0aW9uICgpIHtcclxuICAgICAgICAgICAgICAgICAgICB2bS5pc0J1c3kgPSBmYWxzZTtcclxuICAgICAgICAgICAgICAgIH0pO1xyXG4gICAgICAgIH07XHJcblxyXG4gICAgICAgIHZtLnVuZG9EZWxldGUgPSBmdW5jdGlvbiAoKSB7XHJcbiAgICAgICAgICAgIHZhciByb2xlcyA9IFtdO1xyXG5cclxuICAgICAgICAgICAgXy5mb3JFYWNoKHZtLmxhc3REZWxldGVkLnJvbGVzLCBmdW5jdGlvbiAocm9sZSkge1xyXG4gICAgICAgICAgICAgICAgcm9sZXMucHVzaChyb2xlLm5hbWUpO1xyXG4gICAgICAgICAgICAgICAgbG9nZ2VyLmxvZygncm9sZScsIHJvbGUubmFtZSk7XHJcbiAgICAgICAgICAgIH0pO1xyXG4gICAgICAgICAgICB2bS5sYXN0RGVsZXRlZC5yb2xlcyA9IHJvbGVzO1xyXG4gICAgICAgICAgICB2bS5sYXN0RGVsZXRlZC5wYXNzd29yZCA9IGRlZmF1bHRzLkdFTkVSSUNfUEFTU1dPUkQ7XHJcblxyXG4gICAgICAgICAgICBzZXJ2aWNlLmNyZWF0ZSh2bS5sYXN0RGVsZXRlZCkudGhlbihmdW5jdGlvbiAoZGF0YSkge1xyXG4gICAgICAgICAgICAgICAgbG9nZ2VyLnN1Y2Nlc3MoJ1N1Y2Nlc3NmdWxseSByZXN0b3JlZCAnICsgZGF0YS51c2VyTmFtZSk7XHJcbiAgICAgICAgICAgICAgICB2bS51c2Vycy51bnNoaWZ0KGRhdGEpO1xyXG4gICAgICAgICAgICAgICAgdm0ubGFzdERlbGV0ZWQgPSBudWxsO1xyXG4gICAgICAgICAgICB9KTtcclxuICAgICAgICB9O1xyXG5cclxuICAgICAgICB2bS51bmRvQ2hhbmdlID0gZnVuY3Rpb24gKCkge1xyXG4gICAgICAgICAgICB2bS5pc0J1c3kgPSB0cnVlO1xyXG5cclxuICAgICAgICAgICAgc2VydmljZS51cGRhdGUodm0ubGFzdFVwZGF0ZWQpXHJcbiAgICAgICAgICAgICAgICAudGhlbihmdW5jdGlvbiAoZGF0YSkge1xyXG4gICAgICAgICAgICAgICAgICAgIGFuZ3VsYXIuZm9yRWFjaCh2bS51c2VycyxcclxuICAgICAgICAgICAgICAgICAgICAgICAgZnVuY3Rpb24gKHUsIGkpIHtcclxuICAgICAgICAgICAgICAgICAgICAgICAgICAgIGlmICh1LmlkID09PSB2bS5sYXN0VXBkYXRlZC5pZCkge1xyXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIHZtLnVzZXJzW2ldID0gdm0ubGFzdFVwZGF0ZWQ7XHJcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICB9XHJcbiAgICAgICAgICAgICAgICAgICAgICAgIH0pO1xyXG4gICAgICAgICAgICAgICAgICAgIGxvZ2dlci5zdWNjZXNzKCdTdWNjZXNzZnVsbHkgcmVzdG9yZWQgJyArIGRhdGEudXNlck5hbWUpO1xyXG4gICAgICAgICAgICAgICAgICAgIHZtLmxhc3RVcGRhdGVkID0gbnVsbDtcclxuICAgICAgICAgICAgICAgIH0pXHJcbiAgICAgICAgICAgICAgICAuZmluYWxseShmdW5jdGlvbiAoKSB7XHJcbiAgICAgICAgICAgICAgICAgICAgdm0uaXNCdXN5ID0gZmFsc2U7XHJcbiAgICAgICAgICAgICAgICB9KTtcclxuICAgICAgICB9O1xyXG5cclxuICAgICAgICBmdW5jdGlvbiBjbGVhckNyZWF0ZSgkZXZlbnQpIHtcclxuICAgICAgICAgICAgaWYgKCRldmVudC5rZXlDb2RlID09PSBrZXlDb2Rlcy5lc2MpIHtcclxuICAgICAgICAgICAgICAgIHZtLnVzZXIudXNlck5hbWUgPSAnJztcclxuICAgICAgICAgICAgfTtcclxuICAgICAgICB9O1xyXG5cclxuICAgICAgICBmdW5jdGlvbiBwYXJzZUZ1bGxOYW1lKG5hbWUpIHtcclxuICAgICAgICAgICAgdmFyIGFyciA9IG5hbWUuc3BsaXQoJy4nKTtcclxuICAgICAgICAgICAgdmFyIGZ1bGxuYW1lID0gJyc7XHJcblxyXG4gICAgICAgICAgICBfLmZvckVhY2goYXJyLCBmdW5jdGlvbiAodikge1xyXG4gICAgICAgICAgICAgICAgZnVsbG5hbWUgKz0gXy5jYXBpdGFsaXplKHYpICsgJyAnO1xyXG4gICAgICAgICAgICB9KTtcclxuXHJcbiAgICAgICAgICAgIHJldHVybiBfLnRyaW0oZnVsbG5hbWUpO1xyXG4gICAgICAgIH07XHJcbiAgICB9O1xyXG59KSgpOyJdLCJzb3VyY2VSb290IjoiL3NvdXJjZS8ifQ==
