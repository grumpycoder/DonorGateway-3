@{
    ViewBag.Title = "MarkIt";
}

<div ng-controller="MailerController as vm">

    <!-- Content Header (Page header) -->
    <section class="content-header">
        <h1>
            {{vm.title}}<small>{{vm.description}}</small>
        </h1>
        <ol class="breadcrumb">
            <li><a href="#"><i class="fa fa-dashboard"></i> Home</a></li>
            <li class="active">Mailer Manager</li>
        </ol>
    </section>

    <!-- Main content -->
    <section class="content">
        <div class="row">
            <div class="col-md-12">

                <div class="box box-warning box-solid">
                    <div class="box-header with-border">
                        <small>({{vm.searchModel.filteredCount}} / {{vm.searchModel.totalCount}}) Total Records</small>
                        <span class="pull-right">
                            <small>Page {{vm.searchModel.page}} of {{vm.searchModel.totalPages}}</small>
                        </span>

                        @*<button class="btn btn-default"
                                    ng-csv="vm.downloadCsv()"
                                    csv-header="['RecordId', 'LookupID', 'FinderNumber', 'Name', 'EmailAddress', 'AddressLine1', 'AddressLine2', 'City', 'State', 'ZIP']"
                                    quote-strings="true" filename="data.csv" uib-tooltip="Export current filtered records to CSV">
                                <i class="fa fa-download"></i>&nbsp; Export to CSV
                            </button>*@
                    </div><!-- /.box-header -->

                    <div class="box-body">
                        <div class="col-md-12">

                            <table st-table="vm.mailers" st-pipe="vm.search" class="table table-responsive table-bordered">

                                <thead class="text-nowrap">
                                    <tr>
                                        <th class="sort-header">Suppress</th>
                                        <th class="sort-header">First Name</th>
                                        <th class="sort-header">Last Name</th>
                                        <th class="sort-header">Address</th>
                                        <th class="sort-header">City</th>
                                        <th class="sort-header">State</th>
                                        <th class="sort-header">Zip</th>
                                        <th class="sort-header">Finder</th>
                                        <th class="sort-header">Source Code</th>
                                        <th class="sort-header">Campaign</th>
                                        <th class="sort-header">Reason</th>
                                    </tr>
                                    <tr>
                                        <td>
                                            <input toggle-checkbox type="checkbox"
                                                   data-toggle="toggle"
                                                   ng-model="vm.searchModel.suppress"
                                                   data-onstyle="danger"
                                                   data-offstyle="success"
                                                   data-size="small"
                                                   ng-change="vm.filterSuppress()">
                                        </td>
                                        <td><input type="text" st-clear-key st-search="firstName" class="form-control" placeholder="First Name" /></td>
                                        <td><input type="text" st-clear-key st-search="lastName" class="form-control" placeholder="Last Name" /></td>
                                        <td><input type="text" st-clear-key st-search="address" class="form-control" placeholder="Address" /></td>
                                        <td><input type="text" st-clear-key st-search="city" class="form-control" placeholder="City" /></td>
                                        <td><input type="text" st-clear-key st-search="state" class="form-control" placeholder="State" /></td>
                                        <td><input type="text" st-clear-key st-search="zipCode" class="form-control" placeholder="Zipcode" /></td>
                                        <td><input type="text" st-clear-key st-search="finderNumber" class="form-control" placeholder="Finder Number" /></td>
                                        <td><input type="text" st-clear-key st-search="sourceCode" class="form-control" placeholder="Source Code" /></td>
                                        <td>
                                            <select st-search="campaignId" ng-model="vm.searchModel.campaignId" class="form-control">
                                                <option value="">
                                                    All items
                                                </option>
                                                <option ng-repeat="item in vm.campaigns" value="{{ item.id }}">
                                                    {{ item.name }}
                                                </option>
                                            </select>
                                        </td>
                                        <td>
                                            <input type="text" st-clear-key st-search="reason" class="form-control" placeholder="Reason" />
                                        </td>
                                    </tr>
                                </thead>
                                <tbody>
                                    <tr ng-repeat="m in vm.mailers">
                                        <td>
                                            <button class="btn  btn-success" ng-hide="vm.currentEdit[m.id]" ng-click="vm.editItem(m)"><i class="fa fa-flag"></i></button>
                                            <button class="btn  btn-primary" ng-show="vm.currentEdit[m.id]" ng-click="vm.save(m)"><i class="fa fa-floppy-o"></i></button>
                                            <button class="btn  btn-default" ng-show="vm.currentEdit[m.id]" ng-click="vm.cancelEdit(m.id)"><i class="fa fa-ban"></i></button>

                                            @*<button class="btn btn-danger btn-sm" ng-click="vm.setSuppress(m)" ng-hide="m.suppress">Suppress</button>*@
                                            @*<button class="btn btn-success btn-sm" ng-click="vm.setSuppress(m)" ng-show="m.suppress">Restore</button>*@
                                        </td>
                                        <td>{{m.firstName}}</td>
                                        <td>{{m.lastName}}</td>
                                        <td>
                                            <address>
                                                {{m.address}}
                                                <br>
                                                {{m.address2}}<br>
                                                {{m.address3}}
                                            </address>
                                        </td>
                                        <td>{{m.city}}</td>
                                        <td>{{m.state}}</td>
                                        <td>{{m.zipCode}}</td>
                                        <td>{{m.finderNumber}}</td>
                                        <td>{{m.sourceCode}}</td>
                                        <td>{{m.campaign.name}}</td>
                                        <td>
                                            <span ng-hide="vm.currentEdit[m.id]">
                                                {{m.reason.reason}}
                                            </span>
                                            <div class="form-group" ng-show="vm.currentEdit[m.id]">
                                                <select ng-model="vm.itemToEdit.reasonId"
                                                        ng-options="reason.id as reason.reason for reason in vm.reasons"
                                                        ng-disabled="false"
                                                        class="form-control"
                                                        style="width: 175px;">
                                                    <option value="">Choose a Reason</option>
                                                </select>
                                            </div>
                                        </td>
                                    </tr>
                                </tbody>
                            </table>

                            <uib-pagination total-items="vm.searchModel.filteredCount"
                                            ng-model="vm.searchModel.page"
                                            max-size="5"
                                            items-per-page="vm.searchModel.pageSize"
                                            class="pagination-sm"
                                            boundary-link-numbers="true"
                                            ng-change="vm.paged()"
                                            rotate="false">
                            </uib-pagination>
                        </div>
                    </div><!--/box-body-->

                    <div class="overlay" ng-show="vm.isBusy">
                        <i class="fa fa-refresh fa-spin"></i>
                    </div>
                </div><!--/box-->
            </div>
        </div>
    </section>
</div>